"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[116],{3116:(e,n,a)=>{a.r(n);var s={};a.r(s),a.d(s,{json:()=>On,matchPattern:()=>Tn,regexp:()=>Rn,required:()=>Pn});var l=a(9383),r=a(9301),i=a(4676),o=a(7298),c=(a(6869),a(6392),a(5822));a(4333);const d=c.gy(o.AW);var u;function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},p.apply(this,arguments)}function m(e,t){return r.createElement("svg",p({width:10,height:12,viewBox:"0 0 10 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),u||(u=r.createElement("path",{opacity:.9,d:"M4 11h2M3 8c0-2-1.5-2.5-1.5-4s1-3 3.5-3 3.5 1.5 3.5 3S7 6 7 8",stroke:"currentColor",strokeWidth:2,strokeLinecap:"square"})))}const h=r.forwardRef(m);var f;function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},v.apply(this,arguments)}function g(e,t){return r.createElement("svg",v({width:12,height:9,viewBox:"0 0 12 9",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),f||(f=r.createElement("path",{d:"M2 4l3 3 5-5",stroke:"currentColor",strokeWidth:2,strokeLinecap:"square"})))}const x=r.forwardRef(g);var j;function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},b.apply(this,arguments)}function y(e,t){return r.createElement("svg",b({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),j||(j=r.createElement("path",{d:"M14 2L2 14M2 2l12 12",stroke:"currentColor",strokeWidth:2,strokeLinecap:"square"})))}const w=r.forwardRef(y);var k;function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},C.apply(this,arguments)}function S(e,t){return r.createElement("svg",C({width:14,height:18,viewBox:"0 0 14 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),k||(k=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M.163.819C0 1.139 0 1.559 0 2.4v13.2c0 .84 0 1.26.163 1.581a1.5 1.5 0 00.656.655c.32.164.74.164 1.581.164h9.2c.84 0 1.26 0 1.581-.163a1.5 1.5 0 00.655-.656c.164-.32.164-.74.164-1.581V2.4c0-.84 0-1.26-.164-1.581a1.5 1.5 0 00-.655-.656C12.861 0 12.441 0 11.6 0H2.4C1.56 0 1.14 0 .819.163A1.5 1.5 0 00.163.82zM10 11a2 2 0 100-4 2 2 0 000 4z",fill:"#000"})))}const E=r.forwardRef(S);var N;function A(){return A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},A.apply(this,arguments)}function P(e,t){return r.createElement("svg",A({width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),N||(N=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 7a2 2 0 100 4 2 2 0 000-4zm5 2a2 2 0 114 0 2 2 0 01-4 0zm7 0a2 2 0 114 0 2 2 0 01-4 0z",fill:"currentColor"})))}const T=r.forwardRef(P);var O;function R(){return R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},R.apply(this,arguments)}function D(e,t){return r.createElement("svg",R({width:14,height:12,viewBox:"0 0 14 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),O||(O=r.createElement("path",{d:"M13.348 10.313c.433.75-.11 1.687-.974 1.687H1.126a1.126 1.126 0 01-.974-1.687L5.776.563a1.126 1.126 0 011.948 0l5.624 9.75zM6.75 8.297a1.078 1.078 0 100 2.156 1.078 1.078 0 000-2.156zM5.726 4.422L5.9 7.609c.008.15.132.266.281.266H7.32c.15 0 .273-.117.28-.266l.175-3.187a.281.281 0 00-.281-.297H6.007a.281.281 0 00-.28.297z",fill:"#F5222D"})))}const _=r.forwardRef(D);var L,M;function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},F.apply(this,arguments)}function I(e,t){return r.createElement("svg",F({width:18,height:16,viewBox:"0 0 18 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),L||(L=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 3.2c0-1.12 0-1.68.218-2.108a2 2 0 01.874-.874C1.52 0 2.08 0 3.2 0h2.4c.88 0 1.32 0 1.724.115a3 3 0 01.99.495c.334.254.598.606 1.126 1.31L11 4H0v-.8z",fill:"#000",fillOpacity:.4})),M||(M=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 5.4c0-.84 0-1.26.163-1.581a1.5 1.5 0 01.656-.656C1.139 3 1.559 3 2.4 3h13.2c.84 0 1.26 0 1.581.163a1.5 1.5 0 01.655.656c.164.32.164.74.164 1.581v8.2c0 .84 0 1.26-.163 1.581a1.5 1.5 0 01-.656.655c-.32.164-.74.164-1.581.164H2.4c-.84 0-1.26 0-1.581-.164a1.5 1.5 0 01-.656-.655C0 14.861 0 14.441 0 13.6V5.4z",fill:"#000"})))}const z=r.forwardRef(I);var $,B;function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},H.apply(this,arguments)}function U(e,t){return r.createElement("svg",H({width:32,height:32,viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),$||($=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 2c2.702 0 5.158.655 7.232 1.828a13.01 13.01 0 014.94 4.94C29.345 10.842 30 13.298 30 16s-.655 5.158-1.828 7.232a13.01 13.01 0 01-4.94 4.94C21.158 29.345 18.702 30 16 30s-5.158-.655-7.232-1.828a13.01 13.01 0 01-4.94-4.94C2.655 21.158 2 18.702 2 16s.655-5.158 1.828-7.232a13.009 13.009 0 014.94-4.94C10.842 2.655 13.298 2 16 2z",fill:"#09F"})),B||(B=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.501 12.5c.552 0 .98.456.957 1.002l-.416 9.995a1.053 1.053 0 01-.924.996L16 24.5a1.058 1.058 0 01-1.042-1.003l-.355-8.502c-.013-.273-.23-.595-.474-.712l-1.322-.635a.599.599 0 01-.307-.498V13c0-.276.23-.5.502-.5H16.5zM16 7.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3z",fill:"#fff"})))}const V=r.forwardRef(U);var q;function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},W.apply(this,arguments)}function G(e,t){return r.createElement("svg",W({width:10,height:2,viewBox:"0 0 10 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),q||(q=r.createElement("path",{opacity:.9,d:"M1 1h8",stroke:"currentColor",strokeWidth:2,strokeLinecap:"square"})))}const J=r.forwardRef(G);var K,Z,X;function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Y.apply(this,arguments)}function Q(e,t){return r.createElement("svg",Y({fill:"none",height:20,viewBox:"0 0 20 20",width:20,xmlns:"http://www.w3.org/2000/svg",ref:t},e),K||(K=r.createElement("mask",{id:"person-circle_svg__a",height:20,maskUnits:"userSpaceOnUse",width:20,x:0,y:0},r.createElement("circle",{cx:10,cy:10,fill:"#fff",r:10}))),Z||(Z=r.createElement("circle",{cx:10,cy:10,fill:"#000",fillOpacity:.4,r:10})),X||(X=r.createElement("g",{mask:"url(#person-circle_svg__a)"},r.createElement("path",{d:"M3.605 17.411a3 3 0 011.32-2.198l2.183-1.454c.563-.376.608-1.204.153-1.705-.7-.77-1.515-1.912-1.515-3.054 0-2 .25-6 4.25-6s4.25 4 4.25 6c0 1.142-.815 2.284-1.515 3.054-.455.5-.41 1.33.153 1.705l2.182 1.454a3 3 0 011.321 2.198l.249 2.49A1 1 0 0115.641 21H4.351a1 1 0 01-.995-1.1z",fill:"#000"}))))}const ee=r.forwardRef(Q);var te;function ne(){return ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ne.apply(this,arguments)}function ae(e,t){return r.createElement("svg",ne({width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),te||(te=r.createElement("g",{fillRule:"evenodd",clipRule:"evenodd",fill:"#000"},r.createElement("path",{d:"M5.08 11.074c.2-.234.3-.351.406-.425a1 1 0 011.076-.04c.11.064.22.173.438.391.218.218.327.327.392.438a1 1 0 01-.041 1.076c-.074.105-.19.206-.425.406l-5.39 4.62A.764.764 0 01.46 16.463l4.62-5.39z",fillOpacity:.6}),r.createElement("path",{d:"M10.303 1.697c.594-.594.891-.891 1.233-1.002a1.5 1.5 0 01.928 0c.342.111.639.408 1.233 1.002l2.606 2.606c.594.594.891.891 1.002 1.233a1.5 1.5 0 010 .928c-.111.342-.408.639-1.002 1.233l-2.769 2.769c-.2.2-.299.299-.383.41-.074.099-.14.204-.194.315a4.174 4.174 0 00-.196.526l-.942 2.827c-.271.813-.407 1.22-.66 1.408a1 1 0 01-.77.182c-.31-.055-.613-.359-1.22-.965L2.831 8.831c-.607-.607-.91-.91-.964-1.22a1 1 0 01.181-.77c.188-.253.595-.389 1.408-.66l2.827-.942c.268-.09.401-.134.526-.196a2 2 0 00.315-.194c.111-.084.211-.184.41-.383l2.769-2.769z"}))))}const se=r.forwardRef(ae);var le;function re(){return re=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},re.apply(this,arguments)}function ie(e,t){return r.createElement("svg",re({width:14,height:14,viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),le||(le=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 0v6h6v2H8v6H6V8H0V6h6V0h2z",fill:"currentColor"})))}const oe=r.forwardRef(ie);var ce;function de(){return de=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},de.apply(this,arguments)}function ue(e,t){return r.createElement("svg",de({width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),ce||(ce=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 0a4 4 0 100 8h10a4 4 0 000-8H4zm0 10a4 4 0 000 8h10a4 4 0 000-8H4zm2 4a2 2 0 11-4 0 2 2 0 014 0zm8-8a2 2 0 100-4 2 2 0 000 4z",fill:"#000"})))}const pe=r.forwardRef(ue);var me,he,fe,ve;function ge(){return ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ge.apply(this,arguments)}function xe(e,t){return r.createElement("svg",ge({width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),me||(me=r.createElement("path",{d:"M3.781 11.375c0 1.041-.85 1.891-1.89 1.891-1.041 0-1.891-.85-1.891-1.89 0-1.041.85-1.892 1.89-1.892h1.891v1.891zM4.734 11.375c0-1.04.85-1.89 1.891-1.89s1.891.85 1.891 1.89v4.735c0 1.04-.85 1.891-1.89 1.891-1.041 0-1.892-.85-1.892-1.891v-4.735z",fill:"#E01E5A"})),he||(he=r.createElement("path",{d:"M6.625 3.782c-1.04 0-1.89-.85-1.89-1.891C4.734.85 5.584 0 6.624 0c1.041 0 1.891.85 1.891 1.891v1.89h-1.89zM6.625 4.734c1.04 0 1.891.85 1.891 1.891s-.85 1.891-1.89 1.891H1.89C.85 8.516 0 7.666 0 6.626c0-1.041.85-1.892 1.89-1.892h4.735z",fill:"#36C5F0"})),fe||(fe=r.createElement("path",{d:"M14.219 6.625c0-1.04.85-1.89 1.89-1.89 1.041 0 1.892.85 1.892 1.89 0 1.041-.85 1.891-1.891 1.891h-1.891v-1.89zM13.266 6.626c0 1.04-.85 1.89-1.891 1.89-1.04 0-1.891-.85-1.891-1.89V1.89c0-1.04.85-1.891 1.89-1.891 1.042 0 1.892.85 1.892 1.891v4.735z",fill:"#2EB67D"})),ve||(ve=r.createElement("path",{d:"M11.374 14.219c1.04 0 1.89.85 1.89 1.89 0 1.041-.85 1.892-1.89 1.892s-1.891-.85-1.891-1.891v-1.891h1.89zM11.374 13.266c-1.04 0-1.89-.85-1.89-1.89 0-1.041.85-1.892 1.89-1.892h4.735c1.04 0 1.891.85 1.891 1.891s-.85 1.891-1.891 1.891h-4.735z",fill:"#ECB22E"})))}const je=r.forwardRef(xe);var be;function ye(){return ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ye.apply(this,arguments)}function we(e,t){return r.createElement("svg",ye({width:48,height:64,viewBox:"0 0 48 64",fill:"#1890FF",xmlns:"http://www.w3.org/2000/svg",ref:t},e),be||(be=r.createElement("path",{d:"M28 17V0H3C1.337 0 0 1.337 0 3v58c0 1.663 1.337 3 3 3h42c1.663 0 3-1.337 3-3V20H31c-1.65 0-3-1.35-3-3zm8.148 27.001H28v10a2 2 0 01-2 2h-4a2 2 0 01-2-2v-10h-8.148c-1.784 0-2.676-2.161-1.408-3.42L22.496 28.62a2.131 2.131 0 013.005 0L37.554 40.58c1.268 1.259.378 3.42-1.407 3.42zm10.977-30.876L34.888.875A2.998 2.998 0 0032.763 0H32v16h16v-.762a2.99 2.99 0 00-.875-2.113z"})))}const ke=r.forwardRef(we);var Ce;function Se(){return Se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Se.apply(this,arguments)}function Ee(e,t){return r.createElement("svg",Se({width:12,height:12,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),Ce||(Ce=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.548.453c-.603-.603-1.205-.603-1.808 0l-.78.779L10.77 3.04l.779-.78c.603-.602.603-1.205 0-1.807zm-1.632 3.44L8.108 2.083 1.905 8.288S-.506 11.3.097 11.904c.602.603 3.616-1.808 3.616-1.808l6.203-6.204z",fill:"#000"})))}const Ne=r.forwardRef(Ee),Ae=(e,t)=>{const n=null!=t?t:(e,t)=>e===t;return(null!=e?e:[]).reduce(((e,t)=>(e.findIndex((e=>n(e,t)))<0&&e.push(t),e)),[])},Pe=e=>null!=e,Te=e=>"string"==typeof e&&""===e.trim(),Oe=e=>{const t=Object.entries(e).reduce(((e,[t,n])=>Pe(n)&&!Te(n)?"[object Object]"===Object.prototype.toString.call(n)?[...e,[t,Oe(n)]]:[...e,[t,n]]:e),[]);return Object.fromEntries(t)},Re=(e="")=>e.match(/^https?/)||e.match(/^\/\//)?e:[APP_SETTINGS.hostname.replace(/([/]+)$/,""),e.replace(/^([/]+)/,"")].join("/"),De=e=>{const t=document.createElement("textarea");t.style.position="fixed",document.body.appendChild(t),t.value=e,t.focus(),t.select(),document.execCommand("copy"),t.remove()},_e=(e,t,n)=>Math.max(t,Math.min(e,n));var Le=a(7712);const Me=null!=="ls-"?"ls-":"dm-",Fe=(0,r.createContext)(null),Ie=(e,t={})=>{const{elem:n,mix:a,mod:s}=null!=t?t:{},l=e,r={block:e=>Ie(e,{elem:n,mix:a,mod:s}),elem:t=>Ie(e,{elem:t,mix:a,mod:s}),mod(t={}){const r=Object.assign({},null!=s?s:{},t);return Ie(null!=e?e:l,{elem:n,mix:a,mod:r})},mix:(...t)=>Ie(e,{elem:n,mix:t,mod:s}),select(e=document){return e.querySelector(this.toCSSSelector())},selectAll(e=document){return e.querySelectorAll(this.toCSSSelector())},closest(e){return e.closest(this.toCSSSelector())},toString:()=>((e,t,n,a)=>{const s=e,l=t?`${s}__${t}`:null,r=Object.entries(null!=a?a:{}).reduce(((e,[t,n])=>{const a=[null!=l?l:s];return null==n||!1!==n&&(a.push(t),!0!==n&&a.push(n),e.push(a.join("_"))),e}),[]),i=[];if(i.push(null!=l?l:s),i.push(...r),n){const e=Array.isArray(n)?n:[n],t=[].concat(...e).filter((e=>Pe(e)&&""!==e)).map((e=>{return"string"==typeof e?e:null==e||null===(t=e.toClassName)||void 0===t?void 0:t.call(e);var t})).reduce(((e,t)=>[...e,...t.split(/\s+/)]),[]);i.push(...t)}return i.filter((e=>!Te(e))).map((e=>new RegExp(Me).test(e)?e:`${Me}${e}`)).join(" ")})(e,n,a,s),toClassName(){return this.toString()},toCSSSelector(){return`.${this.toClassName().replace(/(\s+)/g,".")}`}};return Object.defineProperty(r,"Block",{value:$e}),Object.defineProperty(r,"Elem",{value:Be}),Object.defineProperty(r,"__class",{value:{block:e,elem:n,mix:a,mod:s}}),r},ze=e=>{const t=null!=e?e:(0,r.createContext)(null),n=(0,r.forwardRef)((({tag:e="div",name:n,mod:a,mix:s,...l},i)=>{const o=Ie(n),c=[].concat(s).filter((e=>!!e)),d=o.mod(a).mix(...c,l.className).toClassName(),u={...l,ref:i,className:d};return(0,Le.jsx)(t.Provider,{value:o,children:(0,r.createElement)(e,u)})}));n.displayName="Block";const a=(0,r.forwardRef)((({component:e,block:n,name:a,mod:s,mix:l,...i},o)=>{var c;const d=(0,r.useContext)(t),u=[].concat(l).filter((e=>!!e)),p=null!==(c=i.tag)&&void 0!==c?c:"div",m=(n?Ie(n):d).elem(a).mod(s).mix(...u,i.className).toClassName(),h={...i,ref:o,className:m};return"string"!=typeof p&&(h.block=d),(0,r.createElement)(null!=e?e:p,h)}));return a.displayName="Elem",{Block:n,Elem:a,Context:t}},{Block:$e,Elem:Be}=ze(Fe),He=(0,r.createContext)();He.displayName="FormContext";const Ue=(0,r.createContext)();Ue.displayName="FormValidationContext";const Ve=(0,r.createContext)();Ve.displayName="FormSubmissionContext";const qe=(0,r.createContext)();qe.displayName="FormStateContext";const We=(0,r.createContext)();We.displayName="FormResponseContext";const Ge=r.forwardRef((({children:e,type:t,extra:n,className:a,size:s,waiting:l,icon:i,tag:o,look:c,...d},u)=>{const p=null!=o?o:d.href?"a":"button",m={size:s,waiting:l,type:t,look:null!=c?c:[],withIcon:!!i,withExtra:!!n};var h,f;!0===r.useContext(Ve)&&(null!==(h=m.look)&&void 0!==h&&null!==(f=h.includes)&&void 0!==f&&f.call(h,"primary")&&"submit"===t?m.waiting=!0:d.disabled=!0);d.primary&&(m.look="primary",delete d.primary);const v=r.useMemo((()=>{if(!i)return null;if(Pe(i.props.size))return i;switch(s){case"small":return r.cloneElement(i,{...i.props,size:12,width:12,height:12});case"compact":return r.cloneElement(i,{...i.props,size:14,width:14,height:14});default:return i}}),[i,s]);return(0,Le.jsx)($e,{name:"button",mod:m,mix:a,ref:u,tag:p,type:t,...d,children:(0,Le.jsxs)(Le.Fragment,{children:[v&&(0,Le.jsx)(Be,{tag:"span",name:"icon",children:v}),v&&e?(0,Le.jsx)("span",{children:e}):e,void 0!==n?(0,Le.jsx)(Be,{name:"extra",children:n}):null]})})}));Ge.displayName="Button",Ge.Group=({className:e,children:t,collapsed:n})=>(0,Le.jsx)($e,{name:"button-group",mod:{collapsed:n},mix:e,children:t});const{Block:Je}=ze(),Ke=({direction:e="horizontal",size:t,className:n,style:a,children:s,spread:l,stretch:r,align:i})=>(0,Le.jsx)(Je,{name:"space",mod:{direction:e,size:t,spread:l,stretch:r,align:i},mix:n,style:a,children:s}),Ze=({title:e,message:t,errorId:n,stacktrace:a,validation:s,version:l,onGoBack:i,onReload:o,possum:c=!1})=>{const d=(0,r.useMemo)((()=>(null!=a?a:"").trim()),[a]),[u,p]=(0,r.useState)(!1),m=(0,r.useCallback)((()=>{p(!0),De(d),setTimeout((()=>p(!1)),1200)}),[d]);return(0,Le.jsxs)($e,{name:"error-message",children:[!1!==c&&(0,Le.jsx)(Be,{tag:"img",name:"heidi",src:Re("/static/images/opossum_broken.svg"),height:"111",alt:"Heidi's down"}),e&&(0,Le.jsx)(Be,{name:"title",children:e}),t&&(0,Le.jsx)(Be,{name:"detail",dangerouslySetInnerHTML:{__html:String(t)}}),d&&(0,Le.jsx)(Be,{name:"stracktrace",dangerouslySetInnerHTML:{__html:d.replace(/(\n)/g,"<br>")}}),(null==s?void 0:s.length)>0&&(0,Le.jsx)(Be,{tag:"ul",name:"validation",children:s.map((([e,t])=>(0,Le.jsx)(r.Fragment,{children:[].concat(t).map(((e,t)=>(0,Le.jsx)(Be,{tag:"li",name:"message",dangerouslySetInnerHTML:{__html:e}},t)))},e)))}),(l||n)&&(0,Le.jsx)(Be,{name:"version",children:(0,Le.jsxs)(Ke,{children:[l&&`Version: ${l}`,n&&`Error ID: ${n}`]})}),(0,Le.jsx)(Be,{name:"actions",children:(0,Le.jsxs)(Ke,{spread:!0,children:[(0,Le.jsx)(Be,{tag:Ge,name:"action-slack",target:"_blank",icon:(0,Le.jsx)(je,{}),href:"https://slack.labelstudio.heartex.com/?source=product-error-msg",children:"Ask on Slack"}),(0,Le.jsxs)(Ke,{size:"small",children:[d&&(0,Le.jsx)(Ge,{disabled:u,onClick:m,style:{width:180},children:u?"Copied":"Copy Stacktrace"}),i&&(0,Le.jsx)(Ge,{onClick:i,children:"Go Back"}),o&&(0,Le.jsx)(Ge,{onClick:o,children:"Reload"})]})]})})]})},Xe=(0,r.createContext)(window.APP_SETTINGS);Xe.displayName="ConfigContext";Xe.Consumer;const Ye=({children:e})=>{var t;const[n,a]=(0,r.useState)(null!==(t=window.APP_SETTINGS)&&void 0!==t?t:{}),s=e=>{e&&a(e)},l=(0,r.useMemo)((()=>({...n,update:s})),[n]);return(0,Le.jsx)(Xe.Provider,{value:l,children:e})},Qe=()=>(0,r.useContext)(Xe),et=(0,r.createContext)(),tt=({children:e})=>{const t=bt(),[n,a]=(0,r.useState)(),s=(0,r.useCallback)((()=>{t.callApi("me").then((e=>{a(e)}))}),[t.callApi]);return(0,r.useEffect)((()=>{s()}),[s]),(0,Le.jsx)(et.Provider,{value:{user:n,fetch:s},children:e})},nt=e=>{var t;let n=e.children||null;if(!e.providers)throw"MultiProvider: Missing providers prop";if(!e.children)throw"MultiProvider: Missing children";return e.providers.length?([...null!==(t=e.providers)&&void 0!==t?t:[]].reverse().forEach((e=>{n=r.cloneElement(e,null,n)})),n):n},at=(e,{init:t,transition:n,onStart:a,beforeTransition:s,afterTransition:l}={})=>new Promise((async r=>{null==t||t(e);const i=()=>{null==a||a(e)},o=async()=>{await(null==l?void 0:l(e)),e.removeEventListener("transitionstart",i),e.removeEventListener("transitionend",o),r()};e.addEventListener("transitionstart",i),e.addEventListener("transitionend",o),await(null==s?void 0:s()),setTimeout((()=>n(e)),30)}));function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{Block:lt,Elem:rt}=ze(),it=(0,r.createContext)();class ot extends r.Component{constructor(e){var t;super(e),st(this,"modalRef",r.createRef()),st(this,"onClickOutside",(e=>{if(!this.modalRef.current)return;const{closeOnClickOutside:t}=this.props,n=!1!==this.props.allowClose,a=this.modalRef.current.contains(e.target),s=Ie("modal").elem("content").closest(e.target),l=Ie("modal").elem("close").closest(e.target);n&&(a&&l||null===s&&!1!==t)&&this.hide()})),st(this,"closeOnEscape",(e=>{!1!==this.props.allowClose&&"Escape"===e.key&&this.state.visible&&(e.stopPropagation(),e.preventDefault(),this.hide())})),this.state={title:e.title,body:e.body,footer:e.footer,visible:!e.animateAppearance&&(null!==(t=e.visible)&&void 0!==t&&t),transition:e.visible?"visible":null}}componentDidMount(){this.props.animateAppearance&&setTimeout((()=>this.show()),30),document.addEventListener("keydown",this.closeOnEscape,{capture:!0})}componentWillUnmount(){document.removeEventListener("keydown",this.closeOnEscape,{capture:!0})}componentDidUpdate(e,t){t.visible!==this.state.visible&&(document.body.style.overflow=this.state.visible?"hidden":"")}setBody(e){this.setState({body:e})}show(e){return new Promise((t=>{this.setState({visible:!0},(async()=>{var n,a;null==e||e(),null===(n=(a=this.props).onShow)||void 0===n||n.call(a),await this.transition("appear",t)}))}))}hide(e){return new Promise((t=>{this.transition("disappear",(()=>{this.setState({visible:!1},(()=>{var n,a;null===(n=(a=this.props).onHide)||void 0===n||n.call(a),t(),null==e||e()}))}))}))}render(){if(!this.state.visible)return null;const e=this.props.bare,t={fullscreen:!!this.props.fullscreen,bare:this.props.bare,visible:this.props.visible||this.state.visible},n=[this.transitionClass,this.props.className],a={};this.props.width&&(a.width=this.props.width),this.props.height&&(a.height=this.props.height);const s=(0,Le.jsx)(it.Provider,{value:this,children:(0,Le.jsx)(lt,{name:"modal",ref:this.modalRef,mod:t,mix:n,onClick:this.onClickOutside,children:(0,Le.jsx)(rt,{name:"wrapper",children:(0,Le.jsxs)(rt,{name:"content",style:Object.assign({},this.props.style,a),children:[!e&&(0,Le.jsxs)(ot.Header,{children:[(0,Le.jsx)(rt,{name:"title",children:this.state.title}),!1!==this.props.allowClose&&(0,Le.jsx)(rt,{tag:Ge,name:"close",type:"text",icon:(0,Le.jsx)(w,{})})]}),(0,Le.jsx)(rt,{name:"body",mod:{bare:e},children:this.body}),this.props.footer&&(0,Le.jsx)(ot.Footer,{bare:this.props.bareFooter,children:this.footer})]})})})});return(0,i.createPortal)(s,document.body)}transition(e,t){return at(this.modalRef.current,{transition:async()=>new Promise((t=>{this.setState({transition:e},(()=>{t()}))})),beforeTransition:async()=>new Promise((t=>{this.setState({transition:`before-${e}`},(()=>{t()}))})),afterTransition:async()=>new Promise((n=>{this.setState({transition:"appear"===e?"visible":null},(()=>{null==t||t(),n()}))}))})}get transitionClass(){switch(this.state.transition){case"before-appear":return"before-appear";case"appear":return"appear before-appear";case"before-disappear":return"before-disappear";case"disappear":return"disappear before-disappear";case"visible":return"visible"}return null}get body(){if(this.state.body){const e=this.state.body;return e instanceof Function?(0,Le.jsx)(e,{}):e}return this.props.children}get footer(){if(this.state.footer){const e=this.state.footer;return e instanceof Function?(0,Le.jsx)(e,{}):e}return null}}ot.Header=({children:e,divided:t})=>(0,Le.jsx)(rt,{name:"header",mod:{divided:t},children:e}),ot.Footer=({children:e,bare:t})=>(0,Le.jsx)(rt,{name:"footer",mod:{bare:t},children:e});const ct=()=>(0,r.useContext)(it),dt=e=>{const t=(0,r.createRef)(),n=document.createElement("div");let a=0;n.className=Ie("modal-holder").toClassName(),document.body.appendChild(n);const s=(e,s)=>{a++,(0,i.render)((0,Le.jsx)(nt,{providers:e.simple?[]:[(0,Le.jsx)(Ye,{},"config"),(0,Le.jsx)(jt,{},"api"),(0,Le.jsx)(tt,{},"current-user")],children:(0,Le.jsx)(ot,{ref:t,...e,onHide:()=>{var t;null===(t=e.onHidden)||void 0===t||t.call(e),(0,i.unmountComponentAtNode)(n),n.remove()},animateAppearance:s})},`modal-${a}`),n)};return s(e,!0),{update(t){s({...e,...null!=t?t:{},visible:!0},!1)},close(){const e=t.current.hide();return(0,i.unmountComponentAtNode)(n),n.remove(),e}}},ut=({okText:e,onOk:t,cancelText:n,onCancel:a,buttonLook:s,...l})=>{const r=dt({...l,allowClose:!1,footer:(0,Le.jsxs)(Ke,{align:"end",children:[(0,Le.jsx)(Ge,{onClick:()=>{null==a||a(),r.close()},size:"compact",autoFocus:!0,children:null!=n?n:"Cancel"}),(0,Le.jsx)(Ge,{onClick:()=>{null==t||t(),r.close()},size:"compact",look:null!=s?s:"primary",children:null!=e?e:"OK"})]})});return r};Object.assign(ot,{info:({okText:e,onOkPress:t,...n})=>{const a=dt({...n,footer:(0,Le.jsx)(Ke,{align:"end",children:(0,Le.jsx)(Ge,{onClick:()=>{null==t||t(),a.close()},look:"primary",size:"compact",children:null!=e?e:"OK"})})});return a},confirm:ut,modal:dt});const pt={gateway:`${window.APP_SETTINGS.hostname}/api`,endpoints:{users:"/users",me:"/current-user/whoami",memberships:"/organizations/:pk/memberships",inviteLink:"/invite",resetInviteLink:"POST:/invite/reset-token",projects:"/projects",project:"/projects/:pk",updateProject:"PATCH:/projects/:pk",createProject:"POST:/projects",deleteProject:"DELETE:/projects/:pk",configTemplates:"/templates",validateConfig:"POST:/projects/:pk/validate",createSampleTask:"POST:/projects/:pk/sample-task",fileUploads:"/projects/:pk/file-uploads",deleteFileUploads:"DELETE:/projects/:pk/file-uploads",importFiles:"POST:/projects/:pk/import",reimportFiles:"POST:/projects/:pk/reimport",dataSummary:"/projects/:pk/summary",deleteTabs:"DELETE:/dm/views/reset",listStorages:"/storages/:target?",storageTypes:"/storages/:target?/types",storageForms:"/storages/:target?/:type/form",createStorage:"POST:/storages/:target?/:type",deleteStorage:"DELETE:/storages/:target?/:type/:pk",updateStorage:"PATCH:/storages/:target?/:type/:pk",syncStorage:"POST:/storages/:target?/:type/:pk/sync",validateStorage:"POST:/storages/:target?/:type/validate",mlBackends:"GET:/ml",mlBackend:"GET:/ml/:pk",addMLBackend:"POST:/ml",updateMLBackend:"PATCH:/ml/:pk",deleteMLBackend:"DELETE:/ml/:pk",trainMLBackend:"POST:/ml/:pk/train",predictWithML:"POST:/ml/:pk/predict",modelVersions:"/projects/:pk/model-versions",mlInteractive:"POST:/ml/:pk/interactive-annotating",export:"/projects/:pk/export",previousExports:"/projects/:pk/export/files",exportFormats:"/projects/:pk/export/formats",version:"/version",webhooks:"/webhooks",webhook:"/webhooks/:pk",updateWebhook:"PATCH:/webhooks/:pk",createWebhook:"POST:/webhooks",deleteWebhook:"DELETE:/webhooks/:pk",webhooksInfo:"/webhooks/info"},alwaysExpectJSON:!1};function mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ht=new class{constructor(e){var t,n,a,s,l;mt(this,"gateway",null),mt(this,"commonHeaders",{}),mt(this,"mockDelay",0),mt(this,"mockDisabled",!1),mt(this,"requestMode","same-origin"),mt(this,"sharedParams",{}),this.commonHeaders=null!==(t=e.commonHeaders)&&void 0!==t?t:{},this.gateway=this.resolveGateway(e.gateway),this.requestMode=this.detectMode(),this.mockDelay=null!==(n=e.mockDelay)&&void 0!==n?n:0,this.mockDisabled=null!==(a=e.mockDisabled)&&void 0!==a&&a,this.sharedParams=null!==(s=e.sharedParams)&&void 0!==s?s:{},this.alwaysExpectJSON=null===(l=e.alwaysExpectJSON)||void 0===l||l,this.resolveMethods(e.endpoints)}isValidMethod(e){return this[e]instanceof Function}resolveGateway(e){if(e instanceof URL)return e.toString();try{return new URL(e).toString()}catch(t){const n=new URL(window.location.href);return n.search="",n.hash="","/"===e[0]?n.pathname=e.replace(/([/])$/,""):n.pathname=`${n.pathname}/${e}`.replace(/([/]+)/g,"/").replace(/([/])$/,""),n.toString()}}detectMode(){return window.location.origin===new URL(this.gateway).origin?"same-origin":"cors"}resolveMethods(e,t){if(e){new Map(Object.entries(e)).forEach(((e,n)=>{const{scope:a,...s}=this.getSettings(e);Object.defineProperty(this,n,{value:this.createApiCallExecutor(s,[t])}),Object.defineProperty(this,`${n}Raw`,{value:this.createApiCallExecutor(s,[t],!0)}),a&&this.resolveMethods(a,[...null!=t?t:[],s.path])}))}}createApiCallExecutor(e,t,n=!1){return async(a,{headers:s,body:l}={})=>{let r,i;try{var o,c,d,u;const p={...null!=a?a:{},...null!==(o=this.sharedParams)&&void 0!==o?o:{}},{method:m,url:h}=this.createUrl(e.path,p,t),f=null!=m?m:(null!==(c=e.method)&&void 0!==c?c:"get").toUpperCase(),v=Object.assign(this.getDefaultHeaders(f),null!==(d=this.commonHeaders)&&void 0!==d?d:{},null!==(u=e.headers)&&void 0!==u?u:{},null!=s?s:{}),g=new Headers(v),x={method:f,headers:g,mode:this.requestMode,credentials:"cors"===this.requestMode?"omit":"same-origin"};if("GET"!==f){const e=g.get("Content-Type"),{sharedParams:t}=this;let n=null!=l?l:{};n instanceof FormData?Object.entries(null!=t?t:{}).forEach((([e,t])=>{n.append(e,t)})):Object.assign(n,{...null!=t?t:{},...null!=l?l:{}}),n instanceof FormData?x.body=n:x.body="multipart/form-data"===e?this.createRequestBody(n):"application/json"===e?this.bodyToJSON(n):n,"multipart/form-data"===e&&g.delete("Content-Type")}let j;if(e.mock,j=await fetch(h,x),i={headers:new Map(Array.from(j.headers)),status:j.status,url:j.url},n)return j;if(j.ok){const t=await j.text();try{const n=204!==j.status?JSON.parse(this.alwaysExpectJSON?t:t||"{}"):{ok:!0};if(e.convert instanceof Function)return await e.convert(n);r=n}catch(e){r=this.generateException(e,t)}}else r=this.generateError(j)}catch(e){r=this.generateException(e)}return Object.defineProperty(r,"$meta",{value:i,configurable:!1,enumerable:!1,writable:!1}),r}}getSettings(e){return"string"==typeof e&&(e={path:e}),{method:"GET",mock:void 0,convert:void 0,scope:void 0,...e}}getDefaultHeaders(e){switch(e){case"POST":case"PATCH":case"DELETE":return{"Content-Type":"application/json"};default:return{}}}createUrl(e,t={},n){const a=new URL(this.gateway),s=[],{path:l,method:r}=this.resolveEndpoint(e,t),i=[].concat(...null!=n?n:[],l).filter((e=>void 0!==e)).join("/").replace(/([/]+)/g,"/").replace(/:([^/]+)/g,((...e)=>{const n=e[1],[a,l]=n.match(/([^?]+)(\??)/).slice(1,3),r=t[a];if(s.push(a),void 0===r){if("?"===l)return"";throw new Error(`Can't find key \`${a}\` in data`)}return r}));return a.pathname+=i.replace(/\/+/g,"/").replace(/\/+$/g,""),t&&"object"==typeof t&&Object.entries(t).forEach((([e,t])=>{s.includes(e)||a.searchParams.set(e,t)})),{url:a.toString(),method:r}}resolveEndpoint(e,t){var n;let a;a=e instanceof Function?e(t):e;const s=/^(GET|POST|PATCH|DELETE|PUT|HEAD|OPTIONS):/;return{method:null===(n=a.match(s))||void 0===n?void 0:n[1],path:a.replace(s,"")}}createRequestBody(e){if(e instanceof FormData)return e;const t=new FormData;return Object.entries(e).forEach((([e,n])=>{t.append(e,n)})),t}bodyToJSON(e){const t=(e=>{if(e instanceof FormData){const t=e.entries();return Array.from(t).reduce(((e,[t,n])=>({...e,[t]:n})),{})}return e})(e);return JSON.stringify(t)}async generateError(e,t){var n;const a=(async()=>{const t=await e.text();try{return JSON.parse(t)}catch(e){return t}})();return{status:e.status,error:(null!==(n=null==t?void 0:t.message)&&void 0!==n?n:e.statusText)||"Server Error",response:await a}}generateException(e,t){console.error(e);return{error:e.message,details:(()=>{try{return JSON.parse(t)}catch(e){return t}})()}}mockRequest(e,t,n,a){return new Promise((async s=>{let l=null,r=!0;try{const s=new Request(n);"string"==typeof n.body&&(s.body=JSON.parse(n.body)),l=await a.mock(e,null!=t?t:{},s)}catch(e){console.error(e),r=!1}setTimeout((()=>{s({ok:r,json:()=>Promise.resolve(l)})}),this.mockDelay)}))}}(pt),ft=(0,r.createContext)();ft.displayName="ApiContext";let vt=!1;const gt=e=>{var t,n,a,s;const{response:l}=e;return{isShutdown:"Failed to fetch"===String(null!==(t=null==l?void 0:l.detail)&&void 0!==t?t:null==e?void 0:e.error),title:e.error?"Runtime error":"Server error",message:null!==(n=null==l?void 0:l.detail)&&void 0!==n?n:null==e?void 0:e.error,stacktrace:null!==(a=null==l?void 0:l.exc_info)&&void 0!==a?a:null,version:null==l?void 0:l.version,validation:Object.entries(null!==(s=null==l?void 0:l.validation_errors)&&void 0!==s?s:{})}},xt=async(e,t=!0)=>{let n=e;if(n instanceof Response&&(n=await ht.generateError(e)),401===e.status)return void(location.href=Re("/"));const{isShutdown:a,...s}=gt(n);return t&&dt({allowClose:!a,body:a?(0,Le.jsx)(Ze,{possum:!1,title:"Connection refused",message:"Server not responding. Is it still running?"}):(0,Le.jsx)(Ze,{...s}),simple:!0,style:{width:680}}),a},jt=(0,r.forwardRef)((({children:e},t)=>{const[n,a]=(0,r.useState)(null),s=(0,r.useCallback)((async(e,{params:t={},errorFilter:n,...s}={})=>{if(vt)return;a(null);const r=await ht[e](t,s);if(401===r.status)return vt=!0,void(location.href=Re("/"));if(r.error){const e=!1===(null==n?void 0:n(r));if(!n||e){a(r);const e=await xt(r,l.showModal);return vt=vt||e,null}}return r}),[]),l=(0,r.useMemo)((()=>({api:ht,callApi:s,handleError:xt,error:n,showModal:!0,errorFormatter:gt,isValidMethod:(...e)=>ht.isValidMethod(...e)})),[n]);return(0,r.useEffect)((()=>{t&&(t.current=l)}),[t]),(0,Le.jsx)(ft.Provider,{value:l,children:e})})),bt=()=>(0,r.useContext)(ft),yt=r.createContext({});yt.displayName="AppStoreContext";const wt=({children:e})=>{const[t,n]=r.useState({}),a=r.useCallback((e=>{n({...t,...null!=e?e:{}})}),[t]),s=r.useMemo((()=>({store:t,update:a})),[t,a]);return(0,Le.jsx)(yt.Provider,{value:s,children:e})},kt=()=>r.useContext(yt),Ct=new Map,St=new Map,Et=(0,r.createContext)({}),Nt=({libraries:e,children:t})=>{const n=(0,r.useMemo)((()=>(e=>async t=>{var n;const{scriptSrc:a,cssSrc:s,checkAvailability:l}=e[t],r=l(),i=null!==(n=Ct.get(t))&&void 0!==n?n:new Set;if(Ct.set(t,i),r)return r;const o=new Promise((e=>{i.add((()=>{setTimeout((()=>{e(l())}),10)}))}));return St.has(t)||St.set(t,(async()=>{const e=[];a&&e.push(new Promise((e=>{const t=document.createElement("script");t.type="text/javascript",t.onload=()=>{e()},t.src=a,t.dataset.replaced=!0,document.head.appendChild(t)}))),s&&e.push(new Promise((e=>{const t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.onload=()=>{e()},t.href=s,t.dataset.replaced=!0,document.head.appendChild(t)}))),await Promise.all(e),i.forEach((e=>e()))})()),o})(e)),[e]);return(0,Le.jsx)(Et.Provider,{value:{requestLibrary:n},children:t})},At=e=>{const t=(0,r.useContext)(Et),[n,a]=(0,r.useState)(),s=(0,r.useCallback)((async()=>{const n=await t.requestLibrary(e);a(!!n)}),[t,e]);return(0,r.useEffect)((()=>{s()}),[s]),n};var Pt=a(5003),Tt=a(1897);const Ot=(e,t,n="bottom-left",a=0)=>{let s=0,l=0;const r=((e,t)=>{const n=e.getBoundingClientRect(),a=t.getBoundingClientRect();return{source:n,target:a,get top(){return n.top-a.height},get bottom(){return n.top+n.height},get horizontalCenter(){return n.left+n.width/2-a.width/2},get horizontalLeft(){return n.left},get horizontalRight(){return n.left+n.width-a.width}}})(e,t);let i=n.split("-");switch(n){case"top-center":l=r.top-a,s=r.horizontalCenter;break;case"top-left":l=r.top-a,s=r.horizontalLeft;break;case"top-right":l=r.top-a,s=r.horizontalRight;break;case"bottom-center":l=r.bottom+a,s=r.horizontalCenter;break;case"bottom-left":l=r.bottom+a,s=r.horizontalLeft;break;case"bottom-right":l=r.bottom+a,s=r.horizontalRight}return l<window.scrollX?(l=r.bottom+a,i[0]="bottom"):l+r.target.height>window.scrollX+window.innerHeight&&(l=r.top-a,i[0]="top"),s<0?(s=r.horizontalLeft,i[1]="left"):s+r.target.width>window.innerWidth&&(s=r.horizontalRight,i[1]="right"),{top:l,left:s,pos:r,align:i.join("-")}},Rt=r.createContext(),Dt=(0,r.forwardRef)((({tag:e,children:t,dropdown:n,content:a,toggle:s,closeOnClickOutside:l=!0,...i},o)=>{var c,d,u;const p=null!==(c=null!=o?o:n)&&void 0!==c?c:(0,r.useRef)(),m=r.Children.only(t),[h]=(0,r.useState)(new Set),f=null!==(d=m.props.ref)&&void 0!==d?d:(0,r.useRef)(),v=(0,r.useContext)(Rt),g=(0,r.useCallback)((e=>{var t,n,a,s,l;const r=null===(t=f.current)||void 0===t||null===(n=t.contains)||void 0===n?void 0:n.call(t,e),i=null===(a=p.current)||void 0===a||null===(s=a.dropdown)||void 0===s||null===(l=s.contains)||void 0===l?void 0:l.call(s,e),o=Array.from(h).reduce(((t,n)=>t||n.hasTarget(e)),!1);return r||i||o}),[f,p]),x=(0,r.useCallback)((e=>{var t,n;l&&(g(e.target)||null===(t=p.current)||void 0===t||null===(n=t.close)||void 0===n||n.call(t))}),[l,g]),j=(0,r.useCallback)((e=>{var t,n,a,l,r;return(null===(t=p.current)||void 0===t||null===(n=t.dropdown)||void 0===n||null===(a=n.contains)||void 0===a?void 0:a.call(n,e.target))?e.stopPropagation():!1===s?null==p||null===(l=p.current)||void 0===l?void 0:l.open():void(null==p||null===(r=p.current)||void 0===r||r.toggle())}),[p]),b=(0,r.cloneElement)(m,{...m.props,tag:e,key:"dd-trigger",ref:f,onClickCapture:null!==(u=m.props)&&void 0!==u&&u.onClick?null:j}),y=a?(0,Le.jsx)(Lt,{...i,ref:p,children:a}):null;(0,r.useEffect)((()=>(document.addEventListener("click",x,{capture:!0}),()=>document.removeEventListener("click",x,{capture:!0}))),[x]);const w=(0,r.useMemo)((()=>({triggerRef:f,dropdown:p,hasTarget:g,addChild:e=>h.add(e),removeChild:e=>h.delete(e),open:()=>{var e,t;return null==p||null===(e=p.current)||void 0===e||null===(t=e.open)||void 0===t?void 0:t.call(e)},close:()=>{var e,t;return null==p||null===(e=p.current)||void 0===e||null===(t=e.close)||void 0===t?void 0:t.call(e)}})),[f,p]);return(0,r.useEffect)((()=>{if(v)return v.addChild(w),()=>v.removeChild(w)}),[]),(0,Le.jsxs)(Rt.Provider,{value:w,children:[b,y]})}));let _t=1;const Lt=(0,r.forwardRef)((({animated:e=!0,visible:t=!1,...n},a)=>{var s,l;const o=Ie("dropdown"),c=(0,r.useRef)(),{triggerRef:d}=null!==(s=(0,r.useContext)(Rt))&&void 0!==s?s:{},u=void 0===d,{children:p}=n,[m,h]=(0,r.useState)(t),[f,v]=(0,r.useState)(t),[g,x]=(0,r.useState)({}),[j,b]=(0,r.useState)(t?"visible":null),y=(0,r.useCallback)((()=>{var e,t;const a=c.current,s=null!==(e=null==d?void 0:d.current)&&void 0!==e?e:a.parentNode,{left:l,top:r}=Ot(s,a,`bottom-${null!==(t=n.align)&&void 0!==t?t:"left"}`);x({left:l,top:r})}),[d]),w=(0,r.useMemo)((()=>_t++),[]),k=(0,r.useCallback)((async(t=!1)=>{if(!1!==n.enabled||!0!==t)return new Promise((n=>{const a=c.current;!1!==e?at(a,{transition:()=>{b(t?"appear":"disappear")},beforeTransition:()=>{b(t?"before-appear":"before-disappear")},afterTransition:()=>{b(t?"visible":null),n()}}):(b(t?"visible":null),n())}))}),[e]),C=(0,r.useCallback)((async e=>{var t,a;null===(t=n.onToggle)||void 0===t||t.call(n,e),await k(e),v(e),null===(a=n.onVisibilityChanged)||void 0===a||a.call(n,e)}),[n,k]),S=(0,r.useCallback)((async()=>{!1!==f&&!1!==m&&(await C(!1),h(!1))}),[f,k,n,m]),E=(0,r.useCallback)((async()=>{!0!==f&&!0!==m&&h(!0)}),[f,k,n,m]),N=(0,r.useCallback)((async()=>{!f?E():S()}),[S,f,E]);(0,r.useEffect)((()=>{a&&(a.current={dropdown:c.current,visible:null!==j,toggle:N,open:E,close:S})}),[S,E,a,N,c,j]),(0,r.useEffect)((()=>{v(t)}),[t]),(0,r.useEffect)((()=>{u||"before-appear"!==j||y()}),[j,y,u]),(0,r.useEffect)((()=>{!1===n.enabled&&k(!1)}),[n.enabled]),(0,r.useEffect)((()=>{m&&C(!0)}),[m]);const A=p.props&&"Menu"===p.props.type?(0,r.cloneElement)(p,{...p.props,className:o.elem("menu").mix(p.props.className)}):p,P=(0,r.useMemo)((()=>{switch(j){case"before-appear":return"before-appear";case"appear":return"appear before-appear";case"before-disappear":return"before-disappear";case"disappear":return"disappear before-disappear";case"visible":return"visible";default:return t?"visible":null}}),[j,t]),T={...null!==(l=n.style)&&void 0!==l?l:{},...null!=g?g:{},zIndex:1e3+w},O=(0,Le.jsx)($e,{ref:c,name:"dropdown",mix:[n.className,P],style:T,onClick:e=>e.stopPropagation(),children:A});return m?!0===n.inline?O:i.createPortal(O,document.body):null}));Lt.displayName="Dropdown",Lt.Trigger=Dt,Lt.Trigger=Dt;const Mt=r.createContext(),{Block:Ft,Elem:It}=ze(),zt=(0,r.forwardRef)((({children:e,className:t,style:n,size:a,selectedKeys:s,closeDropdownOnItemClick:l},i)=>{const o=(0,r.useContext)(Rt),c=(0,r.useMemo)((()=>new Set(null!=s?s:[])),[s]),d=(0,r.useCallback)((e=>{const t=Ie("main-menu").elem("item").closest(e.target);o&&t&&!1!==l&&o.close()}),[o]),u=(0,r.useMemo)((()=>!!o),[o]);return(0,Le.jsx)(Mt.Provider,{value:{selected:c},children:(0,Le.jsx)(Ft,{ref:i,tag:"ul",name:"main-menu",mod:{size:a,collapsed:u},mix:t,style:n,onClick:d,children:e})})}));zt.Item=({children:e,label:t,icon:n,to:a,className:s,href:l,exact:r=!1,forceReload:i=!1,active:o=!1,onClick:c,...d})=>{const u=Ie("main-menu",{elem:"item"}),p=[u.toClassName()];((()=>{const e=location.pathname.replace(/\/$/,""),t=null!=a?a:l;return r?e===t:e.includes(t)})()||o)&&p.push(u.mod({active:!0})),s&&p.push(s);const m=(0,Le.jsxs)(Le.Fragment,{children:[n&&(0,Le.jsx)("span",{className:u.elem("item-icon"),children:n}),null!=e?e:t]}),h={className:p.join(" "),onClick:c,...d},f=u.mod({active:!0}).toClassName(),v=null!=a?a:l;return i&&(h.onClick=()=>location.href=null!=a?a:l),(0,Le.jsx)("li",{children:a?(0,Le.jsx)(Tt.OL,{to:v,...h,exact:r,activeClassName:f,"data-external":!0,children:m}):v?(0,Le.jsx)("a",{href:Re(v),...h,children:m}):(0,Le.jsx)("span",{...h,children:m})})},zt.Spacer=()=>(0,Le.jsx)(It,{block:"main-menu",tag:"li",name:"spacer"}),zt.Divider=()=>(0,Le.jsx)(It,{block:"main-menu",tag:"li",name:"divider"}),zt.Builder=(e,t)=>(null!=t?t:[]).map(((t,n)=>{if("SPACER"===t)return(0,Le.jsx)(zt.Spacer,{},n);if("DIVIDER"===t)return(0,Le.jsx)(zt.Divider,{},n);let a,s;if(Array.isArray(t))[s,a]=t;else{const{menuItem:e,title:n,path:l}=t;a=null!=n?n:e,s=l}if("function"==typeof s)return(0,Le.jsx)(zt.Item,{onClick:s,children:a},n);const l=`${e}${s}`.replace(/([/]+)/g,"/");return(0,Le.jsx)(zt.Item,{to:l,exact:!0,children:a},n)})),zt.Group=({children:e,title:t,className:n,style:a})=>(0,Le.jsxs)(Ft,{name:"menu-group",mix:n,style:a,children:[(0,Le.jsx)(It,{name:"title",children:t}),(0,Le.jsx)(It,{tag:"ul",name:"list",children:e})]});const{Block:$t,Elem:Bt}=ze(),Ht=()=>{const e=Qe(),t=il(),n=rl(),[a,s]=(0,r.useState)(t);return(0,r.useEffect)((()=>{t.length?s(t):e.breadcrumbs&&s(e.breadcrumbs)}),[t,e]),(0,Le.jsx)($t,{name:"breadcrumbs",children:(0,Le.jsx)(Bt,{tag:"ul",name:"list",children:a.map(((e,t,a)=>{var s;const l=t===a.length-1,r=`item-${t}-${e.title}`,i=null!==(s=e.href)&&void 0!==s?s:e.path,o=null!==n(i),c=(0,Le.jsx)(Bt,{tag:"span",name:"label",mod:{faded:t===e.length-1},children:e.title}),d=e.submenu?(0,Le.jsx)(Lt,{children:(0,Le.jsx)(zt,{children:e.submenu.map(((t,n)=>{var a;return(0,Le.jsx)(zt.Item,{label:t.title,icon:t.icon,href:null!==(a=t.href)&&void 0!==a?a:t.path,active:t.active},`${n}-${e.title}`)}))})}):null;return e.onClick?(0,Le.jsx)(Bt,{tag:"li",name:"item",mod:{last:l},children:(0,Le.jsx)("span",{onClick:e.onClick,children:c})},r):d?(0,Le.jsx)(Bt,{tag:"li",component:Lt.Trigger,name:"item",mod:{last:l},content:d,children:(0,Le.jsx)("span",{children:c})},r):i&&!l?(0,Le.jsx)(Bt,{tag:"li",name:"item",mod:{last:l},children:o?(0,Le.jsx)(Tt.OL,{to:i,"data-external":!0,children:c}):(0,Le.jsx)("a",{href:Re(i),children:c})},r):(0,Le.jsx)(Bt,{tag:"li",name:"item",mod:{last:l},children:c},r)}))})})},Ut=({header:e,extra:t,children:n,style:a})=>{const s=Ie("card");return(0,Le.jsxs)("div",{className:s,style:a,children:[(e||t)&&(0,Le.jsxs)("div",{className:s.elem("header"),children:[(0,Le.jsx)("div",{className:s.elem("header-content"),children:e}),t&&(0,Le.jsx)("div",{className:s.elem("header-extra"),children:t})]}),(0,Le.jsx)("div",{className:s.elem("content"),children:n})]})},Vt=({children:e,count:t,size:n,gap:a})=>{const s=r.useRef(),l={"--columns":Math.max(1,null!=t?t:1),"--column-width":n,"--column-gap":a};return(0,Le.jsx)("div",{ref:s,className:Ie("columns"),style:l,children:e})};Vt.Column=({title:e,children:t})=>(0,Le.jsxs)("div",{className:Ie("columns").elem("item"),children:[(0,Le.jsx)("div",{className:Ie("columns").elem("title"),children:e}),t]});const qt=({opened:e,animated:t=!0})=>{const n=Ie("hamburger");return(0,Le.jsxs)("span",{className:n.mod({animated:t,opened:e}),children:[(0,Le.jsx)("span",{}),(0,Le.jsx)("span",{}),(0,Le.jsx)("span",{})]})};var Wt=a(1049),Gt=a(9081);const Jt=new Set,Kt=(e,t)=>!![null,void 0,"","text/javascript"].includes(e.type)&&((void 0!==e.dataset.alwaysReload||!0===t||!Jt.has(e.outerHTML))&&!!e.parentNode),Zt=(e,t)=>new Promise((n=>{var a;const s=document.createElement("script"),l=(t=null!==(a=t)&&void 0!==a?a:e).src||(e=>{const t=new Blob([e],{type:"text/javascript"});return URL.createObjectURL(t).toString()})(t.text);if(Jt.add(t.outerHTML),t.async)n();else{const e=({type:t})=>{s.removeEventListener("load",e),s.removeEventListener("error",e),n("error"!==t&&s)};s.addEventListener("load",e),s.addEventListener("error",e)}void 0!==t.dataset.alwaysReload&&(s.dataset.alwaysReload=""),t.id&&(s.id=t.id),t.className&&(s.className=t.className),s.dataset.replaced="true",s.async=t.async,s.defer=t.defer,s.type="text/javascript",s.src=l,e.parentNode.insertBefore(s,e),e.remove()})),Xt=async(e,{sourceScript:t,forceUpdate:n=!1}={})=>{var a;if(t=null!==(a=t)&&void 0!==a?a:e,Kt(e,n)&&(t===e||Kt(t,n)))return Zt(e,t)},Yt=async e=>{const t=e.querySelectorAll("script");if(!t.length)return[];const n=function*(e){for(;e.length;){const t=e.shift();yield Xt(t).then((e=>e))}}(Array.from(t)),a=[];for await(const e of n)a.push(e);return a},Qt=new Map,en=async(e,t)=>{e&&t&&(e.replaceWith(t),await Yt(t))},tn=async(e,t)=>{const n=["style:not([data-replaced])","link[rel=stylesheet]:not([data-replaced])"].join(", "),a=Array.from(e.querySelectorAll(n)),s=Array.from(t.querySelectorAll(n)),l=(r=a,new Set(Array.from(r).map((e=>e.outerHTML))));var r;const i=s.filter((e=>!l.has(e.outerHTML)));await Promise.all(i.map((e=>new Promise((t=>{e.onload=()=>t(e.outerHTML),document.head.append(e)})))))},nn=async(e,t)=>{document.title=e.title,await tn(document,e),await(async(e,t)=>{en(e.querySelector("title"),t.querySelector("title"));const n=document.createDocumentFragment();Array.from(t.querySelectorAll("script")).filter((e=>Kt(e))).forEach((e=>n.appendChild(e))),Array.from(e.querySelectorAll("script")).filter((e=>Kt(e))).forEach((e=>e.remove())),e.appendChild(n),await Yt(e)})(document.head,e.head),await(async(e,t)=>{const n=e.querySelector("script#app-settings"),a=t.querySelector("script#app-settings");n&&a&&await Xt(n,{sourceScript:a,forceUpdate:!0})})(document,e),await(async(e,t)=>{const n=e.querySelector("#dynamic-content"),a=t.querySelector("#dynamic-content");n&&a?await en(n,a):await en(e.body.children[0],a)})(document,e),null==t||t()},an=()=>{const{href:e}=location;return e.replace(/#(.*)/g,"")},sn=async e=>{const t=await(async e=>{try{if(Qt.has(e))return Qt.get(e);{const t=await fetch(e),n=await t.text();return 401===t.status?void(location.href=Re("/")):t.ok?(Qt.set(e,n),n):(dt({body:()=>(0,Le.jsx)(Ze,{title:`Error ${t.status}: ${t.statusText}`,errorId:t.status,stacktrace:`Cannot load url ${e}\n\n${n}`}),allowClose:!1,style:{width:680}}),null)}}catch(e){return dt({body:()=>(0,Le.jsx)(Ze,{possum:!1,title:"Connection refused",message:"Server not responding. Is it still running?"}),simple:!0,allowClose:!1,style:{width:680}}),null}})(e);return t?(e=>(new DOMParser).parseFromString(e,"text/html"))(t):null};let ln=an();const rn=(e,t)=>{const[n,a]=(0,r.useState)(e);return[n,(0,r.useCallback)((async e=>{ln=e,Jt.clear();const n=await sn(e);return!!n&&(await nn(n,t),a(n),!0)}),[])]},on=(0,r.createContext)(null),cn=(on.Consumer,({children:e})=>{const t=document,n=(0,o.k6)(),a=(0,r.useContext)(Xe),s=(0,r.useCallback)((()=>{a.update(window.APP_SETTINGS)}),[]),[l,i]=rn(t,s),c=(0,r.useCallback)((async e=>{const t=e.target.closest("a[href]:not([target]):not([download])");if(!(e=>!!e&&!e.dataset.external&&!e.getAttribute("href").match(/#/)&&e.origin===location.origin)(t))return;if(t.matches("[data-external]"))return;if(e.metaKey||e.ctrlKey)return;e.preventDefault();await i(t.href)&&n.push(`${(e=>{if(APP_SETTINGS.hostname){const t=APP_SETTINGS.hostname,n=new URL(t).pathname.replace(/([/]+)$/,"");return e.replace(new RegExp(`^${n}`),"")}return e||"/"})(t.pathname)}${t.search}`)}),[]),d=(0,r.useCallback)((()=>{const e=an();e===ln||(ln=e,i(e))}),[]);return(0,r.useEffect)((()=>(document.addEventListener("click",c,{capture:!0}),window.addEventListener("popstate",d),()=>{document.removeEventListener("click",c,{capture:!0}),window.removeEventListener("popstate",d)})),[]),(0,Le.jsx)(on.Provider,{value:l,children:e})}),dn=(e,t,n,a)=>{let s,l=!1;if(!n||0===n.length||n instanceof Function){var r;const i=t.querySelector(`template#${e}`),o=null!==(r=i.innerHTML)&&void 0!==r?r:"";if(a){const e=(0,Gt.ZP)(o);s=n instanceof Function&&n(e)||e}else{const e=n instanceof Function&&n(i);e?s=e:(s=o,l=!0)}}else s=n;return{children:s,setInnerHTML:l}},un=r.forwardRef((({id:e,tagName:t,children:n,source:a,onRenderFinished:s,parse:l=!1,raw:i=!1,...o},c)=>{const d=null!=c?c:r.useRef(),[u,p]=r.useState(dn(e,a,n,l));return r.useEffect((()=>{p(dn(e,a,n,l))}),[a,n]),r.useEffect((()=>{d.current&&Yt(d.current),null==s||s()}),[u]),u.setInnerHTML?o.dangerouslySetInnerHTML={__html:u.children}:o.children=u.children,!0===i&&u.children?(0,Le.jsx)(r.Fragment,{children:u.children}):r.createElement(null!=t?t:"div",{...o,ref:d})})),pn=r.forwardRef(((e,t)=>{const n=r.useContext(on);return n?(0,Le.jsx)(un,{...e,source:n,ref:t}):null})),mn=(0,r.forwardRef)((({title:e,children:t,defaultVisible:n,disabled:a,style:s},l)=>{if(!t||Array.isArray(t))throw new Error("Tooltip does accept a single child only");const o=null!=l?l:(0,r.useRef)(),c=(0,r.useRef)(),[d,u]=(0,r.useState)({}),[p,m]=(0,r.useState)(n?"visible":null),[h,f]=(0,r.useState)(!1),[v,g]=(0,r.useState)("top-center"),x=(0,r.useCallback)((()=>{const{left:e,top:t,align:n}=Ot(o.current,c.current,v,10);u({left:e,top:t}),g(n)}),[o.current,c.current]),j=(0,r.useCallback)((e=>{c.current&&at(c.current,{beforeTransition(){m(e?"before-appear":"before-disappear")},transition(){e&&x(),m(e?"appear":"disappear")},afterTransition(){m(e?"visible":null),!1===e&&f(!1)}})}),[h,x,c]),b=(0,r.useMemo)((()=>{switch(p){case"before-appear":return"before-appear";case"appear":return"appear before-appear";case"before-disappear":return"before-disappear";case"disappear":return"disappear before-disappear";case"visible":return"visible";default:return p?"visible":null}}),[p]),y=(0,r.useMemo)((()=>h?(0,Le.jsx)($e,{ref:c,name:"tooltip",mod:{align:v},mix:b,style:{...d,...null!=s?s:{}},children:(0,Le.jsx)(Be,{name:"body",children:e})}):null),[h,d,e,b,c]),w=r.Children.only(t),k=(0,r.cloneElement)(w,{...w.props,ref:o,onMouseEnter(e){var t,n;!0!==a&&(f(!0),null===(t=(n=w.props).onMouseEnter)||void 0===t||t.call(n,e))},onMouseLeave(e){var t,n;!0!==a&&(j(!1),null===(t=(n=w.props).onMouseLeave)||void 0===t||t.call(n,e))}});return(0,r.useEffect)((()=>{h&&j(!0)}),[h]),(0,Le.jsxs)(Le.Fragment,{children:[k,(0,i.createPortal)(y,document.body)]})}));mn.displayName="Tooltip";const hn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",fn=(0,r.forwardRef)((({username:e,size:t,src:n,user:a,className:s,showUsername:l,style:i,...o},c)=>{var d;const u=(0,r.useRef)(),[p,m]=(0,r.useState)(e),[h,f]=(0,r.useState)(null!==(d=null==a?void 0:a.avatar)&&void 0!==d?d:n),[v,g]=(0,r.useState)(!1),[x,j]=(0,r.useState)(!0);t&&(i=Object.assign({width:t,height:t,fontSize:.4*t},i)),(0,r.useEffect)((()=>{if(a){const{first_name:e,last_name:t,email:n,initials:s,username:l}=a;s?m(s):l?m(l):e&&t?m(`${e[0]}${t[0]}`):n&&m(n.substring(0,2)),a.avatar&&f(a.avatar)}else m(e),f(n)}),[a]);const b=(0,r.useCallback)((()=>{g(!0),h!==hn&&j(!1)}),[h]),y=(0,Le.jsxs)($e,{ref:c,name:"userpic",mix:s,style:i,...o,children:[(0,Le.jsx)(Be,{tag:"img",name:"avatar",ref:u,src:h,alt:(null!=p?p:"").toUpperCase(),style:{opacity:v?1:0},onLoad:b,onError:()=>f(hn)}),x&&(0,Le.jsx)(Be,{tag:"span",name:"username",children:(null!=p?p:"").toUpperCase()})]}),w=(0,r.useMemo)((()=>{var t,n;return null!=a&&a.first_name||null!=a&&a.last_name?`${null!==(t=null==a?void 0:a.first_name)&&void 0!==t?t:""} ${null!==(n=null==a?void 0:a.last_name)&&void 0!==n?n:""}`.trim():null!=a&&a.email?a.email:e}),[a,e]);return l&&w?(0,Le.jsx)(mn,{title:w,children:y}):y}));fn.displayName="Userpic";var vn=a(5832);const gn=(0,r.createContext)(),xn=({children:e})=>{const t=bt(),[n,a]=(0,r.useReducer)(((e,t)=>{if("fetch-version"===t.type)return{...e,...t.payload}})),s=(0,r.useCallback)((async()=>{const e=await t.callApi("version");if(null!==e){const t=e["label-studio-os-package"];a({type:"fetch-version",payload:{version:t.version,latestVersion:t.latest_version_from_pypi,newVersion:t.current_version_is_outdated,updateTime:(0,vn.Z)(new Date(t.latest_version_upload_time),"MMM d")}})}}),[t]);return(0,r.useEffect)((()=>{s()}),[]),(0,Le.jsx)(gn.Provider,{value:n,children:e})},jn=(0,r.createContext)(),bn=({className:e})=>(0,Le.jsx)(pn,{id:"context-menu-left",className:e,children:e=>(0,Le.jsx)(Ht,{fromTemplate:e})}),yn=({className:e,...t})=>{const{ContextComponent:n,contextProps:a}=cl();return n?(0,Le.jsx)("div",{className:e,children:(0,Le.jsx)(n,{...t,...null!=a?a:{}})}):(0,Le.jsx)(pn,{id:"context-menu-right",className:e})},wn=({enabled:e,defaultOpened:t,defaultPinned:n,children:a,onSidebarToggle:s,onSidebarPin:l})=>{const i=(0,r.useRef)(),o=(0,r.useRef)(),c=dl(),d=Qe(),[u,p]=(0,r.useState)(null!=t&&t),[m,h]=(0,r.useState)(null!=n&&n),[f,v]=(0,r.useState)({Component:null,props:{}}),g=Ie("menu-header"),x=g.elem("context"),j=Ie("sidebar"),b=Ie("content-wrapper"),y=g.elem("context-item"),w=(0,r.useCallback)((e=>{e.preventDefault();const t=!m;h(t),null==l||l(t)}),[m]),k=(0,r.useCallback)((e=>{const t=e;p(t),null==s||s(t)}),[u]),C=(0,r.useMemo)((()=>({PageContext:f,setContext(e){setTimeout((()=>{v({...f,Component:e})}))},setProps(e){setTimeout((()=>{v({...f,props:e})}))},contextIsSet:e=>f.Component===e})),[f]);return(0,r.useEffect)((()=>{var e,t;m||(null==i||null===(t=i.current)||void 0===t||t.close());null==o||null===(e=o.current)||void 0===e||e.close()}),[c]),(0,Le.jsxs)("div",{className:b,children:[e&&(0,Le.jsxs)("div",{className:g,children:[(0,Le.jsx)(Lt.Trigger,{dropdown:i,closeOnClickOutside:!m,children:(0,Le.jsxs)("div",{className:`${g.elem("trigger")} main-menu-trigger`,children:[(0,Le.jsx)("span",{style:{color:"#09f",fontWeight:"bold"},children:"数字大脑数据标注平台"}),(0,Le.jsx)(qt,{opened:u})]})}),(0,Le.jsxs)("div",{className:x,children:[(0,Le.jsx)(bn,{className:y.mod({left:!0})}),(0,Le.jsx)(yn,{className:y.mod({right:!0})})]}),(0,Le.jsx)(Lt.Trigger,{ref:o,align:"right",content:(0,Le.jsxs)(zt,{children:[(0,Le.jsx)(zt.Item,{icon:(0,Le.jsx)(pe,{}),label:(0,Wt.t)("Account & Settings"),href:"/user/account","data-external":!0}),(0,Le.jsx)(zt.Item,{icon:(0,Le.jsx)(E,{}),label:(0,Wt.t)("Log Out"),href:Re("/logout"),"data-external":!0})]}),children:(0,Le.jsx)("div",{className:g.elem("user"),children:(0,Le.jsx)(fn,{user:d.user})})})]}),(0,Le.jsx)(xn,{children:(0,Le.jsxs)("div",{className:b.elem("body"),children:[e&&(0,Le.jsx)(Lt,{ref:i,onToggle:k,onVisibilityChanged:()=>window.dispatchEvent(new Event("resize")),visible:u,className:[j,j.mod({floating:!m})].join(" "),style:{width:240},children:(0,Le.jsxs)(zt,{children:[(0,Le.jsx)(zt.Item,{label:(0,Wt.t)("Projects"),to:"/projects",icon:(0,Le.jsx)(z,{}),"data-external":!0,exact:!0}),(0,Le.jsx)(zt.Item,{label:(0,Wt.t)("Organization"),to:"/organization",icon:(0,Le.jsx)(ee,{}),"data-external":!0,exact:!0}),(0,Le.jsx)(zt.Spacer,{}),(0,Le.jsx)(zt.Divider,{}),(0,Le.jsx)(zt.Item,{icon:(0,Le.jsx)(se,{}),className:j.elem("pin"),onClick:w,active:m,children:m?"Unpin menu":"Pin menu"})]})}),(0,Le.jsx)(jn.Provider,{value:C,children:(0,Le.jsx)("div",{className:b.elem("content").mod({withSidebar:m&&u}),children:a})})]})})]})},kn=({children:e,menu:t,path:n,menuItems:a})=>{const s=Ie("sidebar-menu");return(0,Le.jsxs)("div",{className:s,children:[a&&a.length>1?(0,Le.jsx)("div",{className:s.elem("navigation"),children:(0,Le.jsx)(zt,{children:a?zt.Builder(n,a):t})}):null,(0,Le.jsx)("div",{className:s.elem("content"),children:e})]})},Cn=({className:e,style:t,size:n=32,stopped:a=!1})=>{const s=Ie("spinner"),l="number"==typeof n?`${n}px`:n;return(0,Le.jsx)("div",{className:s.mix(e),style:{...null!=t?t:{},"--spinner-size":l},children:(0,Le.jsxs)("div",{className:s.elem("body").mod({stopped:a}),children:[(0,Le.jsx)("span",{}),(0,Le.jsx)("span",{}),(0,Le.jsx)("span",{}),(0,Le.jsx)("span",{})]})})},Sn=({className:e,style:t,big:n,items:a,active:s,onSelect:l})=>{const r=Ie("toggle-items");return(0,Le.jsx)("ul",{className:r.mod({big:n}).mix(e).toString(),style:t,children:Object.keys(a).map((e=>(0,Le.jsx)("li",{className:r.elem("item").mod({active:e===s}).toString(),onClick:()=>l(e),children:a[e]},e)))})},En=(e,t)=>{const n=(0,r.useMemo)((()=>{var n;return null!==(n=null!=e?e:t)&&void 0!==n?n:""}),[e,t]),[a,s]=(0,r.useState)(n);return(0,r.useEffect)((()=>{s(n)}),[n]),[a,s]};var Nn=a(4366);const An=({value:e,children:t,className:n})=>{const a=(0,r.useMemo)((()=>Array.isArray(t)?t.find((t=>t.props.case===e))||null:t.props.case===e?t:void 0),[t,e]);return a?r.cloneElement(a,{...a.props,className:[n,a.props.className].join(" ")}):null},Pn=(e,t)=>{if(!Pe(t)||Te(t))return`${e} is required`},Tn=e=>(t,n)=>{if(e="string"==typeof e?new RegExp(e):e,!Te(n)&&null===n.match(e))return`${t} must match the pattern ${e}`},On=(e,t)=>{const n=`${e} must be valid JSON string`;if(Pe(t)&&0!==t.trim().length){if(!1===/^(\{|\[)/.test(t)||!1===/(\}|\])$/.test(t))return n;try{JSON.parse(t)}catch(e){return n}}},Rn=(e,t)=>{try{new RegExp(t)}catch(t){return`${e} must be a valid regular expression`}},Dn=(0,r.forwardRef)((({label:e,name:t,children:n,required:a,validate:l,skip:i,allowEmpty:o,skipAutofill:c,setValue:d,dependency:u,validators:p,...m},h)=>{var f;const v=(0,r.useContext)(He),[g,x]=(0,r.useState)(null),j=null!=h?h:(0,r.useRef)(),b=[...null!=l?l:[]];null==p||null===(f=p.forEach)||void 0===f||f.call(p,(e=>{const[t,n]=e.split(/:(.+)/).slice(0,2),a=s[t];Pe(a)&&(Pe(n)?b.push(a(n)):b.push(a))})),a&&b.push(Pn),(0,r.useEffect)((()=>{if(!v||!u)return;let e=null;const t=v.getFieldContext(u),n=()=>{var e;null===(e=m.onDependencyChanged)||void 0===e||e.call(m,t.field)};return t?(t.field.addEventListener("change",n),e=t.field):console.warn(`Dependency field not found ${u}`),x(e),()=>t.field.removeEventListener("change",n)}),[v,j,u]);const y=(0,r.useCallback)((e=>{if(!j||!j.current)return;const t=j.current;d instanceof Function?d(e):"checkbox"===t.type||"radio"===t.type?t.checked=null!=e?e:t.checked:t.value=null===e?"":e;const n=document.createEvent("HTMLEvents");n.initEvent("change",!1,!0),t.dispatchEvent(n)}),[j]);return(0,r.useEffect)((()=>{const n=c&&!o&&"password"===j.current.type;return null==v||v.registerField({label:e,name:t,validation:b,skip:i,allowEmpty:o,skipAutofill:c,isProtected:n,field:j.current,setValue:y}),()=>null==v?void 0:v.unregisterField(t)}),[j,y]),n(j,g,v)})),_n=({text:e,children:t,required:n,placement:a,description:s,size:l,large:i,style:o,simple:c,flat:d})=>{const u=Ie("label"),p=[u],m=c?"div":"label",h={size:l,large:i,flat:d,placement:a,withDescription:!!s,empty:!t};return p.push(u.mod(h)),(0,r.createElement)(m,{className:p.join(" "),"data-required":n,style:o},(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("div",{className:u.elem("text"),children:(0,Le.jsxs)("div",{className:u.elem("content"),children:[e,s&&(0,Le.jsx)("div",{className:u.elem("description"),children:s})]})}),(0,Le.jsx)("div",{className:u.elem("field"),children:t})]}))},Ln=["ArrowUp","ArrowDown","Backspace","Delete",/[0-9]/],Mn=r.createContext(null),Fn=({type:e})=>{const{currentValue:t,min:n,max:a,disabled:s,ref:l,onClickHandler:i}=r.useContext(Mn),o="increase"===e?a:n;return(0,Le.jsx)(Be,{tag:"a",href:"#",name:"btn",mod:{type:e,disabled:t===o||s},onClick:i(e,l),onMouseDownCapture:e=>e.preventDefault(),children:(0,Le.jsxs)(An,{value:e,children:[(0,Le.jsx)(Nn.iFH,{case:"decrease"}),(0,Le.jsx)(Nn.wEH,{case:"increase"})]})})},In=({label:e,className:t,validate:n,required:a,skip:s,labelProps:l,...i})=>{var o,c,d,u,p;const[m,h]=[null!==(o=i.min)&&void 0!==o?o:-1/0,null!==(c=i.max)&&void 0!==c?c:1/0],f=e=>Math.max(m,Math.min(h,e)),[v,g]=r.useState(f(null!==(d=i.value)&&void 0!==d?d:0)),[x,j]=r.useState(null!==(u=i.autofocus)&&void 0!==u&&u),[b,y]=r.useState(null!==(p=i.disabled)&&void 0!==p?p:null),w=e=>{g(f(Number(e)))},k=r.useCallback((()=>{var e;w((null!=v?v:0)+(null!==(e=i.step)&&void 0!==e?e:1))}),[v,i.step]),C=r.useCallback((()=>{var e;w((null!=v?v:0)-(null!==(e=i.step)&&void 0!==e?e:1))}),[v,i.step]),S=e=>{const t=Ln.find((t=>t instanceof RegExp?t.test(e.key):t===e.key));t||e.metaKey||e.preventDefault(),"ArrowUp"===t?(k(),e.preventDefault()):"ArrowDown"===t&&(C(),e.preventDefault())},E=e=>{const t=e.nativeEvent.clipboardData.getData("text");/([0-9]+)/.test(t)||e.preventDefault()},N=e=>{var t;e.target.value?g(f(Number(e.target.value))):g(""),null===(t=i.onChange)||void 0===t||t.call(i,e)},A=e=>{var t;j(!0),null===(t=i.onFocus)||void 0===t||t.call(i,e)},P=e=>{var t;j(!1),null===(t=i.onBlur)||void 0===t||t.call(i,e)},T=(e,t)=>n=>{var a;return n.preventDefault(),n.stopPropagation(),null===(a=document.activeElement)||void 0===a||a.blur(),j(),t.current.focus(),getSelection().removeAllRanges(),"increase"===e?k():"decrease"===e?C():void 0},O=(0,Le.jsx)(Dn,{label:e,name:i.name,validate:n,required:a,setValue:w,skip:s,onDependencyChanged:e=>{"checkbox"===e.type&&y(!e.checked)},...i,children:(e,n)=>{const a="checkbox"===(null==n?void 0:n.type)&&!1===(null==n?void 0:n.checked)||!1,s=null!=b?b:a,l={currentValue:v,min:m,max:h,disabled:s,ref:e,onClickHandler:T};return(0,Le.jsx)(Mn.Provider,{value:l,children:(0,Le.jsxs)($e,{name:"counter",mod:{focused:x,disabled:s},mix:t,children:[(0,Le.jsx)(Fn,{type:"decrease"}),(0,Le.jsx)(Be,{ref:e,tag:"input",name:"input",type:"text",disabled:s,value:v,onKeyDown:S,onPaste:E,onChange:N,onFocus:A,onBlur:P}),(0,Le.jsx)(Fn,{type:"increase"})]})})}});return e?(0,Le.jsx)(_n,{...null!=l?l:{},text:e,required:a,children:O}):O},zn=({label:e,className:t,validate:n,required:a,skip:s,labelProps:l,ghost:r,...i})=>{const o=[Ie("input").mod({ghost:r}),t].join(" ").trim(),c=(0,Le.jsx)(Dn,{label:e,name:i.name,validate:n,required:a,skip:s,...i,children:e=>(0,Le.jsx)("input",{...i,ref:e,className:o})});return e?(0,Le.jsx)(_n,{...null!=l?l:{},text:e,required:a,children:c}):c},$n=({label:e,className:t,options:n,validate:a,required:s,skip:l,labelProps:i,ghost:o,...c})=>{const d=Ie("select"),u=(0,r.useMemo)((()=>{var e;return null!==(e=c.value)&&void 0!==e?e:""}),[c.value]),[p,m]=(0,r.useState)(u),h=d.mod({ghost:o}).mix(t);(0,r.useEffect)((()=>{m(u)}),[u]);const f=(0,Le.jsx)(Dn,{name:c.name,label:e,validate:a,required:s,skip:l,setValue:e=>m(e),...c,children:e=>(0,Le.jsx)("div",{className:h,children:(0,Le.jsxs)("select",{...c,value:p,onChange:e=>{var t;m(e.target.value),null===(t=c.onChange)||void 0===t||t.call(c,e)},ref:e,className:d.elem("list"),children:[c.placeholder&&(!c.defaulValue||!c.value)&&(0,Le.jsx)("option",{value:"",disabled:!0,hidden:!0,children:c.placeholder}),(null!=n?n:[]).map((e=>{var t,n,a,s;const l=null!==(t=e.value)&&void 0!==t?t:e,r=null!==(n=e.label)&&void 0!==n?n:l,i=null!==(a=e.disabled)&&void 0!==a&&a,o=null!==(s=e.hidden)&&void 0!==s&&s;return(0,Le.jsx)("option",{value:l,disabled:i,hidden:o,children:r},l)}))]})})});return e?(0,Le.jsx)(_n,{...null!=i?i:{},text:e,required:s,children:f}):f},Bn=({label:e,className:t,validate:n,required:a,skip:s,labelProps:l,...r})=>{const i=[Ie("textarea"),t].join(" ").trim(),o=(0,Le.jsx)(Dn,{label:e,name:r.name,validate:n,required:a,skip:s,...r,children:e=>(0,Le.jsx)("textarea",{...r,ref:e,className:i})});return e?(0,Le.jsx)(_n,{...null!=l?l:{},text:e,required:a,children:o}):o},Hn=(0,r.forwardRef)((({className:e,label:t,labelProps:n,description:a,checked:s,defaultChecked:l,onChange:i,validate:o,required:c,skip:d,...u},p)=>{const m=Ie("toggle"),h=(0,r.useMemo)((()=>{var e;return null!==(e=null!=l?l:s)&&void 0!==e&&e}),[l,s]),[f,v]=En(s,null!=l&&l),g=[m],x={};(0,r.useEffect)((()=>{v(h)}),[h]),f&&(x.checked=f),x.disabled=u.disabled,g.push(m.mod(x),e);const j=(0,Le.jsx)(Dn,{ref:t?null:p,label:t,name:u.name,validate:o,required:c,skip:d,setValue:e=>v(e),...u,children:e=>(0,Le.jsxs)("div",{className:g.join(" "),children:[(0,Le.jsx)("input",{ref:e,...u,className:m.elem("input"),type:"checkbox",checked:f,onChange:e=>{v(e.target.checked),null==i||i(e)}}),(0,Le.jsx)("span",{className:m.elem("indicator")})]})});return t?(0,Le.jsx)(_n,{ref:p,placement:"right",required:c,text:t,children:j,description:a,...null!=n?n:{}}):j}));const Un=(e,t)=>{const n=function(){const e=(0,r.useRef)(!0);return e.current?(e.current=!1,!0):e.current}();(0,r.useEffect)((()=>{if(!n)return e()}),t)},Vn=(0,r.forwardRef)((({allowInput:e=!0,allowRewind:t=!0,disabled:n=!1,size:a="medium",pageSizeOptions:s=[],...l},i)=>{var o,c;const[d,u]=(0,r.useState)(!1),[p,m]=En(l.page),[h,f]=En(l.waiting),[v,g]=En(l.pageSize,null!==(o=null!==(c=(e=>{const t=localStorage.getItem(`pages:${e}`);if(Pe(t))return parseInt(t)})(l.name))&&void 0!==c?c:null==s?void 0:s[0])&&void 0!==o?o:10),x=(0,r.useMemo)((()=>{var e;return null!==(e=l.totalPages)&&void 0!==e?e:Math.ceil(l.totalItems/v)}),[v,l.totalItems,l.totalPages]),j=(0,r.useMemo)((()=>{const{totalItems:e}=l,t=v*p-v+1,n=t+v-1;return{start:_e(t,1,e),end:_e(n,1,e)}}),[p,x,v,l.totalItems]),b=(0,r.useCallback)((async(e,t)=>{l.onPageLoad&&(f(!0),await l.onPageLoad(e,t),f(!1))}),[l.onPageLoad]),y=(0,r.useCallback)(((e,t=!1)=>{const n=_e(e,1,x);n===p&&!0!==t||(m(n),w(n))}),[x,p,v,b]),w=(0,r.useCallback)(((e,t={})=>{if(!l.urlParamName)return;const n=new URLSearchParams(location.search);n.set(l.urlParamName,e.toString());const a=[{page:e},"",`${location.pathname}?${n.toString()}`];t.replace?history.replaceState(...a):history.pushState(...a)}),[l.urlParamName]),k=e=>{const t=parseInt(e.target.value);y(t),u(!1)};return(0,r.useEffect)((()=>{var e;null===(e=l.onInit)||void 0===e||e.call(l,p,v),w(p,{replace:!0})}),[]),Un((()=>{var e;p>x?y(1,!0):(null===(e=l.onChange)||void 0===e||e.call(l,p,v),b(p,v))}),[v,x]),Un((()=>{var e;null===(e=l.onChange)||void 0===e||e.call(l,p,v),b(p,v)}),[p]),(0,r.useEffect)((()=>{const e=()=>{var e;if(!l.urlParamName)return;const t=new URLSearchParams(location.search),n=parseInt(null!==(e=t.get(l.urlParamName))&&void 0!==e?e:"");isNaN(n)||n===p||m(n)};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)}),[l.urlParamName]),x>1?(0,Le.jsxs)($e,{name:"pagination",mod:{disabled:n,size:a,waiting:h},style:l.style,children:[l.label&&Pe(v)&&(0,Le.jsxs)(Be,{name:"label",children:[l.label,": ",j.start,"-",j.end]}),(0,Le.jsxs)(Be,{name:"navigation",children:[t&&(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(qn,{mod:["arrow-left","arrow-left-double"],onClick:()=>y(1),disabled:1===p}),(0,Le.jsx)(Be,{name:"divider"})]}),(0,Le.jsx)(qn,{mod:["arrow-left"],onClick:()=>y(p-1),disabled:1===p}),(0,Le.jsx)(Be,{name:"input",children:d?(0,Le.jsx)("input",{type:"text",autoFocus:!0,defaultValue:p,pattern:"[0-9]",onKeyDown:e=>{"Escape"===e.code?u(!1):"Enter"===e.code?k(e):null!==e.code.match(/[0-9]/)||(e=>null!==e.code.match(/arrow/i)||e.shiftKey&&null!==e.code.match(/arrow/i)||e.metaKey||e.ctrlKey||"Backspace"===e.code)(e)||(e.preventDefault(),e.stopPropagation())},onBlur:e=>{k(e)}}):(0,Le.jsxs)(Be,{name:"page-indicator",onClick:()=>{e&&u(!0)},children:[p," ",(0,Le.jsxs)("span",{children:["of ",x]}),(0,Le.jsx)("div",{onClick:()=>{}})]})}),(0,Le.jsx)(qn,{mod:["arrow-right"],onClick:()=>y(p+1),disabled:p===x}),t&&(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(Be,{name:"divider"}),(0,Le.jsx)(qn,{mod:["arrow-right","arrow-right-double"],onClick:()=>y(x),disabled:p===x})]})]}),(null==s?void 0:s.length)>0&&(0,Le.jsx)(Be,{name:"page-size",children:(0,Le.jsx)($n,{value:v,options:s.map((e=>({label:`${e} ${window.t("per page")}`,value:e}))),onChange:e=>{const t=parseInt(e.target.value);g(t),l.name&&((e,t)=>{localStorage.setItem(`pages:${e}`,t.toString())})(l.name,t)}})})]}):null})),qn=e=>{const t=Object.fromEntries(e.mod.map((e=>[e,!0])));return t.disabled=!0===e.disabled,(0,Le.jsx)(Be,{name:"btn",mod:t,onClick:e.onClick})};a(1805);var Wn=a(6686);function Gn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Jn="got ya, suspicious hacker!";class Kn extends r.Component{constructor(...e){super(...e),Gn(this,"state",{validation:null,showValidation:!0,submitting:!1}),Gn(this,"formElement",r.createRef()),Gn(this,"apiRef",r.createRef()),Gn(this,"fields",new Set),Gn(this,"validation",new Map),Gn(this,"onFormSubmitted",(async e=>{e.preventDefault(),this.validateFields(),this.validation.size?this.setState({step:"invalid"}):(this.setState({step:"submitting"}),this.submit())})),Gn(this,"_onAutoSubmit",(()=>{this.validateFields(),this.validation.size||this.submit()})),Gn(this,"onAutoSubmit",this.props.debounce?function(e,t,n){let a;return function(...s){const l=n&&!a;clearTimeout(a),a=setTimeout((()=>{a=null,n||e.apply(this,s)}),t),l&&e.apply(this,s)}}(this._onAutoSubmit,this.props.debounce):this._onAutoSubmit),Gn(this,"onFormChanged",(async e=>{var t,n;e.stopPropagation(),null===(t=(n=this.props).onChange)||void 0===t||t.call(n,e),this.autosubmit()}))}get api(){return this.apiRef.current}componentDidMount(){this.props.formData&&setTimeout((()=>{this.fillFormData()}),50)}componentDidUpdate(e){var t,n;(0,Pt.V)(null!==(t=e.formData)&&void 0!==t?t:{},null!==(n=this.props.formData)&&void 0!==n?n:{})||this.fillFormData()}render(){const e=[(0,Le.jsx)(He.Provider,{value:this},"form-ctx"),(0,Le.jsx)(Ue.Provider,{value:this.state.validation},"form-validation-ctx"),(0,Le.jsx)(Ve.Provider,{value:this.state.submitting},"form-submission-ctx"),(0,Le.jsx)(qe.Provider,{value:this.state.state},"form-state-ctx"),(0,Le.jsx)(We.Provider,{value:this.state.lastResponse},"form-response"),(0,Le.jsx)(jt,{ref:this.apiRef},"form-api")];return(0,Le.jsx)(nt,{providers:e,children:(0,Le.jsxs)("form",{ref:this.formElement,className:Ie("form"),action:this.props.action,onSubmit:this.onFormSubmitted,onChange:this.onFormChanged,autoComplete:this.props.autoComplete,autoSave:this.props.autoSave,style:this.props.style,children:[this.props.children,this.state.validation&&this.state.showValidation&&(0,Le.jsx)(Zn,{validation:this.state.validation})]})})}registerField(e){const t=this.getFieldContext(e.name);t?Object.assign(t,e):(this.fields.add(e),setTimeout((()=>{this.fillWithFormData(e)}),0))}unregisterField(e){const t=this.getFieldContext(e);t&&this.fields.delete(t)}getField(e){var t;return null===(t=this.getFieldContext(e))||void 0===t?void 0:t.field}getFieldContext(e){return Array.from(this.fields).find((t=>t.name===e))}disableValidationMessage(){this.setState({showValidation:!1})}enableValidationMessage(){this.setState({showValidation:!0})}autosubmit(){this.props.autosubmit&&setTimeout((()=>{this.onAutoSubmit()}),100)}assembleFormData({asJSON:e=!1,full:t=!1,booleansAsNumbers:n=!1,fieldsFilter:a}={}){let s=Array.from(this.fields);a instanceof Function&&(s=s.filter(a));const l=s.reduce(((e,{name:a,field:s,skip:l,allowEmpty:r,isProtected:i})=>{const o=i&&s.value===Jn,c=l||o||(this.props.skipEmpty||!1===r)&&!s.value;if(!0===t||!c){const t=(()=>{const e=s.value;return["checkbox","radio"].includes(s.type)?Pe(e)&&!["","on","off","true","false"].includes(e)?s.checked?e:null:n?Number(s.checked):s.checked:e})();null!==t&&e.push([a,t])}return e}),[]);if(e)return l.reduce(((e,[t,n])=>({...e,[t]:n})),{});{const e=new FormData;return l.forEach((([t,n])=>e.append(t,n))),e}}async submit({fieldsFilter:e}={}){var t,n,a;this.setState({submitting:!0,lastResponse:null});const s=this.formElement.current.getAttribute("action"),l=this.api.isValidMethod(s),r=this.assembleFormData({asJSON:l,fieldsFilter:e}),i=null!==(t=null===(n=(a=this.props).prepareData)||void 0===n?void 0:n.call(a,r))&&void 0!==t?t:r;let o=!1;o=l?await this.submitWithAPI(s,i):await this.submitWithFetch(i),this.setState({submitting:!1,state:o?"success":"fail"},(()=>{setTimeout((()=>{this.setState({state:null})}),1500)}))}async submitWithAPI(e,t){var n;const a=Oe(null!==(n=this.props.params)&&void 0!==n?n:{}),s=await this.api.callApi(e,{params:a,body:t});var l,r,i,o;return this.setState({lastResponse:s}),null===s?(null===(l=(r=this.props).onError)||void 0===l||l.call(r),!1):(null===(i=(o=this.props).onSubmit)||void 0===i||i.call(o,s),!0)}async submitWithFetch(e){var t;const n=this.formElement.current.action,a=(null!==(t=this.props.method)&&void 0!==t?t:"POST").toUpperCase(),s=await fetch(n,{method:a,body:e});try{const e=await s.json();var l,r,i,o;if(this.setState({lastResponse:e}),e.validation_errors&&(Object.entries(e.validation_errors).forEach((([e,t])=>{const n=this.getField(e);this.validation.set(n.name,{label:n.label,field:n.field,messages:t})})),this.setState({validation:this.validation})),s.ok)return null===(l=(r=this.props).onSubmit)||void 0===l||l.call(r,e),!0;null===(i=(o=this.props).onError)||void 0===i||i.call(o,e)}catch(e){var c,d;console.log(e),null===(c=(d=this.props).onError)||void 0===c||c.call(d,e)}return!1}validateFields(){this.validation.clear();for(const e of this.fields){const t=this.validateField(e);t.length&&this.validation.set(e.name,{label:e.label,messages:t,field:e.field})}return this.validation.size?this.setState({validation:this.validation}):this.setState({validation:null}),0===this.validation.size}validateField(e){var t;const n=[],{validation:a,field:s}=e,l=(null===(t=s.value)||void 0===t?void 0:t.trim())||null;return e.isProtected&&l===Jn||a.forEach((t=>{const a=t(e.label,l);a&&n.push(a)})),n}fillFormData(){this.props.formData&&0!==this.fields.size&&Array.from(this.fields).forEach((e=>{this.fillWithFormData(e)}))}fillWithFormData(e){var t;const n=(null!==(t=this.props.formData)&&void 0!==t?t:{})[e.name];e.isProtected&&this.props.formData?e.setValue(Jn):Pe(n)&&e.value!==n&&!e.skipAutofill&&e.setValue(n)}}const Zn=({validation:e})=>{const t=Ie("form-validation");return(0,Le.jsx)("div",{className:t,children:Array.from(e).map((([e,n])=>(0,Le.jsxs)("div",{className:t.elem("group"),onClick:()=>n.field.focus(),children:[(0,Le.jsx)("div",{className:t.elem("field"),children:n.label}),(0,Le.jsx)("div",{className:t.elem("messages"),children:n.messages.map(((n,a)=>(0,Le.jsx)("div",{className:t.elem("message"),children:n},`${e}-${a}`)))})]},e)))})};Kn.Validator=s,Kn.Row=({columnCount:e,rowGap:t,children:n,style:a,spread:s=!1})=>{const l={};return e&&(l["--column-count"]=e),t&&(l["--row-gap"]=t),(0,Le.jsx)("div",{className:Ie("form").elem("row").mod({spread:s}),style:{...null!=a?a:{},...l},children:n})},Kn.Builder=r.forwardRef((({fields:e,formData:t,fetchFields:n,fetchFormData:a,children:s,formRowStyle:l,onSubmit:i,withActions:o,...c},d)=>{const u=null!=d?d:(0,r.useRef)(),[p,m]=(0,r.useState)(null!=e?e:[]),[h,f]=(0,r.useState)(null!=t?t:{}),v=e=>e.map(((e,t)=>{var n,a;if(!e)return(0,Le.jsx)("div",{},`spacer-${t}`);const s=null!==(n=null==h?void 0:h[e.name])&&void 0!==n?n:void 0,l=()=>e.skipAutofill&&!e.allowEmpty&&"password"===e.type?Jn:e.skipAutofill?null:null!=s?s:e.value,r={};!0!==c.autosubmit&&!0===e.trigger_form_update&&(r.onChange=async()=>{await u.current.submit({fieldsFilter:t=>t.name===e.name}),await x(),await j()});const i=(()=>{switch(e.type){case"select":return $n;case"counter":return In;case"toggle":return Hn;default:return zn}})();return["checkbox","radio","toggle"].includes(e.type)?r.checked=l():r.defaultValue=l(),(0,Le.jsx)(i,{...e,...r},null!==(a=e.name)&&void 0!==a?a:t)})),g=e=>e.map(((e,t)=>(0,Le.jsx)("div",{className:Ie("form").elem("column"),style:{width:e.width},children:v(e.fields)},t))),x=(0,r.useCallback)((async()=>{if(n){const e=await n();JSON.stringify(p)!==JSON.stringify(e)&&m(e)}}),[n]),j=(0,r.useCallback)((async()=>{if(a){const e=await a();!1===(0,Pt.V)(h,e)&&f(e)}}),[a]),b=(0,r.useCallback)((async(...e)=>{null==i||i(...e),await x(),await j()}),[i,a]);return(0,r.useEffect)((()=>{x()}),[x]),(0,r.useEffect)((()=>{j()}),[j]),(0,r.useEffect)((()=>{m(e)}),[e]),(0,Le.jsxs)(Kn,{...c,onSubmit:b,ref:u,children:[(null!=p?p:[]).map((({columnCount:e,fields:t,columns:n},a)=>(0,Le.jsx)(Kn.Row,{columnCount:e,style:l,spread:!0,children:n?g(n):v(t)},a))),s,!0!==c.autosubmit&&!0===o&&(0,Le.jsx)(Kn.Actions,{children:(0,Le.jsx)(Ge,{type:"submit",look:"primary",style:{width:120},children:"Save"})})]})})),Kn.Actions=({children:e,valid:t,extra:n,size:a})=>{const s=Ie("form");return(0,Le.jsxs)("div",{className:s.elem("submit").mod({size:a}),children:[(0,Le.jsx)("div",{className:s.elem("info").mod({valid:t}),children:n}),(0,Le.jsx)(Ke,{children:e})]})},Kn.Indicator=()=>{const e=r.useContext(qe);return(0,Le.jsx)($e,{name:"form-indicator",children:(0,Le.jsx)(An,{value:e,children:(0,Le.jsx)(Be,{tag:"span",mod:{type:e},name:"item",case:"success",children:"Saved!"})})})},Kn.ResponseParser=({children:e})=>{const t=e;if(t instanceof Function==!1)throw new Error("Response Parser only accepts function as a child");const n=(0,r.useContext)(We);return(0,Le.jsx)(Le.Fragment,{children:n?t(n):null})};const Xn="FFA39E D4380D FFC069 AD8B00 D3F261 389E0D 5CDBD3 096DD9 ADC6FF 9254DE F759AB".split(" ").map((e=>"#"+e));function*Yn(e=Xn){let t=0;for(;;)yield e[t],t=(t+1)%e.length}window.Palette=Yn;const Qn={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ea={Image:{type:"Image",settings:{strokeWidth:{title:"Width of region borders",type:Number,param:(e,t)=>e.$controls.forEach((e=>e.setAttribute("strokeWidth",t))),value:e=>{var t,n;return null!==(t=null===(n=e.$controls[0])||void 0===n?void 0:n.getAttribute("strokeWidth"))&&void 0!==t?t:1}},zoom:{title:"Allow image zoom (ctrl+wheel)",type:Boolean,param:"zoom"},zoomControl:{title:"Show controls to zoom in and out",type:Boolean,param:"zoomControl"},rotateControl:{title:"Show controls to rotate image",type:Boolean,param:"rotateControl"}}},Text:{type:"Text",settings:{granularity:{title:"Select text by words",type:Boolean,param:(e,t)=>t?e.setAttribute("granularity","word"):e.removeAttribute("granularity"),value:e=>"word"===e.getAttribute("granularity"),when:e=>e.$controls.filter((e=>e.tagName.endsWith("Labels"))).length>0}}},HyperText:{type:"HyperText"},Audio:{type:"Audio"},AudioPlus:{type:"AudioPlus"},TimeSeries:{type:"TimeSeries"},Paragraphs:{type:"Paragraphs"},Table:{type:"Table"},Video:{type:"Video"}},ta={type:"Labels",settings:{placeLabelsLeft:{title:"Display labels:",type:["bottom","left","right","top"],control:!0,when:e=>"Video"!==e.$object.tagName,param:(e,t)=>{var n,a,s;let l=e.parentNode,r=e;"FILTER"===(null===(n=l.firstChild)||void 0===n||null===(a=n.tagName)||void 0===a?void 0:a.toUpperCase())&&(r=l,l=r.parentNode);const i=e.$object,o=["top","bottom"].includes(t),c=(o?"column":"row")+(["top","left"].includes(t)?"-reverse":"");(null===(s=l.getAttribute("style"))||void 0===s?void 0:s.includes("flex"))||(l=i.ownerDocument.createElement("View"),r.parentNode.insertBefore(l,i),l.appendChild(i),l.appendChild(r)),e.setAttribute("showInline",JSON.stringify(o)),l.setAttribute("style","display:flex;align-items:start;gap:8px;flex-direction:"+c)},value:e=>{var t,n;let a=e.parentNode;"FILTER"===(null===(t=a.firstChild)||void 0===t||null===(n=t.tagName)||void 0===n?void 0:n.toUpperCase())&&(a=a.parentNode);const s=a.getAttribute("style"),l=null==s?void 0:s.match(/direction:(row|column)(-reverse)?/);if(!l){return e.compareDocumentPosition(e.$object)&Node.DOCUMENT_POSITION_FOLLOWING?"top":"bottom"}return"column"===l[1]?l[2]?"top":"bottom":l[2]?"left":"right"}},filter:{title:"Add filter for long list of labels",type:Boolean,control:!0,param:(e,t)=>{if(t){const t=e.ownerDocument.createElement("Filter"),n=e.ownerDocument.createElement("View");t.setAttribute("toName",e.getAttribute("name")),t.setAttribute("minlength",0),t.setAttribute("name","filter"),e.parentNode.insertBefore(n,e),n.appendChild(t),n.appendChild(e)}else{if("FILTER"===e.previousElementSibling.tagName.toUpperCase()){const t=e.parentNode;t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t)}}},value:e=>{var t;return"FILTER"===(null===(t=e.previousElementSibling)||void 0===t?void 0:t.tagName.toUpperCase())}}}},na={Labels:ta,RectangleLabels:ta};function aa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const sa="<View></View>",la="$undefined$",ra=e=>["",sa].includes(e.replace(/\s+/g,""));class ia{constructor(e){aa(this,"objects",[]),aa(this,"controls",[]),aa(this,"details",!1),aa(this,"palette",Yn()),this.tpl=e,this.config=e.config;const t=new DOMParser;this.$root=t.parseFromString(this.config,"application/xml"),this.serializer=new XMLSerializer,this.initRoot()}flatten(e){const t=[];for(let n of e.children)t.push(n),n.children.length&&t.push(...this.flatten(n));return t}onConfigUpdate(){}render(){const e=this.serializer.serializeToString(this.$root);this.onConfigUpdate(e)}initRoot(){const e=this.flatten(this.$root);this.objects=e.filter((e=>e.tagName in ea&&e.getAttribute("value")));const t=this.objects.map((e=>e.getAttribute("name")));this.controls=e.filter((e=>t.includes(e.getAttribute("toName"))));for(let e of this.objects){const t=ea[e.tagName];e.$controls=this.controls.filter((t=>t.getAttribute("toName")===e.getAttribute("name"))),e.$controls.forEach((t=>t.$object=e));for(let n in t.settings)t.settings[n].object=e;let n={...t.settings};e.$controls.forEach((t=>{let a=na[t.tagName];if(a){for(let n in a.settings)a.settings[n].control=t,a.settings[n].object=e;n={...n,...a.settings}}})),this.settings=n}}fixColumns(e){if(1===e.length&&e[0]===la)return;const t=this.objects.map((e=>e.getAttribute("value").replace(/^\$/,"")));let n=e.filter((e=>!t.includes(e)));for(let t of this.objects){var a;if(!e.includes(t.getAttribute("value").replace(/^\$/,"")))t.setAttribute("value","$"+(null!==(a=n.shift())&&void 0!==a?a:e[0]))}this.render()}addLabels(e,t){if(!t)return;if(Array.isArray(t)||(t=t.split("\n").map((e=>e.trim())).filter(Boolean)),!t.length)return;const n=[...e.children].map((e=>e.getAttribute("value"))),a="Choices"===e.tagName;t.forEach((t=>{if(n.includes(t))return;n.push(t);const s=this.$root.createElement(a?"Choice":"Label");s.setAttribute("value",t),a||s.setAttribute("background",this.palette.next().value),e.appendChild(s)})),this.render()}removeLabel(e){e.parentNode.removeChild(e),this.render()}changeLabel(e,t){for(let n of Object.keys(t))e.setAttribute(n,t[n]);this.render()}}const oa=Ie("configure"),ca=({config:e,data:t,error:n})=>{var a,s,l,i,o,c,d,u;const p=At("lsf"),m=(0,r.useRef)(),h=(0,r.useRef)();return(0,r.useEffect)((()=>{if(!p)return;if(!m.current)return;if(n)return;if(!t)return;const a=window.LabelStudio;try{var s;null===(s=h.current)||void 0===s||s.destroy(),h.current=new a(m.current,{config:e||sa,interfaces:["side-column"],task:{annotations:[],predictions:[],id:1,data:t},onLabelStudioLoad:function(e){e.settings.bottomSidePanel=!0;var t=e.annotationStore.addAnnotation({userGenerate:!0});e.annotationStore.selectAnnotation(t.id)}})}catch(e){console.error(e)}}),[e,t,p,m]),(0,Le.jsxs)("div",{className:oa.elem("preview"),children:[(0,Le.jsx)("h3",{children:"UI Preview"}),n&&(0,Le.jsxs)("div",{className:oa.elem("preview-error"),children:[(0,Le.jsxs)("h2",{children:[n.detail," ",n.id]}),null===(a=n.validation_errors)||void 0===a||null===(s=a.non_field_errors)||void 0===s||null===(l=s.map)||void 0===l?void 0:l.call(s,(e=>(0,Le.jsx)("p",{children:e},e))),null===(i=n.validation_errors)||void 0===i||null===(o=i.label_config)||void 0===o||null===(c=o.map)||void 0===c?void 0:c.call(o,(e=>(0,Le.jsx)("p",{children:e},e))),null===(d=n.validation_errors)||void 0===d||null===(u=d.map)||void 0===u?void 0:u.call(d,(e=>(0,Le.jsx)("p",{children:e},e)))]}),!t&&(0,Le.jsx)(Cn,{style:{width:"100%",height:"50vh"}}),(0,Le.jsx)("div",{id:"label-studio",ref:m})]})},da=Ie("templates-list"),ua=()=>(0,Le.jsx)("svg",{width:"8",height:"12",viewBox:"0 0 8 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Le.jsx)("path",{opacity:"0.9",d:"M2 10L6 6L2 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"square"})}),pa=({templates:e,group:t,onSelectRecipe:n})=>{const a=e.filter((e=>e.group===t)).sort(((e,t)=>{var n,a;return(null!==(n=e.order)&&void 0!==n?n:1/0)-(null!==(a=t.order)&&void 0!==a?a:1/0)}));return(0,Le.jsx)("ul",{children:a.map((e=>(0,Le.jsxs)("li",{onClick:()=>n(e),className:da.elem("template"),children:[(0,Le.jsx)("img",{src:e.image}),(0,Le.jsx)("h3",{children:e.title})]},e.title)))})},ma=({selectedGroup:e,selectedRecipe:t,onCustomTemplate:n,onSelectGroup:a,onSelectRecipe:s})=>{const[l,i]=r.useState([]),[o,c]=r.useState(),d=bt();r.useEffect((async()=>{const e=await d.callApi("configTemplates");if(!e)return;const{templates:t,groups:n}=e;c(t),i(n)}),[]);const u=e||l[0];return(0,Le.jsxs)("div",{className:da,children:[(0,Le.jsxs)("aside",{className:da.elem("sidebar"),children:[(0,Le.jsx)("ul",{children:l.map((e=>(0,Le.jsxs)("li",{onClick:()=>a(e),className:da.elem("group").mod({active:u===e,selected:(null==t?void 0:t.group)===e}),children:[e,(0,Le.jsx)(ua,{})]},e)))}),(0,Le.jsx)("button",{type:"button",onClick:n,className:da.elem("custom-template"),children:"Custom template"})]}),(0,Le.jsxs)("main",{children:[!o&&(0,Le.jsx)(Cn,{style:{width:"100%",height:200}}),(0,Le.jsx)(pa,{templates:o||[],group:u,onSelectRecipe:s})]}),(0,Le.jsx)("footer",{})]})},ha=e=>{if(e.indexOf("\n")>=0)return e;let t=0;try{return e.replace(/<(\/)?.*?(\/)?>[\s\n]*/g,((e,n,a)=>{if(n)return t--,"  ".repeat(t)+e.trim()+"\n";{const n="  ".repeat(t)+e.trim()+"\n";return a||t++,n}}))}catch(t){return e}},fa=Ie("wizard"),va=Ie("configure"),ga=()=>(0,Le.jsx)("div",{className:va.elem("empty-config"),children:(0,Le.jsx)("p",{children:"Your labeling configuration is empty. It is required to label your data."})}),xa=({label:e,template:t,color:n})=>{const a=e.getAttribute("value");return(0,Le.jsxs)("li",{className:va.elem("label").mod({choice:"Choice"===e.tagName}),children:[(0,Le.jsx)("label",{style:{background:n},children:(0,Le.jsx)("input",{type:"color",className:va.elem("label-color"),value:Qn[n]||n,onChange:n=>t.changeLabel(e,{background:n.target.value})})}),(0,Le.jsx)("span",{children:a}),(0,Le.jsx)("button",{type:"button",className:va.elem("delete-label"),onClick:()=>t.removeLabel(e),children:(0,Le.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",stroke:"red",strokeWidth:"2",strokeLinecap:"square",xmlns:"http://www.w3.org/2000/svg",children:[(0,Le.jsx)("path",{d:"M2 12L12 2"}),(0,Le.jsx)("path",{d:"M12 12L2 2"})]})})]})},ja=({control:e,template:t})=>{const n=r.useRef(),a=e.tagName;if("Choices"!==a&&!a.endsWith("Labels"))return null;const s=Yn(),l=()=>{n.current&&(t.addLabels(e,n.current.value),n.current.value="")};return(0,Le.jsxs)("div",{className:va.elem("labels"),children:[(0,Le.jsxs)("form",{className:va.elem("add-labels"),action:"",children:[(0,Le.jsx)("h4",{children:"Choices"===a?"Add choices":"Add label names"}),(0,Le.jsx)("textarea",{name:"labels",id:"",cols:"30",rows:"5",ref:n,onKeyPress:e=>{"Enter"===e.key&&e.ctrlKey&&(e.preventDefault(),l())}}),(0,Le.jsx)("input",{type:"button",value:"Add",onClick:l})]}),(0,Le.jsxs)("div",{className:va.elem("current-labels"),children:[(0,Le.jsxs)("h3",{children:["Choices"===a?"Choices":"Labels"," (",e.children.length,")"]}),(0,Le.jsx)("ul",{children:Array.from(e.children).map((e=>(0,Le.jsx)(xa,{label:e,template:t,color:e.getAttribute("background")||s.next().value},e.getAttribute("value"))))})]})]})},ba=({template:e})=>{const{settings:t}=e;if(!t)return null;const n=Object.keys(t).map((n=>{const a=t[n],s=Array.isArray(a.type)?Array:a.type,l=a.object,r=a.control?a.control:l;if(!r)return null;if(a.when&&!a.when(r))return;let i,o,c=!1;switch(a.value?c=a.value(r):"string"==typeof a.param&&(c=r.getAttribute(a.param)),"true"===c&&(c=!0),"false"===c&&(c=!1),s){case Array:return i=t=>{"function"==typeof a.param?a.param(r,t.target.value):l.setAttribute(a.param,t.target.value),e.render()},(0,Le.jsx)("li",{children:(0,Le.jsxs)("label",{children:[a.title," ",(0,Le.jsx)("select",{value:c,onChange:i,children:a.type.map((e=>(0,Le.jsx)("option",{value:e,children:e},e)))})]})},n);case Boolean:return i=t=>{"function"==typeof a.param?a.param(r,t.target.checked):l.setAttribute(a.param,t.target.checked?"true":"false"),e.render()},(0,Le.jsx)("li",{children:(0,Le.jsxs)("label",{children:[(0,Le.jsx)("input",{type:"checkbox",checked:c,onChange:i})," ",a.title]})},n);case String:case Number:return o=a.type===Number?5:void 0,i=t=>{"function"==typeof a.param?a.param(r,t.target.value):l.setAttribute(a.param,t.target.value),e.render()},(0,Le.jsx)("li",{children:(0,Le.jsxs)("label",{children:[a.title," ",(0,Le.jsx)("input",{type:"text",onInput:i,value:c,size:o})]})},n)}}));return n.filter(Boolean).length?(0,Le.jsx)("ul",{className:va.elem("settings"),children:(0,Le.jsxs)("li",{children:[(0,Le.jsx)("h4",{children:"Configure settings"}),(0,Le.jsx)("ul",{className:va.elem("object-settings"),children:n})]})}):null},ya=({columns:e,template:t})=>{const n=e=>n=>{const a=n.target.value.replace(/^\$/,"");e.setAttribute("value","$"+a),t.render()};return t.objects.length?(0,Le.jsxs)("div",{className:va.elem("object"),children:[(0,Le.jsx)("h4",{children:"Configure data"}),t.objects.length>1&&(null==e?void 0:e.length)>0&&e.length<t.objects.length&&(0,Le.jsx)("p",{className:va.elem("object-error"),children:"This template requires more data then you have for now"}),0===(null==e?void 0:e.length)&&(0,Le.jsx)("p",{className:va.elem("object-error"),children:"To select which field(s) to label you need to upload the data. Alternatively, you can provide it using Code mode."}),t.objects.map((a=>{var s,l;return(0,Le.jsxs)("p",{children:["Use ",a.tagName.toLowerCase(),t.objects>1&&` for ${a.getAttribute("name")}`," from ",(null==e?void 0:e.length)>0&&e[0]!==la&&"field ",(0,Le.jsxs)("select",{onChange:n(a),value:null===(s=a.getAttribute("value"))||void 0===s?void 0:s.replace(/^\$/,""),children:[null==e?void 0:e.map((e=>(0,Le.jsx)("option",{value:e,children:e===la?"<imported file>":`$${e}`},e))),!(null!=e&&e.length)&&(0,Le.jsx)("option",{value:null===(l=a.getAttribute("value"))||void 0===l?void 0:l.replace(/^\$/,""),children:"<imported file>"})]})]},a.getAttribute("name"))}))]}):null},wa=({columns:e,config:t,project:n,template:a,setTemplate:s,onBrowse:l,onSaveClick:i,onValidate:o,disableSaveButton:c})=>{const[d,u]=r.useState(ra(t)?"code":"visual"),[p,m]=r.useState("visual"===d),[h,f]=r.useState(!1),[v,g]=r.useState(),[x,j]=r.useState(),[b,y]=r.useState(),w=r.useRef(),k=bt();r.useEffect((()=>(w.current=window.setTimeout((()=>j(t)),x?500:30),()=>window.clearTimeout(w.current))),[t]),r.useEffect((async()=>{if(!x)return;const e=await k.callApi("validateConfig",{params:{pk:n.id},body:{label_config:x},errorFilter:()=>!0});if(null!=e&&e.error)return void g(e.response);g(null),null==o||o(e);const t=await k.callApi("createSampleTask",{params:{pk:n.id},body:{label_config:x},errorFilter:()=>!0});t&&!t.error?y(t.sample_task):g(null==t?void 0:t.response)}),[x]),r.useEffect((()=>{g(null)}),[a,t]);const C=(0,Le.jsxs)("p",{className:va.elem("tags-link"),children:["Configure the labeling interface with tags.",(0,Le.jsx)("br",{}),(0,Le.jsx)("a",{href:"https://labelstud.io/tags/",target:"_blank",children:"See all available tags"}),"."]});return(0,Le.jsxs)("div",{className:va,children:[(0,Le.jsxs)("div",{className:va.elem("container"),children:[(0,Le.jsxs)("header",{children:[(0,Le.jsx)("button",{onClick:l,children:"Browse Templates"}),(0,Le.jsx)(Sn,{items:{code:"Code",visual:"Visual"},active:d,onSelect:e=>{u(e),"visual"===e&&m(!0)}})]}),(0,Le.jsxs)("div",{className:va.elem("editor"),children:["code"===d&&(0,Le.jsx)("div",{className:va.elem("code"),style:{display:"code"===d?void 0:"none"},children:(0,Le.jsx)(Wn.Rt,{name:"code",id:"edit_code",value:ha(t),detach:!0,options:{mode:"xml",theme:"default",lineNumbers:!0},onChange:(e,t,n)=>s(n)})}),p&&(0,Le.jsxs)("div",{className:va.elem("visual"),style:{display:"visual"===d?void 0:"none"},children:[ra(t)&&(0,Le.jsx)(ga,{}),(0,Le.jsx)(ya,{columns:e,project:n,template:a}),a.controls.map((e=>(0,Le.jsx)(ja,{control:e,template:a},e.getAttribute("name")))),(0,Le.jsx)(ba,{template:a})]})]}),!0!==c&&i&&(0,Le.jsx)(Kn.Actions,{size:"small",extra:"code"===d&&C,valid:!0,children:(0,Le.jsx)(Ge,{look:"primary",size:"compact",style:{width:120},onClick:async()=>{g(null),f(!0);const e=await i();f(!1),!0!==e&&g(e)},waiting:h,children:"Save"})})]}),(0,Le.jsx)(ca,{config:t,data:b,error:v})]})},ka=({config:e="",columns:t,project:n,onUpdate:a,onSaveClick:s,onValidate:l,disableSaveButton:i,show:o=!0})=>{const[c,d]=r.useState(""),[u,p]=r.useState("list"),[m,h]=r.useState(null),[f,v]=r.useState(null),[g,x]=r.useState(null),j=bt(),b=r.useCallback((e=>{d(e),a(e)}),[d,a]),y=r.useCallback((e=>{const t=new ia({config:e});t.onConfigUpdate=b,b(e),x(t)}),[b,x]),[w,k]=r.useState();r.useEffect((()=>{null!=t&&t.length&&k(t)}),[t]),r.useEffect((async()=>{if(!n||w)return;const e=await j.callApi("dataSummary",{params:{pk:n.id},errorFilter:()=>!0});null!=e&&e.common_data_columns&&k(e.common_data_columns)}),[w,n]),r.useEffect((()=>{null!=w&&w.length&&g&&g.fixColumns(w)}),[w,g]);const C=r.useCallback((e=>{if(!e)return v(null),void p("list");y(e.config),v(e),p("view")})),S=r.useCallback((()=>{y(sa),p("view")}));return r.useEffect((()=>{e&&(y(e),p("view"))}),[]),o?(0,Le.jsx)("div",{className:fa,"data-mode":"list",id:"config-wizard",children:(0,Le.jsxs)(An,{value:u,children:[(0,Le.jsx)(ma,{case:"list",selectedGroup:m,selectedRecipe:f,onSelectGroup:h,onSelectRecipe:C,onCustomTemplate:S}),(0,Le.jsx)(wa,{case:"view",columns:w,config:c,project:n,selectedRecipe:f,template:g,setTemplate:y,onBrowse:p.bind(null,"list"),onValidate:l,disableSaveButton:i,onSaveClick:s})]})}):null},Ca=Ie("upload_page"),Sa=Ie("dropzone");function Ea(e){return[].concat(...e)}function Na(e,t){return new Promise((n=>{if(t=t||"",e.isFile){if("."===e.name[0])return n([]);n([e])}else if(e.isDirectory){const a=e.createReader(),s=t+e.name+"/";a.readEntries((function(e){Promise.all(e.map((e=>Na(e,s)))).then(Ea).then(n)}))}}))}const Aa=()=>(0,Le.jsx)(ot.Footer,{children:""}),Pa=({children:e,sendFiles:t})=>{const[n,a]=(0,r.useState)(!1),s=e=>{e.preventDefault(),a(!0)},l=a.bind(null,!1),i=(0,r.useRef)(),o=(0,r.useCallback)((e=>{var n;e.preventDefault(),l(),(n=e.dataTransfer.items,new Promise((e=>{if(!n.length)return e([]);if(!n[0].webkitGetAsEntry)return e(n);const t=Array.from(n).map((e=>e.webkitGetAsEntry()));Promise.all(t.map(Na)).then(Ea).then((e=>e.map((e=>new Promise((t=>e.file(t))))))).then((e=>Promise.all(e))).then(e)}))).then((e=>t(e)))}),[l,t]);return(0,Le.jsx)("div",{id:"holder",className:Sa.mod({hovered:n}),ref:i,onDragStart:s,onDragOver:s,onDragLeave:l,onDrop:o,children:e})},Ta=({error:e})=>{var t;if(!e)return null;let n=null!==(t=e.validation_errors)&&void 0!==t?t:e.extra;var a;n&&"object"==typeof n&&!Array.isArray(n)&&(n=null!==(a=n.non_field_errors)&&void 0!==a?a:Object.values(n));return Array.isArray(n)&&(n=n.join("; ")),(0,Le.jsxs)("div",{className:Ca.elem("error"),children:[(0,Le.jsx)(_,{style:{marginRight:8}}),e.id&&`[${e.id}] `,e.detail||e.message,n&&` (${n})`]})},Oa=({project:e,show:t=!0,onWaiting:n,onFileListUpdate:a,highlightCsvHandling:s,dontCommitToProject:l=!1,csvHandling:i,setCsvHandling:o,addColumns:c})=>{var d,u;const[p,m]=(0,r.useState)(!1),[h,f]=(0,r.useState)(),[v,g]=(0,r.useState)([]),x=bt(),[j,b]=(0,r.useReducer)(((e,t)=>t.sending?{...e,uploading:[...t.sending,...e.uploading]}:t.sent?{...e,uploading:e.uploading.filter((e=>!t.sent.includes(e)))}:t.uploaded?{...e,uploaded:Ae([...e.uploaded,...t.uploaded],((e,t)=>e.id===t.id))}:e),{uploaded:[],uploading:[]}),y=Boolean((null===(d=j.uploaded)||void 0===d?void 0:d.length)||(null===(u=j.uploading)||void 0===u?void 0:u.length)),w=e=>{g(e),null==a||a(e)},k=(0,r.useCallback)((async t=>{const n={};t&&(n.ids=JSON.stringify(t));const a=await x.callApi("fileUploads",{params:{pk:e.id,...n}});return b({uploaded:null!=a?a:[]}),null!=a&&a.length&&w(Ae([...v,...a.map((e=>e.id))])),a}),[e]),C=()=>{m(!0),f(null)},S=e=>{if(console.error(e),"string"==typeof e&&e.includes("RequestDataTooBig")){var t;const n="Imported file is too big",a=null===(t=e.match(/"exception_value">(.*)<\/pre>/))||void 0===t?void 0:t[1];e={message:n,extra:a}}f(e),m(!1),null==n||n(!1)},E=(0,r.useCallback)((e=>{const{could_be_tasks_list:t,data_columns:a,file_upload_ids:s}=e,l=[...v,...s];return w(l),t&&!i&&o("choose"),m(!0),null==n||n(!1),c(a),k(l).then((()=>m(!1)))}),[c,k,w,v,m]),N=(0,r.useCallback)((async(t,n)=>{b({sending:t});const a=l?{commit_to_project:"false"}:{},s=n instanceof FormData?"multipart/form-data":"application/x-www-form-urlencoded",r=await x.callApi("importFiles",{params:{pk:e.id,...a},headers:{"Content-Type":s},body:n,errorFilter:()=>!0});r&&!r.error?null==E||E(r):null==S||S(null==r?void 0:r.response),b({sent:t})}),[e,E]),A=(0,r.useCallback)((e=>{C(),null==n||n(!0),e=[...e];const t=new FormData;for(let n of e)t.append(n.name,n);return N(e,t)}),[N,C]),P=(0,r.useCallback)((e=>{A(e.target.files),e.target.value=""}),[A]),T=(0,r.useCallback)((e=>{var t;e.preventDefault(),C();const a=null===(t=O.current)||void 0===t?void 0:t.value;if(!a)return void m(!1);O.current.value="",null==n||n(!0);const s=new URLSearchParams({url:a});N([{name:a}],s)}),[N]);(0,r.useEffect)((()=>{void 0!==(null==e?void 0:e.id)&&k().then((e=>{i||Array.isArray(e)&&e.some((({file:e})=>/\.[ct]sv$/.test(e)))&&o("choose")}))}),[e,k]);const O=(0,r.useRef)();if(!e)return null;if(!t)return null;const R={name:"csv",type:"radio",onChange:e=>o(e.target.value)};return(0,Le.jsxs)("div",{className:Ca,children:[s&&(0,Le.jsx)("div",{className:Ca.elem("csv-splash")}),(0,Le.jsx)("input",{id:"file-input",type:"file",name:"file",multiple:!0,onChange:P,style:{display:"none"}}),(0,Le.jsxs)("header",{children:[(0,Le.jsxs)("form",{className:Ca.elem("url-form")+" inline",method:"POST",onSubmit:T,children:[(0,Le.jsx)("input",{placeholder:"Dataset URL",name:"url",ref:O}),(0,Le.jsx)("button",{type:"submit",children:"Add URL"})]}),(0,Le.jsx)("span",{children:"or"}),(0,Le.jsxs)("button",{onClick:()=>document.getElementById("file-input").click(),className:Ca.elem("upload-button"),children:[(0,Le.jsx)(ke,{width:"16",height:"16",className:Ca.elem("upload-icon")}),"Upload ",j.uploaded.length?"More ":"","Files"]}),(0,Le.jsxs)("div",{className:Ca.elem("csv-handling").mod({highlighted:s,hidden:!i}),children:[(0,Le.jsx)("span",{children:"Treat CSV/TSV as"}),(0,Le.jsxs)("label",{children:[(0,Le.jsx)("input",{...R,value:"tasks",checked:"tasks"===i})," List of tasks"]}),(0,Le.jsxs)("label",{children:[(0,Le.jsx)("input",{...R,value:"ts",checked:"ts"===i})," Time Series"]})]}),(0,Le.jsx)("div",{className:Ca.elem("status"),children:j.uploaded.length?`${j.uploaded.length} files uploaded`:""})]}),(0,Le.jsx)(Ta,{error:h}),(0,Le.jsx)("main",{children:(0,Le.jsxs)(Pa,{sendFiles:A,project:e,children:[!y&&(0,Le.jsx)("label",{htmlFor:"file-input",children:(0,Le.jsxs)("div",{className:Sa.elem("content"),children:[(0,Le.jsxs)("header",{children:["Drag & drop files here",(0,Le.jsx)("br",{}),"or click to browse"]}),(0,Le.jsx)(ke,{height:"64",className:Sa.elem("icon")}),(0,Le.jsxs)("dl",{children:[(0,Le.jsx)("dt",{children:"Text"}),(0,Le.jsx)("dd",{children:"txt"}),(0,Le.jsx)("dt",{children:"Audio"}),(0,Le.jsx)("dd",{children:"wav, aiff, mp3, au, flac, m4a, ogg"}),(0,Le.jsx)("dt",{children:"Images"}),(0,Le.jsx)("dd",{children:"jpg, png, gif, bmp, svg, webp"}),(0,Le.jsx)("dt",{children:"HTML"}),(0,Le.jsx)("dd",{children:"html, htm, xml"}),(0,Le.jsx)("dt",{children:"Time Series"}),(0,Le.jsx)("dd",{children:"csv, tsv"}),(0,Le.jsx)("dt",{children:"Common Formats"}),(0,Le.jsx)("dd",{children:"csv, tsv, txt, json"})]})]})}),y&&(0,Le.jsx)("table",{children:(0,Le.jsxs)("tbody",{children:[j.uploading.map((e=>(0,Le.jsxs)("tr",{children:[(0,Le.jsx)("td",{children:e.name}),(0,Le.jsx)("td",{children:(0,Le.jsx)("span",{className:Ca.elem("file-status").mod({uploading:!0})})})]},e.name))),j.uploaded.map((e=>(0,Le.jsxs)("tr",{children:[(0,Le.jsx)("td",{children:e.file}),(0,Le.jsx)("td",{children:(0,Le.jsx)("span",{className:Ca.elem("file-status")})}),(0,Le.jsx)("td",{children:e.size})]},e.file)))]})})]})}),(0,Le.jsx)(Aa,{})]})},Ra=e=>{const[t,n]=r.useState(!1),[a,s]=r.useState([]),[l,i]=r.useState([]),[o,c]=r.useState(),d="choose"===o,u=bt();return{columns:["choose","ts"].includes(o)?["$undefined$"]:l,uploading:t,uploadDisabled:d,finishUpload:async()=>{n(!0);const t=await u.callApi("reimportFiles",{params:{pk:e.id},body:{file_upload_ids:a,files_as_tasks_list:"tasks"===o}});return n(!1),t},fileIds:a,pageProps:{onWaiting:n,highlightCsvHandling:d,addColumns:e=>i((t=>Ae(t.concat(e)))),csvHandling:o,setCsvHandling:c,onFileListUpdate:s,dontCommitToProject:!0}}},Da=({name:e,setName:t,onSaveName:n,onSubmit:a,error:s,description:l,setDescription:r,show:i=!0})=>i?(0,Le.jsxs)("form",{className:Ie("project-name"),onSubmit:e=>{e.preventDefault(),a()},children:[(0,Le.jsxs)("div",{className:"field field--wide",children:[(0,Le.jsx)("label",{htmlFor:"project_name",children:"Project Name"}),(0,Le.jsx)("input",{name:"name",id:"project_name",value:e,onChange:e=>t(e.target.value),onBlur:n}),s&&(0,Le.jsx)("span",{className:"error",children:s})]}),(0,Le.jsxs)("div",{className:"field field--wide",children:[(0,Le.jsx)("label",{htmlFor:"project_description",children:"Description"}),(0,Le.jsx)("textarea",{name:"description",id:"project_description",placeholder:"Optional description of your project",rows:"4",value:l,onChange:e=>r(e.target.value)})]})]}):null,_a=({onClose:e})=>{const[t,n]=r.useState("name"),[a,s]=r.useState(!1),l=(()=>{const e=bt(),[t,n]=r.useState(),a=r.useCallback((async()=>{var t;const a=await e.callApi("projects"),s=null!==(t=null==a?void 0:a.results)&&void 0!==t?t:[];let l=s.length+1,r=`New Project #${l}`;for(;s.find((({title:e})=>e===r));)l++,r=`New Project #${l}`;const i=await e.callApi("createProject",{body:{title:r}});i&&n(i)}),[]);return r.useEffect((()=>{a()}),[]),t})(),i=(0,o.k6)(),c=bt(),[d,u]=r.useState(""),[p,m]=r.useState(),[h,f]=r.useState(""),[v,g]=r.useState("<View></View>");r.useEffect((()=>{m(null)}),[d]);const{columns:x,uploading:j,uploadDisabled:b,finishUpload:y,pageProps:w}=Ra(l),k=Ie("create-project"),C=k.elem("tab"),S={name:(0,Le.jsx)("span",{className:C.mod({disabled:!!p}),children:"Project Name"}),import:(0,Le.jsx)("span",{className:C.mod({disabled:b}),children:"Data Import"}),config:"Labeling Setup"};r.useEffect((()=>l&&!d&&u(l.title)),[l]);const E=r.useMemo((()=>({title:d,description:h,label_config:v})),[d,h,v]),N=r.useCallback((async()=>{if(!await y())return;s(!0);const e=await c.callApi("updateProject",{params:{pk:l.id},body:E});s(!1),null!==e&&i.push(`/projects/${e.id}/data`)}),[l,E,y]),A=r.useCallback((async()=>{s(!0),l&&await c.callApi("deleteProject",{params:{pk:l.id}}),s(!1),i.replace("/projects"),null==e||e()}),[l]);return(0,Le.jsx)(ot,{onHide:A,fullscreen:!0,visible:!0,bare:!0,closeOnClickOutside:!1,children:(0,Le.jsxs)("div",{className:k,children:[(0,Le.jsxs)(ot.Header,{children:[(0,Le.jsx)("h1",{children:"Create Project"}),(0,Le.jsx)(Sn,{items:S,active:t,onSelect:n}),(0,Le.jsxs)(Ke,{children:[(0,Le.jsx)(Ge,{look:"danger",size:"compact",onClick:A,waiting:a,children:"Delete"}),(0,Le.jsx)(Ge,{look:"primary",size:"compact",onClick:N,waiting:a||j,disabled:!l||b||p,children:"Save"})]})]}),(0,Le.jsx)(Da,{name:d,setName:u,error:p,onSaveName:async()=>{var e;if(p)return;const t=await c.callApi("updateProjectRaw",{params:{pk:l.id},body:{title:d}});if(t.ok)return;const n=await t.json();m(null===(e=n.validation_errors)||void 0===e?void 0:e.title)},onSubmit:N,description:h,setDescription:f,show:"name"===t}),(0,Le.jsx)(Oa,{project:l,show:"import"===t,...w}),(0,Le.jsx)(ka,{project:l,onUpdate:g,show:"config"===t,columns:x,disableSaveButton:!0,config:'<View>\n<Paragraphs name="dialogue" value="$dialogue" layout="dialogue" />\n<Choices name="intent" toName="dialogue" choice="multiple" showInLine="true">\n  <Choice value="升级"/>\n  <Choice value="不知情"/>\n  <Choice value="外呼"/>\n</Choices>\n</View>'})]})})};var La=a(5189);const Ma=[],Fa=()=>{0};let Ia=Fa,za=Fa,$a=Fa,Ba=Fa,Ha=Fa,Ua=[];const Va=(0,La.sU)(Ma,(()=>{const[e,t]=(0,r.useState)(Ma);return Ua=e,Ia=e=>{const n=[...null!=e?e:[]];t(n),Ua=n},za=(0,r.useCallback)((e=>{if(!Pe(null==e?void 0:e.key))throw Error("Crumb must have a key");const t=[...Ua,e];Ia(t),Ua=t}),[e]),$a=(0,r.useCallback)((e=>{const t=Ua.filter((t=>t.key!==e));Ia(t),Ua=t}),[e]),Ba=(0,r.useCallback)(((e,t)=>{const n=Ua.map((n=>n.key===e?{...n,onClick:t}:n));Ia(n),Ua=n}),[e]),Ha=(0,r.useCallback)((e=>{const t=Ua.map((t=>(t.key===e&&delete t.onClick,t)));Ia(t),Ua=t}),[e]),e})),qa=()=>{const e=(0,o.k6)(),t=dl(),n=(0,r.useRef)(),a=(()=>{const e=(0,o.k6)(),{pathname:t}=dl();return(0,r.useCallback)((n=>(e.replace("/"),setTimeout((()=>{e.replace(null!=n?n:t)}),10),t)),[t])})(),{project:s}=fl(),[l,i]=(0,r.useState)(!1),c=bt(),{uploading:d,uploadDisabled:u,finishUpload:p,fileIds:m,pageProps:h}=Ra(s),f=(0,r.useCallback)((()=>{const e=t.pathname.replace(Wa.path,""),n=t.search;return a(`${e}${"?"!==n?n:""}`)}),[t,e]),v=(0,r.useCallback)((async()=>{var e;i(!0),await c.callApi("deleteFileUploads",{params:{pk:s.id},body:{file_upload_ids:m}}),i(!1),null==n||null===(e=n.current)||void 0===e||e.hide(),f()}),[n,s,m,f]),g=(0,r.useCallback)((async()=>{await p()&&f()}),[f,p]);return(0,Le.jsxs)(ot,{title:"Import data",ref:n,onHide:()=>f(),closeOnClickOutside:!1,fullscreen:!0,visible:!0,bare:!0,children:[(0,Le.jsxs)(ot.Header,{divided:!0,children:[(0,Le.jsx)(Be,{block:"modal",name:"title",children:"Import Data"}),(0,Le.jsxs)(Ke,{children:[(0,Le.jsx)(Ge,{waiting:l,onClick:v,children:"Cancel"}),(0,Le.jsx)(Ge,{look:"primary",onClick:g,waiting:l||d,disabled:u,children:"Import"})]})]}),(0,Le.jsx)(Oa,{project:s,...h})]})},Wa=()=>(0,Le.jsx)(hl,{children:(0,Le.jsx)(qa,{})});Wa.path="/import",Wa.modal=!0;const{Block:Ga,Elem:Ja}=ze(),Ka=()=>{const e=(0,o.k6)(),t=dl(),n=ol(),a=bt(),[s,l]=(0,r.useState)([]),[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),[p,m]=(0,r.useState)([]),[h,f]=(0,r.useState)("JSON"),v=(0,r.useRef)();return(0,r.useEffect)((()=>{Pe(n.id)&&(a.callApi("previousExports",{params:{pk:n.id}}).then((({export_files:e})=>{l(e.slice(0,1))})),a.callApi("exportFormats",{params:{pk:n.id}}).then((e=>{var t;m(e),f(null===(t=e[0])||void 0===t?void 0:t.name)})))}),[n]),(0,Le.jsx)(ot,{onHide:()=>{const n=t.pathname.replace(Ka.path,""),a=t.search;e.replace(`${n}${"?"!==a?a:""}`)},title:"Export data",style:{width:720},closeOnClickOutside:!1,allowClose:!i,visible:!0,children:(0,Le.jsxs)(Ga,{name:"export-page",children:[(0,Le.jsx)(Za,{availableFormats:p,selected:h,onClick:e=>f(e.name)}),(0,Le.jsx)(Kn,{ref:v,children:(0,Le.jsx)(zn,{type:"hidden",name:"exportType",value:h})}),(0,Le.jsx)(Ja,{name:"footer",children:(0,Le.jsxs)(Ke,{style:{width:"100%"},spread:!0,children:[(0,Le.jsx)(Ja,{name:"recent"}),(0,Le.jsx)(Ja,{name:"actions",children:(0,Le.jsxs)(Ke,{children:[d&&"Files are being prepared. It might take some time.",(0,Le.jsx)(Ja,{tag:Ge,name:"finish",look:"primary",onClick:async()=>{c(!0);const e=setTimeout((()=>{u(!0)}),1e3),t=v.current.assembleFormData({asJSON:!0,full:!0,booleansAsNumbers:!0}),s=await a.callApi("exportRaw",{params:{pk:n.id,...t}});if(s.ok){((e,t)=>{const n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.click()})(await s.blob(),s.headers.get("filename"))}else a.handleError(s);c(!1),u(!1),clearTimeout(e)},waiting:i,children:"Export"})]})})]})})]})})},Za=({availableFormats:e,selected:t,onClick:n})=>(0,Le.jsxs)(Ga,{name:"formats",children:[(0,Le.jsx)(Ja,{name:"info",children:"You can export dataset in one of the following formats:"}),(0,Le.jsx)(Ja,{name:"list",children:e.map((e=>{var a,s;return(0,Le.jsxs)(Ja,{name:"item",mod:{active:!e.disabled,selected:e.name===t},onClick:e.disabled?null:()=>n(e),children:[(0,Le.jsxs)(Ja,{name:"name",children:[e.title,(0,Le.jsx)(Ke,{size:"small",children:null===(a=e.tags)||void 0===a||null===(s=a.map)||void 0===s?void 0:s.call(a,((e,t)=>(0,Le.jsx)(Ja,{name:"tag",children:e},t)))})]}),e.description&&(0,Le.jsx)(Ja,{name:"description",children:e.description})]},e.name)}))}),(0,Le.jsxs)(Ja,{name:"feedback",children:["Can't find an export format?",(0,Le.jsx)("br",{}),"Please let us know in ",(0,Le.jsx)("a",{className:"no-go",href:"https://slack.labelstudio.heartex.com/?source=product-export",children:"Slack"})," or submit an issue to the ",(0,Le.jsx)("a",{className:"no-go",href:"https://github.com/heartexlabs/label-studio-converter/issues",children:"Repository"})]})]});Ka.path="/export",Ka.modal=!0;const Xa={gateway:"/api/dm",endpoints:{project:"/project",columns:"/columns",tabs:"/views",createTab:"POST:/views",updateTab:"PATCH:/views/:tabID",deleteTab:"DELETE:/views/:tabID",annotations:"/views/:tabID/annotations",task:"/../tasks/:taskID",tasks:"/../tasks",nextTask:"/tasks/next",annotation:"/../annotations/:id",skipTask:{method:"post",path:e=>{const t="/../tasks/:taskID/annotations";return!Pe(e.annotationID)?t:`${t}/:annotationID`}},submitAnnotation:"POST:/../tasks/:taskID/annotations",updateAnnotation:"PATCH:/../annotations/:annotationID",deleteAnnotation:"DELETE:/../annotations/:annotationID",setSelectedItems:"POST:/views/:tabID/selected-items",addSelectedItem:"PATCH:/views/:tabID/selected-items",actions:"/actions",deleteSelectedItem:"DELETE:/views/:tabID/selected-items",invokeAction:"POST:/actions"}},Ya=(e,t)=>(0,o.Gn)(`/projects/:id${e}`,t),Qa=({...e})=>{const t=(0,r.useRef)(),n=ol(),a=(0,o.k6)(),s=bt(),{project:l}=fl(),i=At("lsf"),c=At("dm"),d=ul(),[u,p]=(0,r.useState)(!1),m=(0,r.useRef)(),h=null==l?void 0:l.id,f=(0,r.useCallback)((async()=>{var r;if(!i)return;if(!c)return;if(!t.current)return;if(null==l||!l.id)return;if(m.current)return;const o=await s.callApi("mlBackends",{params:{project:l.id}}),u=(null!=o?o:[]).find((({is_interactive:e})=>e)),h=m.current=null!==(r=m.current)&&void 0!==r?r:await(async(e,t,n)=>{if(!window.LabelStudio)throw Error("Label Studio Frontend doesn't exist on the page");if(!e&&e.dataset.dmInitialized)return;e.dataset.dmInitialized=!0;const{...a}=e.dataset,s={root:e,projectId:n.id,apiGateway:`${window.APP_SETTINGS.hostname}/api/dm`,apiVersion:2,project:n.project,polling:!window.APP_SETTINGS,showPreviews:!1,apiEndpoints:Xa.endpoints,interfaces:{import:!0,export:!0,backButton:!1,labelingHeader:!1,autoAnnotation:n.autoAnnotation},labelStudio:{keymap:window.APP_SETTINGS.editor_keymap},...t,...a};return new window.DataManager(s)})(t.current,e,{...n,project:l,autoAnnotation:Pe(u)});Object.assign(window,{dataManager:h}),h.on("crash",(()=>p())),h.on("settingsClicked",(()=>{a.push(Ya("/settings/labeling",{id:n.id}))})),h.on("importClicked",(()=>{a.push(Ya("/data/import",{id:n.id}))})),h.on("exportClicked",(()=>{a.push(Ya("/data/export",{id:n.id}))})),h.on("error",(e=>{s.handleError(e)})),u&&h.on("lsf:regionFinishedDrawing",((e,t)=>{const{lsf:n,task:a,currentAnnotation:l}=h.lsf,r=t.map((e=>e.id)),i=l.serializeAnnotation().filter((e=>r.includes(e.id))),o=s.callApi("mlInteractive",{params:{pk:u.id},body:{task:a.id,context:{result:i}}});n.loadSuggestions(o,(e=>e.data?e.data.result:[]))})),d({dmRef:h})}),[i,c,h]),v=(0,r.useCallback)((()=>{m.current&&(m.current.destroy(),m.current=null)}),[m]);return(0,r.useEffect)((()=>(f(),()=>v())),[t,f]),c&&i?u?(0,Le.jsxs)($e,{name:"crash",children:[(0,Le.jsx)(Be,{name:"info",children:"Project was deleted or not yet created"}),(0,Le.jsx)(Ge,{to:"/projects",children:"Back to projects"})]}):(0,Le.jsx)($e,{ref:t,name:"datamanager"}):(0,Le.jsx)("div",{style:{flex:1,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,Le.jsx)(Cn,{size:64})})};Qa.path="/data",Qa.pages={ExportPage:Ka,ImportModal:Wa},Qa.context=({dmRef:e})=>{var t;const n=dl(),{project:a}=fl(),[s,l]=(0,r.useState)(null!==(t=null==e?void 0:e.mode)&&void 0!==t?t:"explorer"),i={"/settings":(0,Wt.t)("Settings")},o=t=>{l(t),(t=>{const a="explorer"===t,s=n.pathname.replace(Qa.path,"");a?(Ha(s),$a("dm-crumb")):(Ba(s,(t=>{var n,a;t.preventDefault(),t.stopPropagation(),null==e||null===(n=e.store)||void 0===n||null===(a=n.closeLabeling)||void 0===a||a.call(n)})),za({key:"dm-crumb",title:"Labeling"}))})(t),(e=>{const t="labelstream"===e,{expert_instruction:n,show_instruction:s}=a;t&&s&&n&&dt({title:"Labeling Instructions",body:(0,Le.jsx)("div",{dangerouslySetInnerHTML:{__html:n}}),style:{width:680}})})(t)};return(0,r.useEffect)((()=>(e&&e.on("modeChanged",o),()=>{var t;null==e||null===(t=e.off)||void 0===t||t.call(e,"modeChanged",o)})),[e,a]),a&&a.id?(0,Le.jsxs)(Ke,{size:"small",children:[a.expert_instruction&&"explorer"!==s&&(0,Le.jsx)(Ge,{size:"compact",onClick:()=>{dt({title:"Instructions",body:()=>(0,Le.jsx)("div",{dangerouslySetInnerHTML:{__html:a.expert_instruction}})})},children:"Instructions"}),Object.entries(i).map((([e,t])=>(0,Le.jsx)(Ge,{tag:Tt.OL,size:"compact",to:`/projects/${a.id}${e}`,"data-external":!0,children:t},e)))]}):null};const es=({onDelete:e})=>dt({title:"Delete",body:()=>{ct();const e=Ie("webhook-delete-modal");return(0,Le.jsx)("div",{className:e,children:(0,Le.jsx)("div",{className:e.elem("modal-text"),children:"Are you sure you want to delete the webhook? This action cannot be undone."})})},footer:()=>{const t=ct(),n=Ie("webhook-delete-modal");return(0,Le.jsxs)(Ke,{align:"end",children:[(0,Le.jsx)(Ge,{className:n.elem("width-button"),onClick:()=>{t.hide()},children:"Cancel"}),(0,Le.jsx)(Ge,{look:"destructive",className:n.elem("width-button"),onClick:async()=>{await e(),t.hide()},children:"Delete"})]})},style:{width:512}}),ts=({onSelectActive:e,onAddWebhook:t,webhooks:n,fetchWebhooks:a})=>{const s=bt();if(null===n)return(0,Le.jsx)(Le.Fragment,{});const l=(0,r.useCallback)((async e=>{let t=e.target.checked;await s.callApi("updateWebhook",{params:{pk:e.target.name},body:{is_active:t}}),await a()}),[s]);return(0,Le.jsxs)($e,{name:"webhook",children:[(0,Le.jsx)(Be,{name:"controls",children:(0,Le.jsx)(Ge,{onClick:t,children:"Add Webhook"})}),(0,Le.jsx)(Be,{children:0===n.length?null:(0,Le.jsx)($e,{name:"webhook-list",children:n.map((t=>(0,Le.jsxs)(Be,{name:"item",children:[(0,Le.jsx)(Be,{name:"item-active",children:(0,Le.jsx)(Hn,{name:t.id,checked:t.is_active,onChange:l})}),(0,Le.jsx)(Be,{name:"item-url",onClick:()=>e(t.id),children:t.url}),(0,Le.jsxs)(Be,{name:"item-date",children:["Created ",(0,vn.Z)(new Date(t.created_at),"dd MMM yyyy, HH:mm")]}),(0,Le.jsxs)(Be,{name:"item-control",children:[(0,Le.jsx)(Ge,{onClick:()=>e(t.id),icon:(0,Le.jsx)(Ne,{}),children:"Edit"}),(0,Le.jsx)(Ge,{onClick:()=>es({onDelete:async()=>{await s.callApi("deleteWebhook",{params:{pk:t.id}}),await a()}}),look:"danger",icon:(0,Le.jsx)(w,{}),children:"Delete"})]})]},t.id)))})})]})};var ns=a(9392);const as=({webhook:e,webhooksInfo:t,fetchWebhooks:n,onBack:a,onSelectActive:s})=>{const l=Ie("webhook-detail"),i=bt(),[o,c]=(0,r.useState)(Object.entries((null==e?void 0:e.headers)||[])),[d,u]=(0,r.useState)(!e||e.send_for_all_actions),[p,m]=(0,r.useState)(new Set(null==e?void 0:e.actions)),[h,f]=(0,r.useState)(!e||e.is_active),[v,g]=(0,r.useState)(!e||e.send_payload),{project:x}=fl(),[j,b]=(0,r.useState)(x.id);(0,r.useEffect)((()=>{0===Object.keys(x).length?b(null):b(x.id)}),[x]);const y=(e,t,n)=>{let a=(0,ns.cloneDeep)(o);"key"===e&&(a[n][0]=t.target.value),"value"===e&&(a[n][1]=t.target.value),c(a)},k=e=>{let t=new Set(p);e.target.checked?t.add(e.target.name):t.delete(e.target.name),m(t)};return(0,r.useEffect)((()=>{if(null===e)return c([]),u(!0),m(new Set),f(!0),void g(!0);c(Object.entries(e.headers)),u(e.send_for_all_actions),m(new Set(e.actions)),f(e.is_active),g(e.send_payload)}),[e]),void 0===j?(0,Le.jsx)(Le.Fragment,{}):(0,Le.jsxs)($e,{name:"webhook",children:[(0,Le.jsx)(Be,{name:"title",children:(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(Be,{tag:"span",name:"title-base",onClick:()=>{s(null)},children:"Webhooks"}),"  /  ",null===e?"New Webhook":"Edit Webhook"]})}),(0,Le.jsx)(Be,{name:"content",children:(0,Le.jsx)($e,{name:"webhook-detail",children:(0,Le.jsxs)(Kn,{action:null===e?"createWebhook":"updateWebhook",params:null===e?{}:{pk:e.id},formData:e,prepareData:e=>({...e,project:j,send_for_all_actions:d,headers:Object.fromEntries(o.filter((([e])=>""!==e))),actions:Array.from(p),is_active:h,send_payload:v}),onSubmit:async e=>{e.error_message||(await n(),s(null))},children:[(0,Le.jsxs)(Kn.Row,{style:{marginBottom:"40px"},columnCount:1,children:[(0,Le.jsx)(_n,{text:"Payload URL",style:{marginLeft:"-16px"},large:!0}),(0,Le.jsxs)(Ke,{className:l.elem("url-space"),children:[(0,Le.jsx)(zn,{name:"url",className:l.elem("url-input"),placeholder:"URL"}),(0,Le.jsxs)(Ke,{align:"end",className:l.elem("activator"),children:[(0,Le.jsx)("span",{className:l.elem("black-text"),children:"Is Active"}),(0,Le.jsx)(Hn,{skip:!0,checked:h,onChange:e=>{f(e.target.checked)}})]})]})]}),(0,Le.jsx)(Kn.Row,{style:{marginBottom:"40px"},columnCount:1,children:(0,Le.jsx)("div",{className:l.elem("headers"),children:(0,Le.jsxs)("div",{className:l.elem("headers-content"),children:[(0,Le.jsxs)(Ke,{spread:!0,className:l.elem("headers-control"),children:[(0,Le.jsx)(_n,{text:"Headers",large:!0}),(0,Le.jsx)(Ge,{type:"button",onClick:()=>{c([...o,["",""]])},className:l.elem("headers-add"),icon:(0,Le.jsx)(oe,{})})]}),o.map((([e,t],n)=>(0,Le.jsxs)(Ke,{className:l.elem("headers-row"),columnCount:3,children:[(0,Le.jsx)(zn,{className:l.elem("headers-input"),skip:!0,placeholder:"header",value:e,onChange:e=>y("key",e,n)}),(0,Le.jsx)(zn,{className:l.elem("headers-input"),skip:!0,placeholder:"value",value:t,onChange:e=>y("value",e,n)}),(0,Le.jsx)("div",{children:(0,Le.jsx)(Ge,{className:l.elem("headers-remove"),type:"button",icon:(0,Le.jsx)(w,{}),onClick:()=>(e=>{let t=(0,ns.cloneDeep)(o);t.splice(e,1),c(t)})(n)})})]},n)))]})})}),(0,Le.jsxs)($e,{name:"webhook-payload",style:{marginBottom:"40px"},children:[(0,Le.jsx)(Be,{name:"title",children:(0,Le.jsx)(_n,{text:"Payload",large:!0})}),(0,Le.jsxs)(Be,{name:"content",children:[(0,Le.jsx)(Be,{name:"content-row",children:(0,Le.jsx)(Hn,{skip:!0,checked:v,onChange:e=>{g(e.target.checked)},label:"Send payload"})}),(0,Le.jsx)(Be,{name:"content-row",children:(0,Le.jsx)(Hn,{skip:!0,checked:d,label:"Send for all actions",onChange:e=>{u(e.target.checked)}})}),(0,Le.jsx)("div",{children:d?null:(0,Le.jsxs)(Be,{name:"content-row-actions",children:[(0,Le.jsx)(Be,{tag:"h4",name:"title",mod:{black:!0},children:"Send Payload for"}),(0,Le.jsx)(Be,{name:"actions",children:Object.entries(t).map((([e,t])=>(0,Le.jsx)(Kn.Row,{columnCount:1,children:(0,Le.jsx)("div",{children:(0,Le.jsx)(Hn,{skip:!0,name:e,type:"checkbox",label:t.name,onChange:k,checked:p.has(e)})})},e)))})]})})]})]}),(0,Le.jsxs)(Be,{name:"controls",children:[null===e?null:(0,Le.jsx)(Ge,{look:"danger",type:"button",className:l.elem("delete-button"),onClick:()=>es({onDelete:async()=>{await i.callApi("deleteWebhook",{params:{pk:e.id}}),a(),await n()}}),children:"Delete Webhook..."}),(0,Le.jsx)("div",{className:l.elem("status"),children:(0,Le.jsx)(Kn.Indicator,{})}),(0,Le.jsx)(Ge,{type:"button",className:l.elem("cancel-button"),onClick:a,children:"Cancel"}),(0,Le.jsx)(Ge,{primary:!0,className:l.elem("save-button"),children:null===e?"Add Webhook":"Save"})]})]})})})]})},ss={title:"Webhooks",path:"/webhooks",component:()=>{const[e,t]=(0,r.useState)(null),[n,a]=(0,r.useState)(null),[s,l]=(0,r.useState)(null),i=(0,o.k6)(),c=bt(),{project:d}=fl(),u=(0,r.useMemo)((()=>i.location.pathname.startsWith("/projects")?0===Object.keys(d).length?null:d.id:void 0),[d,i]);console.log(u,i.location.pathname);const p=(0,r.useCallback)((async()=>{if(null===u)return void a(null);let e={};e.project=void 0!==u?u:null;const t=await c.callApi("webhooks",{params:e});t&&a(t)}),[c,u]),m=(0,r.useCallback)((async()=>{if(null===u)return void l(null);let e={};void 0!==u&&(e["organization-only"]=!1);const t=await c.callApi("webhooksInfo",{params:e});t&&l(t)}),[c,u]);if((0,r.useEffect)((()=>{p(),m()}),[c,d,u]),null===n||null===s||null===u)return null;let h=null;return h="new"===e?(0,Le.jsx)(as,{onSelectActive:t,onBack:()=>t(null),webhook:null,fetchWebhooks:p,webhooksInfo:s}):null===e?(0,Le.jsx)(ts,{onSelectActive:t,onAddWebhook:()=>{t("new")},fetchWebhooks:p,webhooks:n}):(0,Le.jsx)(as,{onSelectActive:t,onBack:()=>t(null),webhook:n[n.findIndex((t=>t.id===e))],fetchWebhooks:p,webhooksInfo:s}),(0,Le.jsxs)($e,{name:"webhook-wrap",children:[h,(0,Le.jsxs)(Be,{name:"footer",children:[(0,Le.jsx)(Be,{name:"footer-icon",children:(0,Le.jsx)(V,{width:"28",height:"28"})}),(0,Le.jsxs)(Be,{name:"footer-text",children:[(0,Le.jsx)("p",{children:"Webhooks allow external services to be notified when certain events happen. When the specified events occur, a POST request is sent to each of the URLs you provide."}),(0,Le.jsxs)("p",{children:[(0,Le.jsx)("a",{href:"https://labelstud.io/guide/webhooks.html",children:"Read more in the documentation"}),"."]})]})]})]})}},ls=()=>{const{project:e}=fl(),t=bt(),n=(0,o.k6)(),[a,s]=(0,r.useState)(null),l=(0,r.useMemo)((()=>[{type:"annotations",disabled:!0,label:`Delete ${e.total_annotations_number} Annotations`},{type:"tasks",disabled:!0,label:`Delete ${e.task_number} Tasks`},{type:"predictions",disabled:!0,label:`Delete ${e.total_predictions_number} Predictions`},{type:"tabs",label:"Drop All Tabs"},{type:"project",label:"Delete Project"}]),[e]);return(0,Le.jsxs)("div",{style:{width:480},children:[(0,Le.jsx)(_n,{text:"Delete Annotations, Tasks, or Project",description:"Perform these actions at your own risk. Actions you take on this page can't be reverted. Make sure your data is backed up.",style:{display:"block",width:415}}),e.id?(0,Le.jsx)(Ke,{direction:"vertical",spread:!0,style:{marginTop:32},children:l.map((l=>{const r=a===l.type,i=l.disabled||a&&!r;return!0!==l.disabled&&(0,Le.jsx)(Ge,{look:"danger",disabled:i,waiting:r,onClick:(o=l.type,()=>{ut({title:"Action confirmation",body:"You're about to delete all things. This action cannot be undone.",okText:"Proceed",buttonLook:"destructive",onOk:async()=>{s(o),"annotations"===o||"tasks"===o||"predictions"===o||("tabs"===o?await t.callApi("deleteTabs",{body:{project:e.id}}):"project"===o&&(await t.callApi("deleteProject",{params:{pk:e.id}}),n.replace("/projects"))),s(null)}})}),children:l.label},l.type);var o}))}):(0,Le.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:32},children:(0,Le.jsx)(Cn,{size:32})})]})};ls.title="Danger Zone",ls.path="/danger-zone";const rs=(0,r.createContext)(),{Block:is,Elem:os}=ze(),cs=({label:e,className:t,validate:n,required:a,skip:s,simple:l,labelProps:i,size:o,value:c,onChange:d,children:u,...p})=>{const[m,h]=(0,r.useState)(c),f=(0,Le.jsx)(Dn,{name:p.name,label:e,validate:n,required:a,skip:s,setValue:e=>h(e),...p,children:(e,n,a)=>(0,Le.jsx)(rs.Provider,{value:{value:m,onChange:e=>{(e=>{h(e),null==d||d(e)})(e),a.autosubmit()},setValue:h,isSimple:!0===l},children:(0,Le.jsxs)(is,{name:"radio-group",mod:{size:o,simple:l},mix:t,children:[(0,Le.jsx)("input",{ref:e,name:p.name,type:"hidden",defaultValue:m}),(0,Le.jsx)(os,{name:"buttons",children:u})]})})});return e?(0,Le.jsx)(_n,{...null!=i?i:{},text:e,simple:l,required:a,children:f}):f};cs.Button=({value:e,disabled:t,children:n,label:a,description:s,...l})=>{const{onChange:i,setValue:o,value:c,isSimple:d}=(0,r.useContext)(rs),u=e===c,p=(0,r.useCallback)((t=>{t.preventDefault(),t.stopPropagation(),i(e)}),[e]);return(0,r.useEffect)((()=>{l.checked&&o(e)}),[l.checked]),(0,Le.jsx)(os,{name:"button",mod:{checked:u,disabled:t},onClickCapture:p,children:d?(0,Le.jsx)(_n,{placement:"right",text:a,description:s,children:(0,Le.jsx)("input",{type:"radio",value:e,checked:u,readOnly:!0,style:{pointerEvents:"none"}})}):n})};const ds=()=>{const{project:e,fetchProject:t}=(0,r.useContext)(pl),n=(0,r.useCallback)((()=>{e.id&&t(e.id,!0)}),[e]);return(0,Le.jsx)("div",{style:{width:480},children:(0,Le.jsxs)(Kn,{action:"updateProject",formData:{...e},params:{pk:e.id},onSubmit:n,children:[(0,Le.jsxs)(Kn.Row,{columnCount:1,rowGap:"32px",children:[(0,Le.jsx)(zn,{name:"title",label:"Project Name",labelProps:{large:!0}}),(0,Le.jsx)(Bn,{name:"description",label:"Description",labelProps:{large:!0},style:{minHeight:128}}),(0,Le.jsx)(cs,{name:"color",label:"Color",size:"large",labelProps:{size:"large"},children:["#FFFFFF","#F52B4F","#FA8C16","#F6C549","#9ACA4F","#51AAFD","#7F64FF","#D55C9D"].map((e=>(0,Le.jsx)(cs.Button,{value:e,children:(0,Le.jsx)($e,{name:"color",style:{"--background":e}})},e)))}),(0,Le.jsx)(cs,{label:"Task Sampling",labelProps:{size:"large"},name:"sampling",simple:!0,children:[{value:"Sequential",label:"Sequential",description:"Tasks are ordered by Data manager ordering"},{value:"Uniform",label:"Random",description:"Tasks are chosen with uniform random"}].map((({value:e,label:t,description:n})=>(0,Le.jsx)(cs.Button,{value:`${e} sampling`,label:`${t} sampling`,description:n},e)))})]}),(0,Le.jsxs)(Kn.Actions,{children:[(0,Le.jsx)(Kn.Indicator,{children:(0,Le.jsx)("span",{case:"success",children:"Saved!"})}),(0,Le.jsx)(Ge,{type:"submit",look:"primary",style:{width:120},children:"Save"})]})]})})};ds.menuItem="General",ds.path="/",ds.exact=!0;const us=()=>{const{project:e,fetchProject:t}=(0,r.useContext)(pl),n=(0,r.useContext)(jn),a=(0,r.useRef)();(0,r.useEffect)((()=>{n.setProps({formRef:a})}),[a]);const s=(0,r.useCallback)((()=>{t(e.id,!0)}),[e]);return(0,Le.jsx)("div",{style:{width:480},children:(0,Le.jsxs)(Kn,{ref:a,action:"updateProject",formData:{...e},params:{pk:e.id},onSubmit:s,children:[(0,Le.jsxs)(Kn.Row,{columnCount:1,children:[(0,Le.jsx)(_n,{text:"Labeling Instructions",large:!0}),(0,Le.jsx)("div",{style:{paddingLeft:16},children:(0,Le.jsx)(Hn,{label:"Show before labeling",name:"show_instruction"})}),(0,Le.jsx)("div",{style:{color:"rgba(0,0,0,0.4)",paddingLeft:16},children:"Write instructions to help users complete labeling tasks."})]}),(0,Le.jsx)(Kn.Row,{columnCount:1,children:(0,Le.jsx)(Bn,{name:"expert_instruction",style:{minHeight:128}})}),(0,Le.jsxs)(Kn.Actions,{children:[(0,Le.jsx)(Kn.Indicator,{children:(0,Le.jsx)("span",{case:"success",children:"Saved!"})}),(0,Le.jsx)(Ge,{type:"submit",look:"primary",style:{width:120},children:"Save"})]})]})})};us.title="Instructions",us.path="/instruction";const ps=()=>{const e=(0,o.k6)(),{project:t,fetchProject:n}=fl(),[a,s]=(0,r.useState)(""),[l,i]=(0,r.useState)(!1),c=bt(),d=(0,r.useCallback)((async()=>{const s=await c.callApi("updateProjectRaw",{params:{pk:t.id},body:{label_config:a}});if(s.ok)return e.push(`/projects/${t.id}/data`),!0;const l=await s.json();return n(),l}),[t,a]),u=(0,r.useMemo)((()=>{if(t.label_config){const e=!Te(t.label_config),n="<View></View>"===t.label_config.replace(/\s/g,""),a=t.task_number>0;return console.log({hasConfig:e,configIsEmpty:n,hasTasks:a,project:t}),e&&!n&&a}return!1}),[t]),p=(0,r.useCallback)((async()=>{l&&u?ut({title:"Config data changed",body:"Labeling config has essential changes that affect data displaying. Saving the config may lead to deleting all tabs previously created in the Data Manager.",buttonLook:"destructive",onOk:()=>d(),okText:"Save"}):d()}),[l,d]),m=(0,r.useCallback)((e=>{s(e),n()})),h=(0,r.useCallback)((e=>{i(e.config_essential_data_has_changed)}),[]);return t.id?(0,Le.jsx)(ka,{config:t.label_config,project:t,onUpdate:m,onSaveClick:p,onValidate:h}):null};ps.title="Labeling Interface",ps.path="/labeling";const ms=({children:e,className:t,size:n="medium",noOffset:a=!1,...s})=>(0,Le.jsx)($e,{name:"description",mod:{size:n,noOffset:a},mix:t,...s,children:e}),hs=({height:e})=>(0,Le.jsx)("div",{style:{height:e}}),fs=({children:e,includeValidation:t,className:n,style:a})=>{const s=r.useContext(ft);return r.useEffect((()=>{s.showModal=!1}),[s]),s.error?(0,Le.jsxs)($e,{name:"inline-error",mix:n,style:a,children:[(0,Le.jsx)(Ze,{possum:!1,...s.errorFormatter(s.error,{includeValidation:t})}),e]}):null};var vs=a(5674),gs=a.n(vs);const xs=({style:e,className:t,children:n})=>(0,Le.jsx)("dl",{className:Ie("dl").mix(t),style:e,children:n});xs.Item=({retmClassName:e,descriptionClassName:t,term:n,descriptionStyle:a,termStyle:s,children:l})=>(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)("dt",{className:Ie("dl").elem("dt").mix(e),style:a,children:n}),(0,Le.jsx)("dd",{className:Ie("dl").elem("dd").mix(t),style:s,children:l})]});const js=({backends:e,fetchBackends:t,onEdit:n})=>{const a=Ie("ml"),s=(0,r.useContext)(ft),l=(0,r.useCallback)((async e=>{await s.callApi("deleteMLBackend",{params:{pk:e.id}}),await t()}),[t,s]),i=(0,r.useCallback)((async e=>{await s.callApi("trainMLBackend",{params:{pk:e.id}}),await t()}),[t,s]);return(0,Le.jsx)("div",{className:a,children:e.map((e=>(0,Le.jsx)(bs,{backend:e,onStartTrain:i,onDelete:l,onEdit:n},e.id)))})},bs=({backend:e,onStartTrain:t,onEdit:n,onDelete:a})=>{const s=(0,r.useCallback)((e=>{ut({title:"Delete ML Backend",body:"This action cannot be undone. Are you sure?",buttonLook:"destructive",onOk(){null==a||a(e)}})}),[e,a]);return(0,Le.jsxs)(Ut,{style:{marginTop:0},header:e.title,extra:(0,Le.jsxs)("div",{className:Ie("ml").elem("info"),children:[(0,Le.jsx)(ys,{backend:e}),(0,Le.jsx)(Lt.Trigger,{align:"right",content:(0,Le.jsxs)(zt,{size:"small",children:[(0,Le.jsx)(zt.Item,{onClick:()=>n(e),children:"Edit"}),(0,Le.jsx)(zt.Item,{onClick:()=>s(e),children:"Delete"})]}),children:(0,Le.jsx)(Ge,{type:"link",icon:(0,Le.jsx)(Nn.EAB,{})})})]}),children:[(0,Le.jsxs)(xs,{className:Ie("ml").elem("summary"),children:[(0,Le.jsx)(xs.Item,{term:"URL",termStyle:{whiteSpace:"nowrap"},children:gs()(e.url,20,10,"...")}),e.description&&(0,Le.jsx)(xs.Item,{term:"Description",children:e.description}),(0,Le.jsx)(xs.Item,{term:"Version",children:e.version?(0,vn.Z)(new Date(e.version),"MMMM dd, yyyy ∙ HH:mm:ss"):"unknown"})]}),(0,Le.jsx)(Ge,{disabled:"CO"!==e.state,onClick:()=>t(e),children:"Start Training"})]})},ys=({backend:e})=>{const{state:t}=e;return(0,Le.jsxs)("div",{className:Ie("ml").elem("status"),children:[(0,Le.jsx)("span",{className:Ie("ml").elem("indicator").mod({state:t})}),(0,Le.jsxs)(An,{value:t,className:Ie("ml").elem("status-label"),children:[(0,Le.jsx)("span",{case:"DI",children:"Disconnected"}),(0,Le.jsx)("span",{case:"CO",children:"Connected"}),(0,Le.jsx)("span",{case:"ER",children:"Error"}),(0,Le.jsx)("span",{case:"TR",children:"Training"}),(0,Le.jsx)("span",{case:"PR",children:"Predicting"})]})]})},ws=()=>{const e=bt(),{project:t,fetchProject:n,updateProject:a}=(0,r.useContext)(pl),[s,l]=(0,r.useState)(),[i,o]=(0,r.useState)([]),[c,d]=(0,r.useState)([]),u=(0,r.useCallback)((async e=>{e.preventDefault(),e.stopPropagation(),await a({model_version:null})}),[e,t]),p=(0,r.useCallback)((async()=>{const n=await e.callApi("mlBackends",{params:{project:t.id}});n&&o(n)}),[e,t,o]),m=(0,r.useCallback)((async()=>{const n=await e.callApi("modelVersions",{params:{pk:t.id}});var a=[];for(const[e,t]of Object.entries(n))a.push({value:e,label:e+" ("+t+" predictions)"});d(a)}),[e,t.id]),h=(0,r.useCallback)((e=>{const n=e?"updateMLBackend":"addMLBackend";console.log({backend:e});const a={title:(e?"Edit":"Add")+" model",style:{width:760},closeOnClickOutside:!1,body:(0,Le.jsxs)(Kn,{action:n,formData:{...null!=e?e:{}},params:{pk:null==e?void 0:e.id},onSubmit:async e=>{e.error_message||(await p(),s.close())},children:[(0,Le.jsx)(zn,{type:"hidden",name:"project",value:t.id}),(0,Le.jsxs)(Kn.Row,{columnCount:2,children:[(0,Le.jsx)(zn,{name:"title",label:"Title",placeholder:"ML Model"}),(0,Le.jsx)(zn,{name:"url",label:"URL",required:!0})]}),(0,Le.jsx)(Kn.Row,{columnCount:1,children:(0,Le.jsx)(Bn,{name:"description",label:"Description",style:{minHeight:120}})}),(0,Le.jsx)(Kn.Row,{columnCount:1,children:(0,Le.jsx)(Hn,{name:"is_interactive",label:"Use for interactive preannotations"})}),(0,Le.jsx)(Kn.Actions,{children:(0,Le.jsx)(Ge,{type:"submit",look:"primary",onClick:()=>l(null),children:"Validate and Save"})}),(0,Le.jsx)(Kn.ResponseParser,{children:t=>(0,Le.jsx)(Le.Fragment,{children:t.error_message&&(0,Le.jsx)(Ze,{error:{response:{detail:`Failed to ${e?"save":"add new"} ML backend.`,exc_info:t.error_message}}})})}),(0,Le.jsx)(fs,{})]})},s=dt(a)}),[t,p,s]);return(0,r.useEffect)((()=>{t.id&&(p(),m())}),[t]),(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(ms,{style:{marginTop:0,maxWidth:680},children:"Add one or more machine learning models to predict labels for your data. To import predictions without connecting a model."}),(0,Le.jsx)(Ge,{onClick:()=>h(),children:"Add Model"}),(0,Le.jsx)(hs,{height:32}),(0,Le.jsxs)(Kn,{action:"updateProject",formData:{...t},params:{pk:t.id},onSubmit:()=>n(),autosubmit:!0,children:[(0,Le.jsxs)(Kn.Row,{columnCount:1,children:[(0,Le.jsx)(_n,{text:"ML-Assisted Labeling",large:!0}),(0,Le.jsx)("div",{style:{paddingLeft:16},children:(0,Le.jsx)(Hn,{label:"Start model training after any annotations are submitted or updated",name:"start_training_on_annotation_update"})}),(0,Le.jsx)("div",{style:{paddingLeft:16},children:(0,Le.jsx)(Hn,{label:"Retrieve predictions when loading a task automatically",name:"evaluate_predictions_automatically"})}),(0,Le.jsx)("div",{style:{paddingLeft:16},children:(0,Le.jsx)(Hn,{label:"Show predictions to annotators in the Label Stream and Quick View",name:"show_collab_predictions"})})]}),c.length>1&&(0,Le.jsxs)(Kn.Row,{columnCount:1,children:[(0,Le.jsx)(_n,{text:"Model Version",description:"Model version allows you to specify which prediction will be shown to the annotators.",style:{marginTop:16},large:!0}),(0,Le.jsxs)("div",{style:{display:"flex",alignItems:"center",width:400,paddingLeft:16},children:[(0,Le.jsx)("div",{style:{flex:1,paddingRight:16},children:(0,Le.jsx)($n,{name:"model_version",defaultValue:null,options:[...c],placeholder:"No model version selected"})}),(0,Le.jsx)(Ge,{onClick:u,children:"Reset"})]})]})]}),(0,Le.jsx)(js,{onEdit:e=>h(e),fetchBackends:p,backends:i})]})};ws.title="Machine Learning",ws.path="/ml";const ks=({storage:e,className:t,storageTypes:n=[]})=>{var a,s;return(0,Le.jsx)("div",{className:t,children:(0,Le.jsxs)(xs,{children:[(0,Le.jsx)(xs.Item,{term:"Type",children:null!==(a=null===(s=n.find((t=>t.name===e.type)))||void 0===s?void 0:s.title)&&void 0!==a?a:e.type}),(0,Le.jsxs)(An,{value:e.type,children:[(0,Le.jsx)(Cs,{case:"s3",storage:e}),(0,Le.jsx)(Ss,{case:"gcs",storage:e}),(0,Le.jsx)(Es,{case:"azure",storage:e}),(0,Le.jsx)(Ns,{case:"redis",storage:e}),(0,Le.jsx)(As,{case:"localfiles",storage:e})]}),(0,Le.jsx)(xs.Item,{term:"Last Sync",children:e.last_sync?(0,vn.Z)(new Date(e.last_sync),"MMMM dd, yyyy ∙ HH:mm:ss"):"Never synced"})]})})},Cs=({storage:e})=>(0,Le.jsx)(xs.Item,{term:"Bucket",children:e.bucket}),Ss=({storage:e})=>(0,Le.jsx)(xs.Item,{term:"Bucket",children:e.bucket}),Es=({storage:e})=>(0,Le.jsx)(xs.Item,{term:"Container",children:e.container}),Ns=({storage:e})=>(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(xs.Item,{term:"Path",children:e.path}),(0,Le.jsxs)(xs.Item,{term:"Host",children:[e.host,e.port?`:${e.post}`:""]})]}),As=({storage:e})=>(0,Le.jsx)(xs.Item,{term:"Path",children:e.path}),Ps=({rootClass:e,target:t,storage:n,onEditStorage:a,onDeleteStorage:s,storageTypes:l})=>{var i;const[o,c]=(0,r.useState)(!1),d=(0,r.useContext)(ft),[u,p]=(0,r.useState)({...n}),[m,h]=(0,r.useState)(null),f=(0,r.useCallback)((async()=>{c(!0),h(null);const e=await d.callApi("syncStorage",{params:{target:t,type:u.type,pk:u.id}});e&&(p(e),h(e.last_sync_count)),c(!1)}),[n]);return(0,r.useEffect)((()=>{p(n)}),[n]),(0,Le.jsxs)(Ut,{header:null!==(i=u.title)&&void 0!==i?i:`Untitled ${u.type}`,extra:(0,Le.jsx)(Lt.Trigger,{align:"right",content:(0,Le.jsxs)(zt,{size:"compact",style:{width:110},children:[(0,Le.jsx)(zt.Item,{onClick:()=>a(u),children:"Edit"}),(0,Le.jsx)(zt.Item,{onClick:()=>s(u),children:"Delete"})]}),children:(0,Le.jsx)(Ge,{type:"link",style:{width:32,height:32,marginRight:-10},icon:(0,Le.jsx)(Nn.EAB,{})})}),children:[(0,Le.jsx)(ks,{storage:u,className:e.elem("summary"),storageTypes:l}),(0,Le.jsx)("div",{className:e.elem("sync"),children:(0,Le.jsxs)(Ke,{size:"small",children:[(0,Le.jsx)(Ge,{waiting:o,onClick:f,children:"Sync Storage"}),null!==m?(0,Le.jsxs)("div",{className:e.elem("sync-count"),children:["Synced ",m," task(s)"]}):null]})})]})},Ts=(0,r.forwardRef)((({onSubmit:e,target:t,project:n,rootClass:a,storage:s,storageTypes:l},i)=>{var o,c,d,u;const p=(0,r.useContext)(ft),m=null!=i?i:(0,r.useRef)(),[h,f]=(0,r.useState)(null!==(o=null!==(c=null==s?void 0:s.type)&&void 0!==c?c:null==l||null===(d=l[0])||void 0===d?void 0:d.name)&&void 0!==o?o:"s3"),[v,g]=(0,r.useState)(!1),[x,j]=(0,r.useState)(null),[b,y]=(0,r.useState)([]);(0,r.useEffect)((()=>{p.callApi("storageForms",{params:{target:t,type:h}}).then((e=>y(null!=e?e:[])))}),[h]);const w={columnCount:1,fields:[{skip:!0,type:"select",name:"storage_type",label:"Storage Type",disabled:!!s,options:l.map((({name:e,title:t})=>({value:e,label:t}))),value:null!==(u=null==s?void 0:s.type)&&void 0!==u?u:h,onChange:e=>{f(e.target.value)}}]},k=(0,r.useCallback)((async()=>{g(!0),j(null);const e=m.current;if(e&&e.validateFields()){const n=e.assembleFormData({asJSON:!0}),a=e.getField("storage_type").value;Pe(null==s?void 0:s.id)&&(n.id=s.id);const l=await e.api.callApi("validateStorage",{params:{target:t,type:a},body:n});j(null!==l)}g(!1)}),[m,t,h,s]),C=(0,r.useMemo)((()=>s?"updateStorage":"createStorage"),[s]);return(0,Le.jsxs)(Kn.Builder,{ref:m,action:C,params:{target:t,type:h,project:n,pk:null==s?void 0:s.id},fields:[w,...null!=b?b:[]],formData:{...null!=s?s:{}},skipEmpty:!1,onSubmit:e,autoFill:"off",autoComplete:"off",children:[(0,Le.jsx)(zn,{type:"hidden",name:"project",value:n}),(0,Le.jsxs)(Kn.Actions,{valid:x,extra:null!==x&&(0,Le.jsx)($e,{name:"form-indicator",children:(0,Le.jsxs)(An,{value:x,children:[(0,Le.jsx)(Be,{tag:"span",mod:{type:"success"},name:"item",case:!0,children:"Successfully connected!"}),(0,Le.jsx)(Be,{tag:"span",mod:{type:"fail"},name:"item",case:!1,children:"Connection failed"})]})}),children:[(0,Le.jsx)(zn,{type:"hidden",name:"project",value:n}),(0,Le.jsxs)(Ge.Group,{className:a.elem("buttons"),children:[(0,Le.jsx)(Ge,{type:"button",waiting:v,onClick:k,children:"Check Connection"}),(0,Le.jsx)(Ge,{type:"submit",look:"primary",children:s?"Save":"Add Storage"})]})]}),(0,Le.jsx)(fs,{})]})})),Os=({title:e,target:t,rootClass:n,buttonLabel:a})=>{const s=(0,r.useContext)(ft),{project:l}=fl(),[i,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!1),[m,h]=(0,r.useState)([]);(0,r.useEffect)((()=>{s.callApi("storageTypes",{params:{target:t}}).then((e=>{h(e)}))}),[]);const f=(0,r.useCallback)((async()=>{if(!l.id)return void console.warn("Project ID not provided");d(!0);const e=await s.callApi("listStorages",{params:{project:l.id,target:t}}),n=await s.callApi("storageTypes",{params:{target:t}});h(n),null!==e&&(o(e),p(!0)),d(!1)}),[l]),v=(0,r.useCallback)((e=>{const a=dt({title:`${e?"Edit":"Add"} ${"export"===t?"Target":"Source"} Storage`,closeOnClickOutside:!1,style:{width:760},body:(0,Le.jsx)(Ts,{target:t,storage:e,project:l.id,rootClass:n,storageTypes:m,onSubmit:async()=>{await f(),a.close()}}),footer:(0,Le.jsx)(Le.Fragment,{children:"Save completed annotations to Amazon S3, Google Cloud, Microsoft Azure, or Redis."})})}),[l,f,t,n]),g=(0,r.useCallback)((async e=>{v(e)}),[v]),x=(0,r.useCallback)((async e=>{ut({title:"Deleting storage",body:"This action cannot be undone. Are you sure?",buttonLook:"destructive",onOk:async()=>{null!==await s.callApi("deleteStorage",{params:{type:e.type,pk:e.id,target:t}})&&f()}})}),[f]);return(0,r.useEffect)((()=>{f()}),[f]),(0,Le.jsxs)(Vt.Column,{title:e,children:[(0,Le.jsx)("div",{className:n.elem("controls"),children:(0,Le.jsx)(Ge,{onClick:()=>v(),children:a})}),c&&!u?(0,Le.jsx)("div",{className:n.elem("empty"),children:(0,Le.jsx)(Cn,{size:32})}):0===i.length?null:i.map((e=>(0,Le.jsx)(Ps,{storage:e,target:t,rootClass:n,storageTypes:m,onEditStorage:g,onDeleteStorage:x},e.id)))]})},Rs=()=>{const e=Ie("storage-settings");return(0,Le.jsxs)($e,{name:"storage-settings",children:[(0,Le.jsx)(ms,{style:{marginTop:0},children:"Use cloud or database storage as the source for your labeling tasks or the target of your completed annotations."}),(0,Le.jsxs)(Vt,{count:2,gap:"40px",size:"320px",className:e,children:[(0,Le.jsx)(Os,{title:"Source Cloud Storage",buttonLabel:"Add Source Storage",rootClass:e}),(0,Le.jsx)(Os,{title:"Target Cloud Storage",target:"export",buttonLabel:"Add Target Storage",rootClass:e})]})]})};Rs.title="Cloud Storage",Rs.path="/storage";const Ds={title:t("Settings"),path:"/settings",exact:!0,layout:({children:e,...t})=>(0,Le.jsx)(kn,{menuItems:[ds,ps,us,ws,Rs,ss,ls],path:t.match.url,children:e}),component:ds,pages:{InstructionsSettings:us,LabelingSettings:ps,MachineLearningSettings:ws,StorageSettings:Rs,WebhookPage:ss,DangerZone:ls}};var _s=a(266),Ls=a.n(_s);const Ms=({projects:e,currentPage:n,totalItems:a,loadNextPage:s,pageSize:l})=>(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(Be,{name:"list",children:e.map((e=>(0,Le.jsx)(Is,{project:e},e.id)))}),(0,Le.jsx)(Be,{name:"pages",children:(0,Le.jsx)(Vn,{name:"projects-list",label:t("Projects"),page:n,totalItems:a,urlParamName:"page",pageSize:l,pageSizeOptions:[10,30,50,100],onPageLoad:(e,t)=>s(e,t)})})]}),Fs=({openModal:e})=>(0,Le.jsxs)($e,{name:"empty-projects-page",children:[(0,Le.jsx)(Be,{name:"heidi",tag:"img",src:Re("/static/images/opossum_looking.png")}),(0,Le.jsx)(Be,{name:"header",tag:"h1",children:"Heidi doesn’t see any projects here"}),(0,Le.jsx)("p",{children:"Create one and start labeling your data"}),(0,Le.jsx)(Be,{name:"action",tag:Ge,onClick:e,look:"primary",children:"Create Project"})]}),Is=({project:e})=>{var n;const a=(0,r.useMemo)((()=>"#FFFFFF"===e.color?null:e.color),[e]),s=(0,r.useMemo)((()=>a?{"--header-color":a,"--background-color":Ls()(a).alpha(.2).css()}:{}),[a]);return(0,Le.jsx)(Be,{tag:Tt.OL,name:"link",to:`/projects/${e.id}/data`,"data-external":!0,children:(0,Le.jsxs)($e,{name:"project-card",mod:{colored:!!a},style:s,children:[(0,Le.jsxs)(Be,{name:"header",children:[(0,Le.jsxs)(Be,{name:"title",children:[(0,Le.jsx)(Be,{name:"title-text",children:null!==(n=e.title)&&void 0!==n?n:"New project"}),(0,Le.jsx)(Be,{name:"menu",onClick:e=>{e.stopPropagation(),e.preventDefault()},children:(0,Le.jsx)(Lt.Trigger,{content:(0,Le.jsxs)(zt,{children:[(0,Le.jsx)(zt.Item,{href:`/projects/${e.id}/settings`,children:t("Settings")}),(0,Le.jsx)(zt.Item,{href:`/projects/${e.id}/data?labeling=1`,children:"Label"})]}),children:(0,Le.jsx)(Ge,{size:"small",type:"text",icon:(0,Le.jsx)(T,{})})})})]}),(0,Le.jsx)(Be,{name:"summary",children:(0,Le.jsxs)(Be,{name:"annotation",children:[(0,Le.jsxs)(Be,{name:"total",children:[e.num_tasks_with_annotations," / ",e.task_number]}),(0,Le.jsxs)(Be,{name:"detail",children:[(0,Le.jsxs)(Be,{name:"detail-item",mod:{type:"completed"},children:[(0,Le.jsx)(Be,{tag:x,name:"icon"}),e.total_annotations_number]}),(0,Le.jsxs)(Be,{name:"detail-item",mod:{type:"rejected"},children:[(0,Le.jsx)(Be,{tag:J,name:"icon"}),e.skipped_annotations_number]}),(0,Le.jsxs)(Be,{name:"detail-item",mod:{type:"predictions"},children:[(0,Le.jsx)(Be,{tag:h,name:"icon"}),e.total_predictions_number]})]})]})})]}),(0,Le.jsx)(Be,{name:"description",children:e.description}),(0,Le.jsxs)(Be,{name:"info",children:[(0,Le.jsx)(Be,{name:"created-date",children:(0,vn.Z)(new Date(e.created_at),"dd MMM ’yy, HH:mm")}),(0,Le.jsx)(Be,{name:"created-by",children:(0,Le.jsx)(fn,{src:"#",user:e.created_by,showUsername:!0})})]})]})})},zs=()=>{var e;const t=r.useContext(ft),[n,a]=r.useState([]),[s,l]=r.useState(null),[i,o]=(0,r.useState)((()=>{const e=new URLSearchParams(location.search).get("page");return e?parseInt(e):1})()),[c,d]=(0,r.useState)(1),u=ul(),p=parseInt(null!==(e=localStorage.getItem("pages:projects-list"))&&void 0!==e?e:30),[m,h]=r.useState(!1),f=h.bind(null,!0),v=h.bind(null,!1),g=async(e=i,n=p)=>{var s,r;l("loading");const o=await t.callApi("projects",{params:{page:e,page_size:n}});d(null!==(s=null==o?void 0:o.count)&&void 0!==s?s:1),a(null!==(r=o.results)&&void 0!==r?r:[]),l("loaded")};return r.useEffect((()=>{g()}),[]),r.useEffect((()=>{u({openModal:f,showButton:n.length>0})}),[n.length]),(0,Le.jsx)($e,{name:"projects-page",children:(0,Le.jsxs)(An,{value:s,children:[(0,Le.jsx)(Be,{name:"loading",case:"loading",children:(0,Le.jsx)(Cn,{size:64})}),(0,Le.jsxs)(Be,{name:"content",case:"loaded",children:[n.length?(0,Le.jsx)(Ms,{projects:n,currentPage:i,totalItems:c,loadNextPage:async(e,t)=>{o(e),await g(e,t)},pageSize:p}):(0,Le.jsx)(Fs,{openModal:f}),m&&(0,Le.jsx)(_a,{onClose:v})]})]})})};zs.title=t("Projects"),zs.path="/projects",zs.exact=!0,zs.routes=({store:e})=>[{title:()=>{var t;return null===(t=e.project)||void 0===t?void 0:t.title},path:"/:id(\\d+)",exact:!0,component:()=>{const e=(0,o.UO)();return(0,Le.jsx)(o.l_,{to:`/projects/${e.id}/data`})},pages:{DataManagerPage:Qa,SettingsPage:Ds}}],zs.context=({openModal:e,showButton:t})=>t?(0,Le.jsx)(Ge,{onClick:e,look:"primary",size:"compact",children:"Create"}):null;var $s=a(7575);const Bs=({defaultText:e="",timeout:t=1200})=>{const[n,a]=(0,r.useState)(!1);return[n,(0,r.useCallback)((n=>{a(!0),De(Pe(n)?n:e),setTimeout((()=>a(!1)),t)}),[e,t])]},Hs=(0,r.forwardRef)((({children:e,title:t,textForCopy:n,...a},s)=>{const[l,i]=Bs({defaultText:n}),o=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),i()}),[]),c=r.Children.only(e),d=(0,r.cloneElement)(c,{...c.props,ref:s,onClick:o});return(0,Le.jsx)(mn,{title:l?"Copied!":t,onClick:o,...a,children:d})})),Us=({onSelect:e,selectedUser:t,defaultSelected:n})=>{const a=bt(),[s,l]=(0,r.useState)(),[i]=((e,t=1)=>{const n=new URLSearchParams(location.search).get(e),[a,s]=(0,r.useState)(n?parseInt(n):t);return[a,s]})("page",1),[o]=((e,t=1)=>{const n=new URLSearchParams(location.search).get(e),[a,s]=(0,r.useState)(n?parseInt(n):t);return[a,s]})("page_size",30),[c,d]=(0,r.useState)(0);console.log({currentPage:i,currentPageSize:o});const u=(0,r.useCallback)((async(e,t)=>{const n=await a.callApi("memberships",{params:{pk:1,contributed_to_projects:1,page:e,page_size:t}});n.results&&(l(n.results),d(n.count))}),[a]),p=(0,r.useCallback)((n=>{(null==t?void 0:t.id)===n.id?null==e||e(null):null==e||e(n)}),[t]);return(0,r.useEffect)((()=>{u(i,o)}),[]),(0,r.useEffect)((()=>{if(Pe(n)&&s){const e=s.find((({user:e})=>e.id===Number(n)));e&&p(e.user)}}),[s,n]),(0,Le.jsx)(Le.Fragment,{children:(0,Le.jsxs)($e,{name:"people-list",children:[(0,Le.jsx)(Be,{name:"wrapper",children:s?(0,Le.jsxs)(Be,{name:"users",children:[(0,Le.jsxs)(Be,{name:"header",children:[(0,Le.jsx)(Be,{name:"column",mix:"avatar"}),(0,Le.jsx)(Be,{name:"column",mix:"email",children:"Email"}),(0,Le.jsx)(Be,{name:"column",mix:"name",children:"Name"}),(0,Le.jsx)(Be,{name:"column",mix:"last-activity",children:"Last Activity"})]}),(0,Le.jsx)(Be,{name:"body",children:s.map((({user:e})=>{const n=e.id===(null==t?void 0:t.id);return(0,Le.jsxs)(Be,{name:"user",mod:{active:n},onClick:()=>p(e),children:[(0,Le.jsx)(Be,{name:"field",mix:"avatar",children:(0,Le.jsx)(Hs,{title:"User ID: "+e.id,textForCopy:e.id,children:(0,Le.jsx)(fn,{user:e,style:{width:28,height:28}})})}),(0,Le.jsx)(Be,{name:"field",mix:"email",children:e.email}),(0,Le.jsxs)(Be,{name:"field",mix:"name",children:[e.first_name," ",e.last_name]}),(0,Le.jsx)(Be,{name:"field",mix:"last-activity",children:(0,$s.Z)(new Date(e.last_activity),new Date,{addSuffix:!0})})]},`user-${e.id}`)}))})]}):(0,Le.jsx)(Be,{name:"loading",children:(0,Le.jsx)(Cn,{size:36})})}),(0,Le.jsx)(Vn,{page:i,urlParamName:"page",totalItems:c,pageSize:o,pageSizeOptions:[30,50,100],onPageLoad:u,style:{paddingTop:16}})]})})},Vs=({projects:e})=>(0,Le.jsx)(Be,{name:"links-list",children:e.map((e=>(0,Le.jsx)(Be,{tag:Tt.OL,name:"project-link",to:`/projects/${e.id}`,"data-external":!0,children:e.title},`project-${e.id}`)))}),qs=({user:e,onClose:n})=>{const a=[e.first_name,e.last_name].filter((e=>!!e)).join(" ").trim();return(0,Le.jsxs)($e,{name:"user-info",children:[(0,Le.jsx)(Be,{name:"close",tag:Ge,type:"link",onClick:n,children:(0,Le.jsx)(w,{})}),(0,Le.jsxs)(Be,{name:"header",children:[(0,Le.jsx)(fn,{user:e,style:{width:64,height:64,fontSize:28}}),a&&(0,Le.jsx)(Be,{name:"full-name",children:a}),(0,Le.jsx)(Be,{tag:"p",name:"email",children:e.email})]}),e.phone&&(0,Le.jsx)(Be,{name:"section",children:(0,Le.jsx)("a",{href:`tel:${e.phone}`,children:e.phone})}),!!e.created_projects.length&&(0,Le.jsxs)(Be,{name:"section",children:[(0,Le.jsx)(Be,{name:"section-title",children:t("Created Projects")}),(0,Le.jsx)(Vs,{projects:e.created_projects})]}),!!e.contributed_to_projects.length&&(0,Le.jsxs)(Be,{name:"section",children:[(0,Le.jsx)(Be,{name:"section-title",children:"Contributed to"}),(0,Le.jsx)(Vs,{projects:e.contributed_to_projects})]}),(0,Le.jsxs)(Be,{tag:"p",name:"last-active",children:["Last activity on: ",(0,vn.Z)(new Date(e.last_activity),"dd MMM yyyy, KK:mm a")]})]})},Ws=({link:e})=>(0,Le.jsxs)($e,{name:"invite",children:[(0,Le.jsx)(zn,{value:e,style:{width:"100%"},readOnly:!0}),(0,Le.jsxs)(ms,{style:{width:"70%",marginTop:16},children:["Invite people to join your Label Studio instance. People that you invite have full access to all of your projects. ",(0,Le.jsx)("a",{href:"https://labelstud.io/guide/signup.html",children:"Learn more"}),"."]})]}),Gs=()=>{const e=bt(),t=(0,r.useRef)(),n=Qe(),[a,s]=(0,r.useState)(null),[l,i]=(0,r.useState)(),o=(0,r.useCallback)((e=>{s(e),localStorage.setItem("selectedUser",null==e?void 0:e.id)}),[s]),c=(0,r.useCallback)((e=>{const t=n.hostname||location.origin;i(`${t}${e}`)}),[n,i]),d=(0,r.useCallback)((()=>{e.callApi("resetInviteLink").then((({invite_url:e})=>{c(e)}))}),[c]),u=(0,r.useCallback)((e=>({title:"Invite people",style:{width:640,height:472},body:()=>(0,Le.jsx)(Ws,{link:e}),footer:()=>{const[t,n]=(0,r.useState)(!1),a=(0,r.useCallback)((()=>{n(!0),De(e),setTimeout((()=>n(!1)),1500)}),[]);return(0,Le.jsxs)(Ke,{spread:!0,children:[(0,Le.jsx)(Ke,{children:(0,Le.jsx)(Ge,{style:{width:170},onClick:()=>d(),children:"Reset Link"})}),(0,Le.jsx)(Ke,{children:(0,Le.jsx)(Ge,{primary:!0,style:{width:170},onClick:a,children:t?"Copied!":"Copy link"})})]})},bareFooter:!0})),[]),p=(0,r.useCallback)((()=>{t.current=dt(u(l))}),[u,l]),m=(0,r.useMemo)((()=>localStorage.getItem("selectedUser")),[]);return(0,r.useEffect)((()=>{e.callApi("inviteLink").then((({invite_url:e})=>{c(e)}))}),[]),(0,r.useEffect)((()=>{var e;null===(e=t.current)||void 0===e||e.update(u(l))}),[l]),(0,Le.jsxs)($e,{name:"people",children:[(0,Le.jsx)(Be,{name:"controls",children:(0,Le.jsxs)(Ke,{spread:!0,children:[(0,Le.jsx)(Ke,{}),(0,Le.jsx)(Ke,{children:(0,Le.jsx)(Ge,{icon:(0,Le.jsx)(oe,{}),primary:!0,onClick:p,children:"Add People"})})]})}),(0,Le.jsxs)(Be,{name:"content",children:[(0,Le.jsx)(Us,{selectedUser:a,defaultSelected:m,onSelect:e=>o(e)}),a&&(0,Le.jsx)(qs,{user:a,onClose:()=>o(null)})]})]})};var Js;Gs.title="People",Gs.path="/";const Ks=null===(Js=window.APP_SETTINGS.flags)||void 0===Js?void 0:Js.allow_organization_webhooks,Zs={};Ks&&(Zs[ss]=ss);const Xs=[zs,{title:t("Organization"),path:"/organization",exact:!0,layout:({children:e,...t})=>{let n=[Gs];return Ks&&n.push(ss),(0,Le.jsx)(kn,{menuItems:n,path:t.match.url,children:e})},component:Gs,pages:Zs}],Ys=e=>{const t=[],n=[];try{r.Children.toArray(e).forEach((e=>{var a;null!=e&&null!==(a=e.props)&&void 0!==a&&a.modal?t.push(e):n.push(e)}))}catch(t){console.log(t),console.log({children:e})}return[t,n]},Qs=({children:e,render:t,route:n,component:a,staticComponent:s,...l})=>{const i=r.useContext(jn),c=e=>{let t=[],n=[];e.props&&e.props.children?([t,n]=Ys(e.props.children),e=r.cloneElement(e,{children:n})):Array.isArray(e)&&([t,n]=Ys(e),e=n);const a=()=>(!1===(null==i?void 0:i.contextIsSet(null))&&(null==i||i.setContext(null)),null!=s?s:(0,Le.jsx)(pn,{id:"main-content"})),l=t.reduce(((e,t)=>(t.props.exact?e.exact.push(t):e.modal.push(t),e)),{exact:[],modal:[]});return(0,Le.jsxs)(Le.Fragment,{children:[l.modal,(0,Le.jsxs)(o.rs,{children:[l.exact,e,(0,Le.jsx)(d,{exact:!0,children:(0,Le.jsx)(a,{})})]})]})},u={};return t?u.render=e=>c(t(e)):e instanceof Function?u.children=t=>c(e(t)):a?u.component=e=>c(a(e)):u.children=c(e),!1!==n?(0,Le.jsx)(d,{...l,...u}):c(e)},el=(e,t)=>e instanceof Function?e(t):e,tl=(e,t)=>{const n=([e,n])=>{var a;const s={path:n.path};return s.exact=!!n.exact,s.modal=!!n.modal,n.title&&(s.title=n.title),n.render&&(s.render=n.render),n instanceof r.Component||n instanceof Function?e&&/Layout/.test(e)?s.layout=n:s.component=n:(s.component=n.component,s.layout=n.layout),n.pages?s.routes=tl(el(n.pages,t),t):n.routes&&(s.routes=tl(el(n.routes,t),t)),null!==(a=s.component)&&void 0!==a&&a.context&&(s.context=s.component.context),s};try{return Array.isArray(e)?e.map((e=>n([null,e]))):Object.entries(e).map(n)}catch(e){return console.log(e),[]}},nl=(e,t)=>{const n=(e,a)=>e.map((e=>((e,a)=>{const{component:s,layout:l,path:r,modal:i,routes:o,...c}=e,u=a?`${a}${r}`:r;if(o){const e=n(o,u),t=t=>{const o=[];return s&&o.push(n([{path:r,modal:i,...c,component:s}],a)),o.push(...e),l?(0,Le.jsx)(l,{...t,children:o}):o};return(0,Le.jsx)(Qs,{path:u,render:t},u)}{const e={key:u,path:u,modal:!!s.modal};return(0,Le.jsx)(d,{...e,exact:!0,render:()=>(0,Le.jsx)(s,{...null!=t?t:{}}),...c})}})(e,a)));return n(e)},al=(0,r.createContext)(),sl=(e,t,n="")=>{const a=[],s=t.find((t=>{const a=`${n}${t.path}`;return(0,o.LX)(e,{path:a})}));if(s){const t=`${n}${s.path}`;a.push({...s,path:t}),s.routes&&a.push(...sl(e,s.routes,t))}return a},ll=({children:e})=>{const t=(0,o.k6)(),n=dl(),a=Qe(),{store:s}=kt(),l=Va(),[i,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),p=(0,r.useMemo)((()=>tl(Xs,{config:a,store:s})),[n,a,s,t]),m=(0,r.useMemo)((()=>sl(n.pathname,p)),[n,p]),h=(0,r.useMemo)((()=>m.filter((e=>!e.modal)).slice(-1)[0]),[m]),[f,v]=(0,r.useState)(null==h?void 0:h.path),g=(0,r.useMemo)((()=>({routesMap:p,breadcrumbs:l,currentContext:i,setContextProps:u,path:f,findComponent:e=>sl(e,p)})),[l,p,i,f,c]);return(0,r.useEffect)((()=>{const e=null==h?void 0:h.context;c({component:null!=e?e:null,props:d}),v(null==h?void 0:h.path);try{const e=m.map((e=>{var t,a,s;const l=(0,o.LX)(n.pathname,{path:e.path}),r=(0,o.Gn)(e.path,l.params);return{path:r,title:e.title instanceof Function?e.title():e.title,key:null!==(t=null!==(a=null===(s=e.component)||void 0===s?void 0:s.displayName)&&void 0!==a?a:e.key)&&void 0!==t?t:r}})).filter((e=>!!e.title));Ia(e)}catch(e){console.log(e)}}),[n,p,d,m,h]),(0,Le.jsx)(al.Provider,{value:g,children:e})},rl=()=>{var e,t;return null!==(e=null===(t=(0,r.useContext)(al))||void 0===t?void 0:t.findComponent)&&void 0!==e?e:()=>null},il=()=>{var e,t;return null!==(e=null===(t=(0,r.useContext)(al))||void 0===t?void 0:t.breadcrumbs)&&void 0!==e?e:[]},ol=()=>{const e=dl(),t=null===(n=(0,r.useContext)(al))||void 0===n?void 0:n.path;var n;const a=(0,r.useMemo)((()=>{var n;const a=e.search.replace(/^\?/,"").split("&").map((e=>{const[t,n]=e.split("=").map((e=>decodeURIComponent(e)));return[t,n]})),s=Object.fromEntries(a),l=(0,o.LX)(e.pathname,null!=t?t:"");return{...s,...null!==(n=null==l?void 0:l.params)&&void 0!==n?n:{}}}),[e,t]);return null!=a?a:{}},cl=()=>{var e;const t=(0,r.useContext)(al),{component:n,props:a}=null!==(e=null==t?void 0:t.currentContext)&&void 0!==e?e:{};return{ContextComponent:n,contextProps:a}},dl=()=>{const e=(0,o.TH)();return(0,r.useMemo)((()=>{var t;return null!==(t=e.location)&&void 0!==t?t:e}),[e])},ul=()=>{const e=(0,r.useContext)(al).setContextProps;return(0,r.useMemo)((()=>e),[e])},pl=(0,r.createContext)({});pl.displayName="ProjectContext";const ml=new Map,hl=({children:e})=>{var t;const n=bt(),a=ol(),{update:s}=kt(),[l,i]=(0,r.useState)(null!==(t=ml.get(+a.id))&&void 0!==t?t:{}),o=(0,r.useCallback)((async(e,t=!1)=>{const r=+(null!=e?e:a.id);if(isNaN(r))return;!t&&ml.has(r)&&i({...ml.get(r)});const o=await n.callApi("project",{params:{pk:r},errorFilter:()=>!1});return!1===(0,Pt.V)(l,o)&&(i(o),s({project:o}),ml.set(o.id,o)),o}),[a]),c=(0,r.useCallback)((async e=>{const t=await n.callApi("updateProject",{params:{pk:l.id},body:e});return t.$meta&&(i(t),s({project:t})),t}),[l,i,s]);return(0,r.useEffect)((()=>{+a.id!==(null==l?void 0:l.id)&&i({}),o()}),[a]),(0,r.useEffect)((()=>()=>ml.clear()),[]),(0,Le.jsx)(pl.Provider,{value:{project:l,fetchProject:o,updateProject:c,invalidateCache(){ml.clear(),i({})}},children:e})},fl=()=>{var e;return null!==(e=(0,r.useContext)(pl))&&void 0!==e?e:{}},vl=r.createContext();class gl extends r.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,{componentStack:t}){this.setState({error:e,hasError:!0,errorInfo:t})}render(){if(this.state.hasError){var e,t;const{error:n,errorInfo:a}=this.state,s=()=>{history.back(),setTimeout((()=>location.reload()),32)};return(0,Le.jsx)(ot,{onHide:()=>location.reload(),style:{width:"60vw"},visible:!0,bare:!0,children:(0,Le.jsx)("div",{style:{padding:40},children:(0,Le.jsx)(Ze,{title:"Runtime error",message:n,stacktrace:`${a?`Component Stack: ${a}`:""}\n\n${null!==(e=null===(t=this.state.error)||void 0===t?void 0:t.stack)&&void 0!==e?e:""}`,onGoBack:s,onReload:()=>location.reload()})})})}return(0,Le.jsx)(vl.Provider,{value:{hasError:this.state.hasError,error:this.state.error,errorInfo:this.state.errorInfo,silence:this.silence,unsilence:this.unsilence},children:this.props.children})}}const xl=({content:e})=>{const t=null!==(n=null===(a=(0,r.useContext)(al))||void 0===a?void 0:a.routesMap)&&void 0!==n?n:[];var n,a;const s=nl(t,{content:e});return s?(0,Le.jsx)(Qs,{path:"/",children:s}):null},jl=({content:e})=>{const t="true"===localStorage.getItem("sidebar-pinned"),n=t&&"true"===localStorage.getItem("sidebar-opened");return(0,Le.jsx)(wn,{enabled:!0,defaultOpened:n,defaultPinned:t,onSidebarToggle:e=>localStorage.setItem("sidebar-opened",e),onSidebarPin:e=>localStorage.setItem("sidebar-pinned",e),children:(0,Le.jsx)(xl,{content:e})})},bl=new URL(APP_SETTINGS.hostname||location.origin),yl=(0,l.lX)({basename:bl.pathname||"/"});window.LSH=yl;const wl=({content:e})=>{const t={lsf:{scriptSrc:window.EDITOR_JS,cssSrc:window.EDITOR_CSS,checkAvailability:()=>!!window.LabelStudio},dm:{scriptSrc:window.DM_JS,cssSrc:window.DM_CSS,checkAvailability:()=>!!window.DataManager}};return(0,Le.jsx)(gl,{children:(0,Le.jsx)(o.F0,{history:yl,children:(0,Le.jsx)(nt,{providers:[(0,Le.jsx)(wt,{},"app-store"),(0,Le.jsx)(jt,{},"api"),(0,Le.jsx)(Ye,{},"config"),(0,Le.jsx)(Nt,{libraries:t},"lsf"),(0,Le.jsx)(ll,{},"rotes"),(0,Le.jsx)(hl,{},"project")],children:(0,Le.jsx)(cn,{children:(0,Le.jsx)(jl,{content:e})})})})})},kl=document.querySelector(".app-wrapper"),Cl=document.querySelector("#main-content");(0,i.render)((0,Le.jsx)(wl,{content:Cl.innerHTML}),kl)}}]);
//# sourceMappingURL=116.index.js.map